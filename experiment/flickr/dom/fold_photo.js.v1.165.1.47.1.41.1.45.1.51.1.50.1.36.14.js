function place_menu(u,d){var O=Y.U.Dom.getX(d);var H=Y.U.Dom.getY(d)+24;if(F.is_ie){O-=2;H-=2;}u.style.left=O+"px";u.style.top=H+"px";}var sendToBlogDialogDiv;function show_sendToBlogDialog(d){if(!_ok_for_scrumjax_xml()){document.location="/blog.gne?photo="+d;return ;}if(_ge("photo_props")){_ge("photo_props").style.display="none";}var u=_ge("photo_gne_button_blog_this");u.disable_others();if(sendToBlogDialogDiv==undefined){make_send_to_div("sendToBlog",d);}place_menu(sendToBlogDialogDiv,u);sendToBlogDialogDiv.style.display="block";if(navigator.userAgent.indexOf("Mozilla/5.0")!=-1&&navigator.userAgent.indexOf("KHTML")==-1){var O=_ge("sendToBlogDialogListDiv").offsetHeight;if(O>=220){_ge("sendToBlogDialogListDiv").style.overflow="-moz-scrollbars-vertical";}}}var sendToGroupDialogDiv;function show_sendToGroupDialog(d){if(!_ok_for_scrumjax_xml()){document.location="/photo_sendto_group.gne?id="+d;return ;}if(_ge("photo_props")){_ge("photo_props").style.display="none";}var u=_ge("photo_gne_button_send_to_group");u.disable_others();if(sendToGroupDialogDiv==undefined){make_send_to_div("sendToGroup",d);}place_menu(sendToGroupDialogDiv,u);sendToGroupDialogDiv.style.display="block";if(navigator.userAgent.indexOf("Mozilla/5.0")!=-1&&navigator.userAgent.indexOf("KHTML")==-1){var O=_ge("sendToGroupDialogListDiv").offsetHeight;if(O>=220){_ge("sendToGroupDialogListDiv").style.overflow="-moz-scrollbars-vertical";}}}var sendToSetDialogDiv;function show_sendToSetDialog(d){if(!_ok_for_scrumjax_xml()){document.location="/photo_sendto_set.gne?id="+d;return ;}if(_ge("photo_props")){_ge("photo_props").style.display="none";}var u=_ge("photo_gne_button_send_to_set");u.disable_others();if(sendToSetDialogDiv==undefined){make_send_to_div("sendToSet",d);}place_menu(sendToSetDialogDiv,u);sendToSetDialogDiv.style.display="block";if(navigator.userAgent.indexOf("Mozilla/5.0")!=-1&&navigator.userAgent.indexOf("KHTML")==-1){var O=_ge("sendToSetDialogListDiv").offsetHeight;if(O>=220){_ge("sendToSetDialogListDiv").style.overflow="-moz-scrollbars-vertical";}}}var printDialogDiv;function show_printDialog(O){if(!_ok_for_scrumjax_xml()){document.location="/photo_print.gne?id="+O;return ;}if(_ge("photo_props")){_ge("photo_props").style.display="none";}var d=_ge("photo_gne_button_print");d.disable_others();if(printDialogDiv==undefined){make_send_to_div("print",O);}place_menu(printDialogDiv,d);printDialogDiv.style.display="block";}function hide_printDialog(){hide_send_to_div(printDialogDiv,_ge("photo_gne_button_print"));var O=_ge("print_form");if(O&&O.clear){O.clear();}}function hide_sendToSetDialog(){hide_send_to_div(sendToSetDialogDiv,_ge("photo_gne_button_send_to_set"),_ge("sendToSetDialogFormDiv"));var O=_ge("new_set_form");O.set_title.value="";O.set_description.value="";}function hide_sendToGroupDialog(){hide_send_to_div(sendToGroupDialogDiv,_ge("photo_gne_button_send_to_group"));}function hide_sendToBlogDialog(){hide_send_to_div(sendToBlogDialogDiv,_ge("photo_gne_button_blog_this"));}hide_send_to_div=function(H,u,d){u.enable_others();u.lock_down=0;u.handle_mouseout();H.style.display="none";window.should_I_ignore_stuff_because_of_button_action=0;_ge(H.id.replace("Div","")+"HeaderDiv").innerHTML=H.get_click_a_text();var O=_ge(H.id.replace("Div","")+"ListDiv");if(d&&d.style.display=="block"){O.style.display="block";d.style.display="none";}};make_send_to_div=function(A,H){var q=A+"Dialog";var w=q+"Div";if(A=="sendToSet"){var g="set";var N=F.output.get("photo_what_set");var u=F.output.get("photo_what_set_plural");var d=49;var U="flickr.photosets.getList";var a=F.output.get("photo_create_new_one",w);}else{if(A=="sendToGroup"){var g="group";var N=F.output.get("photo_what_group");var u=F.output.get("photo_what_group_plural");var d=54;var U="flickr.groups.pools.getGroups";var a=F.output.get("photo_dont_belong");}else{if(A=="sendToBlog"){var g="blog";var N=F.output.get("photo_what_blog");var u=F.output.get("photo_what_blog_plural");var d=48;var U="flickr.blogs.getList";var a=F.output.get("photo_configure_blog_now");}else{if(A=="print"){var g="print";var N=F.output.get("photo_what_print");var u=F.output.get("photo_what_print_plural");var d=58;var U="";var a="";}else{return ;}}}}var O=window[w]=document.createElement("div");O.id=w;O.style.position="absolute";O.style.padding="0 0px 0px 0px";O.style.border="1px solid #999";O.style.borderWidth="0 1px 1px 1px";O.style.fontFamily="arial";O.style.fontSize="12px";O.style.textAlign="left";O.style.backgroundColor="#fff";O.style.width="250px";O.style.overflow="visible";if(A=="print"){O.style.width="260px";var L="<div style=\"border:1px solid #999; border-width:1px 0 0 0;height:1px; margin-left:"+d+"px; font-size:1px;\"></div>";L+="<div id=\""+q+"HeaderDiv\" style=\"text-align:center; padding:3px 0 3px 0;\">"+F.output.get("photo_loading_print_options")+"</div>";L+="<div id=\""+q+"ListWrapperDiv\" style=\"display:none; background-color:#fff; padding:4px 2px 4px 2px; border-bottom: 1px solid #ddd; border-top: 1px solid #ddd;\">";L+="<div id=\""+q+"ListDiv\" style=\"padding-right:2px; max-height:450px; overflow:auto;\"></div>";L+="</div>";L+="<div id=\""+q+"BottomDiv\" style=\"margin:0px; display:none; background-color:#f7f7f7; font-family:arial; font-size:11px; padding:13px 13px 8px 13px;\">";L+="<!--"+F.output.get("photo_printing_services_provided_by");L+="<br><img src=\""+_images_root+"/icon_cart.gif\" width=\"16\" height=\"16\" border=\"0\" style=\"border:0; float:right; display:block;\"><br clear=\"all\">";L+="--></div>";}else{var L="<div style=\"border:1px solid #999; border-width:1px 0 0 0;height:1px; margin-left:"+d+"px; font-size:1px;\"></div>";if(g=="set"){L+="<div id=\""+q+"HeaderDiv\" style=\"text-align:center; padding:3px 0 3px 0;\">"+F.output.get("photo_loading_what_set")+"</div>";}if(g=="group"){L+="<div id=\""+q+"HeaderDiv\" style=\"text-align:center; padding:3px 0 3px 0;\">"+F.output.get("photo_loading_what_group")+"</div>";}if(g=="blog"){L+="<div id=\""+q+"HeaderDiv\" style=\"text-align:center; padding:3px 0 3px 0;\">"+F.output.get("photo_loading_what_blog")+"</div>";}if(g=="print"){L+="<div id=\""+q+"HeaderDiv\" style=\"text-align:center; padding:3px 0 3px 0;\">"+F.output.get("photo_loading_what_print")+"</div>";}L+="<div style=\"display:none; background-color:#fff; padding:4px 2px 4px 2px; border-bottom: 1px solid #ddd; border-top: 1px solid #ddd;\">";L+="<div id=\""+q+"ListDiv\" style=\"padding-right:2px; max-height:220px; overflow:auto;\"></div>";L+="\t<div id=\""+q+"FormDiv\" style=\"margin:10px; display:none; height:200px\">";if(A=="sendToSet"){L+="<form id=\"new_set_form\" onsubmit=\"_ge('"+w+"').create_new_set(); return false;\">";L+=F.output.get("photo_title")+"<br><input type=\"text\" name=\"set_title\" style=\"width:220px;\"><br><br>";L+=F.output.get("photo_description")+"<br><textarea type=\"text\" name=\"set_description\" style=\"width:220px; height:105px;\"></textarea><br>";L+="<input type=\"button\" class=\"Butt\" value=\""+F.output.get("photo_create_new_set")+"\" onclick=\"_ge('"+w+"').create_new_set(); this.blur();\" style=\"margin:5px 0 0 0;\">";L+="</form>";}L+="</div>";L+="</div>";L+="<div id=\""+q+"BottomDiv\" style=\"margin:3px; display:none; text-align:center;\">";L+="<a href=\"\" onclick=\"hide_"+q+"(); return false;\">"+F.output.get("cancel")+"</a>";L+="</div>";}O.innerHTML=L;document.body.appendChild(O);O.get_click_a_text=function(){var o="";if(A=="sendToSet"){if(user_can_create_sets){o+=F.output.get("photo_choose_a_set_or","_ge('"+w+"').show_new_set_form();return false;");}else{o+=F.output.get("photo_choose_a_set");}}else{if(A=="print"){o=F.output.get("photo_choose_a_size");}else{if(g=="set"){o=F.output.get("photo_choose_a_what_set");}if(g=="group"){o=F.output.get("photo_choose_a_what_group");}if(g=="blog"){o=F.output.get("photo_choose_a_what_blog");}if(g=="print"){o=F.output.get("photo_choose_a_what_print");}}}return o;};O.show_new_set_form=function(){_ge(q+"ListDiv").parentNode.style.display="block";_ge(q+"HeaderDiv").innerHTML=F.output.get("photo_create_new_set_ups");_ge(q+"ListDiv").style.display="none";_ge(q+"FormDiv").style.display="block";_ge("new_set_form").set_title.focus();};O.create_new_set=function(){var o=_ge("new_set_form");var X=o.set_title.value;var s=o.set_description.value;if(X==""){alert(F.output.get("photo_must_enter_set_title"));return ;}this.send_to_action(null,X,"create",s);};O.send_to_action=function(X,h,r,e,B){var t=_ge("photo_notes");if(A=="sendToGroup"&&r=="add"&&!global_photos[H].isPublic&&!B){window["hide_"+q]();var o=function(){O.send_to_action(X,h,r,e,1);};var W=F.output.get("photo_private_photo_to_group",h);t.start_comming(W,1,1,F.output.get("yes_up"),o,1,F.output.get("no_up"),null);return ;}deja_view_uh_huh();if(A=="print"){var s=F.output.get("photo_adding_prints_to_cart");}else{if(r=="remove"){var s="";if(g=="set"){s=F.output.get("photo_removing_photo_from_what_set");}if(g=="group"){s=F.output.get("photo_removing_photo_from_what_group");}if(g=="blog"){s=F.output.get("photo_removing_photo_from_what_blog");}}else{if(r=="create"){var s="";if(g=="set"){s=F.output.get("photo_creating_new_what_set");}if(g=="group"){s=F.output.get("photo_creating_new_what_group");}if(g=="blog"){s=F.output.get("photo_creating_new_what_blog");}}else{var s="";if(g=="set"){s=F.output.get("photo_adding_photo_to_what_set");}if(g=="group"){s=F.output.get("photo_adding_photo_to_what_group");}if(g=="blog"){s=F.output.get("photo_adding_photo_to_what_blog");}}}}window["hide_"+q]();this.id_dealing_with=X;this.title_dealing_with=h;if(A=="sendToSet"){if(r=="create"){F.API.callMethod("flickr.photosets.create",{title:h,description:e,primary_photo_id:H},O);}else{if(r=="remove"){F.API.callMethod("flickr.photosets.removePhoto",{photoset_id:X,photo_id:H},O);}else{F.API.callMethod("flickr.photosets.addPhoto",{photoset_id:X,photo_id:H},O);}}}else{if(A=="sendToGroup"){if(r=="remove"){F.API.callMethod("flickr.groups.pools.remove",{group_id:X,photo_id:H},O);}else{F.API.callMethod("flickr.groups.pools.add",{group_id:X,photo_id:H},O);}}else{if(A=="sendToBlog"){var Q=_ge("blog_form");Q.blog.value=X;Q.submit();return ;}else{if(A=="print"){O.addToCart_responses_expected=page_print_orderA.length;O.addToCart_responses=0;O.addToCart_error_count=0;O.addToCart_problem_product_ids=[];O.addToCart_cart_url="";O.addToCart_last_error="";O.send_another_printing_product();}else{return ;}}}}if(t&&t.start_comming){t.start_comming(s);}};O.send_another_printing_product=function(){var o=page_print_orderA[O.addToCart_responses].split(":");var s={provider_id:page_printing_provider,photo_ids:H,product_id:o[0].replace("prod",""),quantity:o[1]};F.API.callMethod("flickr.printing.addToCart",s,O);};O.flickr_printing_addToCart_onLoad=function(e,W,h,X){O.addToCart_responses++;if(e){O.addToCart_cart_url=W.documentElement.getElementsByTagName("cart")[0].firstChild.nodeValue;}else{O.addToCart_error_count++;O.addToCart_problem_product_ids.push(X.product_id);if(h){O.addToCart_last_error=h;}else{O.addToCart_last_error=F.output.get("unknown_err");}}if(O.addToCart_responses!=O.addToCart_responses_expected){O.send_another_printing_product();return ;}var B=_ge("photo_notes");writeDebug("div.addToCart_responses "+O.addToCart_responses+" "+O.addToCart_error_count);if(O.addToCart_responses>O.addToCart_error_count){if(O.addToCart_error_count>0){var r=F.output.get("photo_adding_some_errors",global_photos[H].title,O.addToCart_error_count,O.addToCart_last_error.truncate_with_ellipses(400).replace("&","[wbr]&").replace("/","/[wbr]").replace("=","=[wbr]").escape_for_display_and_wrap().replace("[wbr]","<wbr>"));}else{var r=F.output.get("photo_added_prints_to_cart",global_photos[H].title,O.addToCart_cart_url);}r+="<ul style=\"padding-left:20px;\">";for(var t=0;t<page_print_orderA.length;t++){var s=page_print_orderA[t].split(":");if(F.array_index_of(O.addToCart_problem_product_ids,O.productsO[s[0]].id)>-1){r+="<li style=\"color:red;\"><b>"+0+"</b> @ "+O.productsO[s[0]].id+" "+O.productsO[s[0]].name+"</li>";}else{r+="<li><b>"+s[1]+"</b> @ "+O.productsO[s[0]].name+" <nobr>("+format_price(s[1]*(O.productsO[s[0]].price.replace(".","")))+")</nobr></li>";}}r+="</ul>";r+="<form id=\"print_cart_form\"><input type=\"button\" id=\"print_ok_button\" class=\"Butt\" value=\""+F.output.get("photo_continue_browsing")+"\" style=\"margin:5px 0 10px 0;\"><br>"+F.output.get("photo_or_are_you_ready")+"<br><input type=\"button\" id=\"print_cart_button\" class=\"Butt\" value=\""+F.output.get("photo_proceed")+"\" style=\"margin:5px 0 10px 0;\"></form>"+"<div id=\"print_cart_prompt\"><img src=\""+_images_root+"/icon_cart.gif\" width=\"16\" height=\"16\" border=\"0\" style=\"margin:0 6px 20px 0; border:0; float:left; display:block;\">"+"<div>"+F.output.get("photo_get_to_cart")+"</div></div>";B.start_comming(r,1,0,F.output.get("photo_go_to_cart"),1,F.output.get("close_up"),null);var Q=_ge("print_ok_button");if(navigator.userAgent.indexOf("KHTML")==-1){Q.focus();}Q.onclick=function(){B.stop_comming();this.blur();};var o=_ge("print_cart_button");o.onclick=function(){B.stop_comming();this.blur();document.location=O.addToCart_cart_url;};}else{alert(F.output.get("photo_errors_adding_prints")+" "+O.addToCart_last_error);if(B&&B.stop_comming){B.stop_comming(1);}}};O.flickr_photosets_removePhoto_onLoad=O.flickr_groups_pools_remove_onLoad=function(Q,B,t){var s=_ge("photo_notes");var o=_ge("add_to_"+g+"_"+this.id_dealing_with+"_div");var X=_ge("add_to_"+g+"_"+this.id_dealing_with+"_td");if(Q||t.indexOf("not in pool")!=-1||t.indexOf("not in set")!=-1){if(o){o.make_me_for_adding();}if(s&&s.p_id&&A=="sendToSet"){var r=F.output.get("photo_removed_from_set",global_photos[H].ownersUrl,this.id_dealing_with,this.title_dealing_with);remove_context_widget("set",this.id_dealing_with);F.API.callMethod(U,{},O);}else{if(s&&s.p_id&&A=="sendToGroup"){var r=F.output.get("photo_removed_from_pool",this.id_dealing_with,this.title_dealing_with);remove_context_widget("pool",this.id_dealing_with);}}s.start_comming(r,1,1,F.output.get("ok"));}else{alert(F.output.get("api_err_generic")+" "+t);if(s&&s.stop_comming){s.stop_comming(1);}}};O.flickr_photosets_addPhoto_onLoad=O.flickr_groups_pools_add_onLoad=function(e,W,B,s){var t=_ge("photo_notes");var h=_ge("add_to_"+g+"_"+this.id_dealing_with+"_div");var X=_ge("add_to_"+g+"_"+this.id_dealing_with+"_td");if(e||B.indexOf("already in pool")!=-1||B.indexOf("already in set")!=-1||B.indexOf("Your Photo has been added to the Pending Queue for this Pool")!=-1){if(h){h.make_me_for_removing();}if(t&&t.p_id&&A=="sendToSet"){var r=F.output.get("photo_added_to_set",global_photos[H].ownersUrl,this.id_dealing_with,this.title_dealing_with);add_context_widget("set",this.id_dealing_with,H);}else{if(t&&t.p_id&&A=="sendToGroup"){if(B.indexOf("Your Photo has been added to the Pending Queue for this Pool")!=-1){var r=F.output.get("photo_added_to_pool_pending",this.id_dealing_with,this.title_dealing_with);}else{var r=F.output.get("photo_added_to_pool",this.id_dealing_with,this.title_dealing_with);}add_context_widget("pool",this.id_dealing_with,H,(B.indexOf("Your Photo has been added to the Pending Queue for this Pool")!=-1)?true:false);}}var Q=function(){h.confirm_remove();};t.start_comming(r,1,1,F.output.get("ok"),null,1,F.output.get("undo"),Q);}else{if(!W){alert(F.output.get("api_err_generic")+" "+B);if(t&&t.stop_comming){t.stop_comming(1);}return ;}var o=W.documentElement.getElementsByTagName("err")[0];if(o&&o.getAttribute("code")=="5"&&g=="group"){this.flickr_groups_getInfo_onLoad=function(Z,K,c,R){var v=K.documentElement.getElementsByTagName("throttle")[0];var E=v.getAttribute("count");var P=v.getAttribute("mode");if(P=="disabled"){var l=F.output.get("photo_adding_disabled",this.title_dealing_with);}else{if(P=="ever"){if(E*1>1){var l=F.output.get("photo_limits_1",E,this.title_dealing_with,E);}else{var l=F.output.get("photo_limits_2",E,this.title_dealing_with,E);}}else{if(E*1>1){var l=F.output.get("photo_limits_3",E,P,this.title_dealing_with,E);}else{var l=F.output.get("photo_limits_4",E,P,this.title_dealing_with,E);}}}l+="<br><br>"+F.output.get("photo_see_group_for_info",_site_root,this.id_dealing_with,this.title_dealing_with);t.start_comming(l,1,1);};F.API.callMethod("flickr.groups.getInfo",{group_id:this.id_dealing_with},this);}else{if(o&&o.getAttribute("code")=="4"&&g=="group"){t.start_comming(F.output.get("photo_max_groups",global_group_limit,this.title_dealing_with),1,1);}else{if(o&&o.getAttribute("code")=="6"&&g=="group"){t.start_comming(F.output.get("photo_max_groups",global_group_limit,this.title_dealing_with),1,1);}else{if(o&&o.getAttribute("code")=="7"&&g=="group"){t.start_comming(F.output.get("photo_added_to_pool_already_pending",global_group_limit,this.title_dealing_with),1,1);if(h){h.make_me_for_removing();}}else{alert(F.output.get("api_err_generic")+" "+B);if(t&&t.stop_comming){t.stop_comming(1);}}}}}}};O.flickr_photosets_create_onLoad=function(B,t,r){var s=_ge("photo_notes");if(B){var o=t.documentElement.getElementsByTagName("photoset")[0];if(s&&s.p_id&&A=="sendToSet"){var X=F.output.get("photo_added_to_set2",o.getAttribute("url"),this.title_dealing_with);add_context_widget("set",o.getAttribute("id"),H);}s.start_comming(X,1,1,F.output.get("ok"),null);F.API.callMethod(U,{new_set_id_passthrough:o.getAttribute("id")},O);}else{alert(F.output.get("api_err_generic")+" "+r);if(s&&s.stop_comming){s.stop_comming(1);}}};O.flickr_photosets_getList_onLoad=O.flickr_blogs_getList_onLoad=O.flickr_groups_pools_getGroups_onLoad=function(h,o,E,m){if(!h){alert(F.output.get("api_err_generic")+" "+E);}var J=1;var B=1;if(A=="sendToSet"){var v=o.documentElement.getElementsByTagName("photoset");user_can_create_sets=(o.documentElement.getElementsByTagName("photosets")[0].getAttribute("cancreate")=="1")?1:0;_ge(q+"HeaderDiv").innerHTML=this.get_click_a_text();}else{if(A=="sendToGroup"){var v=o.documentElement.getElementsByTagName("group");J=o.documentElement.getElementsByTagName("groups")[0].getAttribute("pages")*1;B=o.documentElement.getElementsByTagName("groups")[0].getAttribute("page")*1;}else{if(A=="sendToBlog"){var v=o.documentElement.getElementsByTagName("blog");}else{return ;}}}if(v.length==0){if(A=="sendToSet"){O.show_new_set_form();}else{_ge(q+"BottomDiv").innerHTML="<br>"+a+"<br><br>"+_ge(q+"BottomDiv").innerHTML+"";_ge(q+"HeaderDiv").style.display="none";}}else{if(B==1){_ge(q+"ListDiv").innerHTML="";}var G=_page_timer.add("before collection iteration");for(var k=0;k<v.length;k++){_page_timer.add("before handle one");var n=v[k];var I=n.getAttribute("id");if(A=="sendToSet"){var P="contextDiv_set"+I;var s="set";var K=o.documentElement.getElementsByTagName("title")[k].firstChild.nodeValue;var l=n.getAttribute("server");var W=Math.ceil(l/1000);var R=_photo_root.replace("http://farm","http://farm"+W);var t=R+l+"/"+n.getAttribute("primary")+"_"+n.getAttribute("secret")+"_s.jpg";var e=25;var X=25;}else{if(A=="sendToGroup"){var P="contextDiv_pool"+I;var s="pool";var K=n.getAttribute("name");var l=n.getAttribute("iconserver");var t=_images_root+"/buddyicon.jpg";if(l&&l!="0"){var W=Math.ceil(l/1000);var R=_photo_root.replace("http://farm","http://farm"+W);t=R+l+"/buddyicons/"+n.getAttribute("id")+".jpg";}var e=24;var X=24;}else{if(A=="sendToBlog"){var P="";var s="";var K=n.getAttribute("name");var t=_images_root+"/spaceball.gif";var e=20;var X=2;}}}var r=(k==0||(F.is_ie))?"0px":"-2px";var c=make_menu_item(g,I,K,r,t,X,e,q);_ge(q+"ListDiv").appendChild(c);var x=false;if(A=="sendToGroup"){for(var Z=0;Z<in_groupsA.length;Z++){if(in_groupsA[Z].nsid==I&&(in_groupsA[Z].status==1||in_groupsA[Z].status==2)){x=true;}}}if(A=="sendToGroup"&&x){c.make_me_for_removing();}else{if(A=="sendToSet"&&(_ge(P)&&_ge(P).style.display=="block"||nextprev_currentContextID==s+I)||m.new_set_id_passthrough==I){c.make_me_for_removing();}else{c.make_me_for_adding();}}_page_timer.add("after handle one");}_page_timer.add("after collection iteration");if(B<J){m.page=B+1;F.API.callMethod(m.method,m,this);return ;}_ge(q+"ListDiv").parentNode.style.display="block";if(F.is_ie){_ge(q+"ListDiv").style.height="auto";var Q=_ge(q+"ListDiv").offsetHeight;if(Q&&Q>220){_ge(q+"ListDiv").style.height="220px";}}_ge(q+"HeaderDiv").innerHTML=O.get_click_a_text();}_ge(q+"BottomDiv").style.display="block";_page_timer.dump(G);};O.flickr_printing_getProducts_onLoad=function(X,o,B,K){if(!X){alert(F.output.get("api_err_generic")+" "+B);}calculate_photo_props(H);var e=global_photos[H];var W=o.documentElement.getElementsByTagName("product");if(W.length==0){hide_printDialog();return false;}else{window.page_print_prices={};O.productsO={};for(var c=0;c<W.length;c++){var l=W[c];var h=l.getAttribute("id");var P=l.getAttribute("price");var Z=l.getAttribute("name");var v=l.getAttribute("description");var t=l.getAttribute("minresx")*1;var r=l.getAttribute("minresy")*1;var E=l.getAttribute("aspect")*1;var s=l.getAttribute("panorama")*1;var R=0;if(e.huge){if(F.array_index_of(global_huge_photo_print_ids,h)>-1){R=1;}}else{if(F.array_index_of(global_wallet_photo_print_ids,h)>-1){R=1;}}if(e.square){if(F.array_index_of(global_square_photo_print_ids,h)>-1){R=1;}}if(e.dig_dims){if(F.array_index_of(global_dig_photo_print_ids,h)>-1){R=1;}}else{if(F.array_index_of(global_reg_photo_print_ids,h)>-1){R=1;}}writeDebug("min rec size:"+t+"x"+r+" size:"+e.o_w+"x"+e.o_h);if(E==1){var Q=(Math.min(e.o_w,e.o_h)>=t)?1:0;}else{var Q=(Math.max(e.o_w,e.o_h)>=Math.max(t,r)&&Math.min(e.o_w,e.o_h)>=Math.min(t,r))?1:0;}writeDebug("recommended:"+Q);O.productsO["prod"+h]={id:h,name:Z.replace("Digital Aspect",""),description:v,price:P,recommended:Q,show:R,minresx:t,minresy:r};page_print_prices["prod"+h]=P.replace(".","");}}O.show_printing_products();};O.flickr_printing_setPrefs_onLoad=function(r,X,o,s){if(r){F.API.callMethod("flickr.printing.getProviders",{country_code:page_printing_country_code},O);}else{alert(F.output.get("api_err_generic")+" "+o);}};O.flickr_printing_getProviders_onLoad=function(t,r,o,X){if(t){var s=r.documentElement.getElementsByTagName("provider");if(s.length==0){page_printing_provider=0;}else{page_printing_provider=s[0].getAttribute("id");}if(!page_printing_provider||page_printing_provider=="0"){O.show_no_providers();}else{O.show_printing_products();}}else{alert(F.output.get("api_err_generic")+" "+o);}};O.show_print_screen_changing=function(o){_ge(q+"HeaderDiv").innerHTML="<br>"+o+"<br><br>";_ge(q+"ListDiv").parentNode.style.display="none";};O.set_country_select=function(t){if(!t){t=0;}var X=_ge("country");if(!X){return ;}for(var s=0;s<X.options.length;s++){var r=X.options[s];if(t==r.value){X.selectedIndex=s;return ;}}};O.show_no_providers=function(){_ge(q+"HeaderDiv").innerHTML=F.output.get("photo_apologize");_ge(q+"HeaderDiv").style.display="none";_ge(q+"ListWrapperDiv").style.border="0px solid red";_ge("choose_a_country_div").style.display="none";if(O.no_providers_text==undefined){O.no_providers_text=_ge("no_providers_div").innerHTML;}var o=function(s){s=s.replace("REP_COUNTRY",page_printing_country_name);return s;};_ge("no_providers_div").innerHTML=o(O.no_providers_text);_ge("no_providers_div").style.display="block";_ge(q+"ListDiv").parentNode.style.display="block";};O.show_country_form=function(){_ge(q+"HeaderDiv").innerHTML=F.output.get("photo_first_things_first");_ge(q+"HeaderDiv").style.display="none";_ge(q+"ListWrapperDiv").style.border="0px solid red";_ge("no_providers_div").style.display="none";_ge("print_form").style.display="none";O.set_country_select(page_printing_country_code);var o=_ge("country_submit");var s=_ge("country_form");if(s){s.onsubmit=o.onclick=function(){var r=s.country.selectedIndex;if(s.country.options[r].value==0){return false;}O.show_print_screen_changing(F.output.get("photo_setting_country"));page_printing_country_code=s.country.options[r].value;page_printing_country_name=s.country.options[r].text;F.API.callMethod("flickr.printing.setPrefs",{country_code:page_printing_country_code},O);};var X=_ge("country");X.onchange=function(){if(navigator.userAgent.indexOf("KHTML")==-1){o.focus();}};}_ge("choose_a_country_div").style.display="block";_ge(q+"ListDiv").parentNode.style.display="block";if(s){if(navigator.userAgent.indexOf("KHTML")==-1){X.focus();}}};O.show_all_printing_products=function(){printDialogDiv.style.display="none";for(p in O.productsO){var o=O.productsO[p];if(o.show){continue;}_ge("prod_"+o.id+"_tr").style.display=(F.is_ie)?"block":"table-row";if(!o.recommended){_ge("print_not_rec_tr").style.display=(F.is_ie)?"block":"table-row";}}show_printDialog(H);};O.show_printing_products=function(){if(O.productsO==undefined){F.API.callMethod("flickr.printing.getProducts",{provider_id:page_printing_provider},O);return ;}_ge(q+"HeaderDiv").innerHTML=O.get_click_a_text();_ge(q+"HeaderDiv").style.display="block";_ge("choose_a_country_div").style.display="none";_ge("no_providers_div").style.display="none";var r=_ge("print_product_tr");var t=r.parentNode;var e=function(v,P){var l=P.description+" "+F.output.get("photo_we_recommend",P.minresx,P.minresy);global_js_tip_count++;var c=F.get_tip_html(l,"js_tooltip_"+global_js_tip_count,"tip_print_menu");v=v.replace("REP_TIP",c);v=v.replace("REP_NAME",P.name);v=v.replace("REP_PRODUCT","prod"+P.id);v=v.replace("REP_PRICE",P.price);return v;};for(p in O.productsO){var Q=O.productsO[p];var h=document.createElement("tr");h.id="prod_"+Q.id+"_tr";if(!Q.show){h.style.display="none";}var X=document.createElement("td");X.className="print_dropdown_td";X.innerHTML=e(r.childNodes[0].innerHTML,Q);h.appendChild(X);var s=document.createElement("td");s.className=(Q.recommended)?"print_item_td":"print_item_notrec_td";s.innerHTML=e(r.childNodes[1].innerHTML,Q);h.appendChild(s);var o=document.createElement("td");o.className=(Q.recommended)?"print_price_td":"print_price_notrec_td";o.innerHTML=e(r.childNodes[2].innerHTML,Q);h.appendChild(o);if(Q.recommended){t.insertBefore(h,_ge("print_not_rec_tr"));}else{if(Q.show){_ge("print_not_rec_tr").style.display=(F.is_ie)?"block":"table-row";}t.appendChild(h);}}var B=_ge("print_cancel");var E=_ge("print_add");var W=_ge("print_form");W.clear=function(){for(var P=0;P<W.elements.length;P++){if(W.elements[P].type=="select-one"){W.elements[P].selectedIndex=0;}}update_print_prices();};page_print_orderA=[];B.onclick=hide_printDialog;E.onclick=function(){page_print_orderA=[];for(var P=0;P<W.elements.length;P++){if(W.elements[P].type=="select-one"){if(W.elements[P].value*1>0){writeDebug("print_form.elements[i].value "+W.elements[P].value);page_print_orderA.push(W.elements[P].name+":"+W.elements[P].value);}}}if(page_print_orderA.length>0){O.send_to_action(H,"cart","add");}return false;};if(_ge("change_country_link2")){_ge("change_country_link2").onclick=function(){O.show_country_form();return false;};}if(_ge("more_print_options")){_ge("more_print_options").onclick=function(){this.style.display="none";O.show_all_printing_products();return false;};}_ge("print_form").style.display="block";_ge(q+"ListDiv").parentNode.style.display="block";};O.print_fragment_onLoad=function(X,o,s){_ge(q+"ListDiv").innerHTML=o;if(page_printing_provider&&page_printing_provider!="0"){O.show_printing_products();}else{if(page_printing_country_code!=""){O.show_no_providers();}else{O.show_country_form();}}};if(A=="print"){var i={photo_id:H};if(page_zazzle_url!=undefined){i["zazzle_url"]=page_zazzle_url;}if(page_qoop_url!=undefined){i["qoop_url"]=page_qoop_url;}if(page_hp_url!=undefined){i["hp_url"]=page_hp_url;}F.fragment_getter.get("/photo_print_fragment.gne",i,O,"print_fragment_onLoad");}else{F.API.callMethod(U,{},O);}};make_menu_item=function(g,A,d,O,H,u,N,U){var q=(F.is_ie)?217:220;var L=document.createElement("DIV");L.id="add_to_"+g+"_"+A+"_div";L.style.marginTop=O;L.highlight=function(){this.style.backgroundColor="#0063DC";_ge("add_to_"+g+"_"+A+"_td").style.color="#fff";};L.unhighlight=function(){this.style.backgroundColor="transparent";_ge("add_to_"+g+"_"+A+"_td").style.color="#0063DC";};L.add_action=function(){window[U+"Div"].send_to_action(A,d,"add");};L.remove_action=function(){window[U+"Div"].send_to_action(A,d,"remove");};L.confirm_remove=function(){window["hide_"+U]();var a=function(){L.remove_action();};var w=_ge("photo_notes");w.start_comming(F.output.get("photo_are_you_sure",d),1,1,F.output.get("yes_up"),a,1,F.output.get("cancel"),null);};L.make_me_for_removing=function(){this.unhighlight();this.style.cursor="default";_ge("add_to_"+g+"_"+A+"_td").style.color="#999";if(g=="set"){remove_link="<a title=\""+F.output.get("photo_remove_from_set",d.replace("<","&lt;").replace("\"","&quot;"))+"\" class=\"remove_thing\" href=\"\" onclick=\"_ge('"+L.id+"').confirm_remove();return false;\">[X]</a>";}else{if(g=="group"){remove_link="<a title=\""+F.output.get("photo_remove_from_pool",d.replace("<","&lt;").replace("\"","&quot;"))+"\" class=\"remove_thing\" href=\"\" onclick=\"_ge('"+L.id+"').confirm_remove();return false;\">[X]</a>";}}_ge("add_to_"+g+"_"+A+"_td").innerHTML=d.truncate_with_ellipses(25)+" "+remove_link;this.onmouseout=null;this.onmouseover=null;this.onclick=null;};L.make_me_for_adding=function(){this.unhighlight();this.style.cursor=(F.is_ie)?"hand":"pointer";_ge("add_to_"+g+"_"+A+"_td").style.color="#0063DC";_ge("add_to_"+g+"_"+A+"_td").innerHTML="<span>"+d.truncate_with_ellipses(31)+"</span>";this.onmouseout=this.unhighlight;this.onmouseover=this.highlight;this.onclick=this.add_action;};var i="";i+="<table border=\"0\" cellspacing=\"0\" cellpadding=\"0\" width=\""+q+"\"><tr>";i+="<td valign=\"top\" style=\"padding:0; width:"+(u+7)+"px;\">";i+="<img src=\""+H+"\" width=\""+u+"\" height=\""+N+"\" style=\"border:0; display:block; margin: 2px 0 2px 2px;\"></td>";i+="<td id=\"add_to_"+g+"_"+A+"_td\">";i+="</td></tr></table>";L.innerHTML=i;return L;};remove_context_widget=function(g,u){if(g=="pool"){for(var O=0;O<in_groupsA.length;O++){if(in_groupsA[O].nsid==u){in_groupsA[O].status=0;break;}}}var U=_ge("contextDiv_"+g+u);if(U){U.style.display="none";if(nextprev_currentContextID==g+u){var A=_ge("nextprev_button_stream"+global_nsid);if(A&&!A.isOpen){A.handle_click();}}var d=_ge("other_contexts_p");var H=Y.U.Dom.getElementsByClassName("contextDiv","DIV");var q=0;for(var O=0;O<H.length;O++){if(H[O].style.display=="block"&&H[O].parentNode==d.parentNode){q++;break;}}if(!q){d.style.display="none";}}};add_context_widget=function(L,O,H,u){if(u==null){u=false;}if(L=="pool"){var g=false;for(var U=0;U<in_groupsA.length;U++){if(in_groupsA[U].nsid==O){in_groupsA[U].status=(u)?2:1;g=true;break;}}if(!g){in_groupsA.push(new in_groupsObj(O,(u)?2:1));}}if(u==true){return ;}var A=_ge("contextDiv_"+L+O);var d=_ge("other_contexts_p");d.style.display="block";if(A){A.style.display="block";if(nextprev_currentContextID==L+O){var q=_ge("nextprev_button_stream"+global_nsid);if(q&&q.isOpen){q.handle_mouseup();q.handle_mouseout();}}}else{d.add_context_widget=function(o,N,w){if(N==""){return ;}if(N.indexOf("id=\"contextLink_\"")>0){return ;}var i=document.createElement("div");i.id="contextDiv_"+L+O;i.style.display="block";i.innerHTML=N;var a=this.parentNode.getElementsByTagName("DIV");if(a.length>0){this.parentNode.insertBefore(i,a[0]);}else{this.parentNode.appendChild(i);}F.decorate(_ge("nextprev_button_"+L+O),F._nextprev_button).button_go_go_go(L,O,H);};F.fragment_getter.get("/photo_context_fragment.gne",{photo_id:H,context_type:L,context_id:O},d,"add_context_widget");}};increment_print_dropdown=function(H){var O=_ge(H);var d=O.selectedIndex;d++;if(d>=O.options.length){for(var u=0;u<10;u++){O.options.length++;O.options[O.options.length-1].value=O.options[O.options.length-1].text=O.options.length-1;}}O.selectedIndex=d;update_print_prices(H);};decrement_print_dropdown=function(u){var O=_ge(u);var d=O.selectedIndex;d--;if(d<0){return ;}O.selectedIndex=d;update_print_prices(u);};format_price=function(O){var d=O/100;if(d==0){d="0.00";}else{if(d<1){d=d.toString();}}dpA=d.toString().split(".");if(dpA.length==1){d=d.toString()+".00";}else{if(dpA[1].length==1){d=d.toString()+"0";}}d="$ "+d;return d;};update_print_prices=function(U){var O=_ge("print_form");var A=_ge("price_print_total_td");var u=0;for(var d=0;d<O.elements.length;d++){if(O.elements[d].type=="select-one"){if(O.elements[d].value*1>0){var H=page_print_prices[O.elements[d].name];u=u+(H*O.elements[d].value);}}}var q=format_price(u);if(u>0){q="<nobr><b>"+q+"</b></nobr>";if(O.last_total!=u){anim_do_blink_pink(A);}}else{A.style.color="rgb(0, 0, 0)";}A.innerHTML=q;O.last_total=u;};var place_notes_text_div=function(d){if(!F.is_ie){return ;}var O=_ge("photo_notes");if(O){O.place_notes_text_div();_set_single_shadow_height(_ge("notes_text_table"));}return ;};var adjust_textarea_height=function(O){return ;temp_div.innerHTML=O.value.replace("<","&lt;").replace("\n","<br>")+"g";O.style.height=(temp_div.offsetHeight)+"px";return ;if(O.scrollHeight>O.clientHeight){O.style.height=O.scrollHeight;}};function show_notes_initially(){if(window.should_I_ignore_stuff_because_of_button_action||window.should_I_ignore_stuff_because_of_editable_div_action){return ;}var O=_ge("photo_notes");if(O&&O.p_id){O.shown_initially=1;O.style.visibility="visible";if(!O.tried_to_show_before_shown_initially){O.go_away_in_a_bit();}}}function calculate_photo_props(O){var H=global_photos[O];if(!H){return ;}var d=Math.max(H.o_w,H.o_h);var u=Math.min(H.o_w,H.o_h);H.aspect=d/u;H.panorama=(H.aspect>=2)?1:0;H.dig_dims=(H.aspect<1.36)?1:0;H.square=(H.aspect>0.96&&H.aspect<1.04)?1:0;H.small=(d<=1024)?1:0;H.huge=(u>=3000&&d>=4500)?1:0;if(writeDebug){writeDebug("aspect "+H.aspect);}if(writeDebug){writeDebug("panorama "+H.panorama);}if(writeDebug){writeDebug("dig_dims "+H.dig_dims);}if(writeDebug){writeDebug("square "+H.square);}if(writeDebug){writeDebug("small "+H.small);}if(writeDebug){writeDebug("huge "+H.huge);}}function ok_accept(O,d){_ge("div_invite_confirm_"+O).style.display="none";_ge("div_invite_confirm_loading_"+O).style.display="block";var u={flickr_groups_invite_photo_accept_onLoad:function(N,L,U,g){if(N){add_context_widget("pool",d,page_photo_id,false);_ge("div_invite_confirm_"+O).style.display="none";_ge("div_invite_confirm_loading_"+O).style.display="none";_ge("div_invite_confirm_hooray_"+O).style.display="block";in_groupsA.push(new in_groupsObj(d,1));var i=_ge("add_to_group_"+d+"_div");if(i){i.make_me_for_removing();}}else{var A=L.documentElement.getElementsByTagName("err")[0];if(A){var q=A.getAttribute("msg");if(photo_notes&&photo_notes.stop_comming){photo_notes.stop_comming(1);}photo_notes.start_comming(F.output.get("api_err_generic")+" "+q.escape_for_display(),1,1);_ge("div_invite_confirm_"+O).style.display="block";_ge("div_invite_confirm_loading_"+O).style.display="none";}}}};var H=new Object();H.user_id=global_nsid;H.photo_id=page_photo_id;H.comment_id=O;H.group_id=d;F.API.callMethod("flickr.groups.invite.photo.accept",H,u,null,null,0);}function no_deny(O,d){_ge("div_invite_confirm_"+O).style.display="none";var u={flickr_groups_invite_photo_decline_onLoad:function(L,g,A,q){if(L){}else{var i=g.documentElement.getElementsByTagName("err")[0];if(i){var U=i.getAttribute("msg");if(photo_notes&&photo_notes.stop_comming){photo_notes.stop_comming(1);}photo_notes.start_comming(F.output.get("api_err_generic",A.escape_for_display()),1,1);}}}};var H=new Object();H.user_id=global_nsid;H.photo_id=page_photo_id;H.comment_id=O;H.group_id=d;F.API.callMethod("flickr.groups.invite.photo.decline",H,u,null,null,0);}function admin_group_obj(O,u,d){this.nsid=O;this.title=u;this.status=d;}function new_admin_group_obj(O,u,d){this.nsid=O;this.title=u;this.status=d;}F._admin_group_loader={admin_group_loader_go_go_go:function(){this.old_group_nsid=null;this.old_group_title=null;this.old_comment_block="";this.first_time=true;this.style.display="block";this.admin_groups=new Array();F.decorate(_ge("a_group_loader"),F.admin_group_invite_clicker);F.decorate(_ge("div_invite_list_loading"),F.admin_group_loading);F.decorate(_ge("div_invite_dropdown"),F.admin_group_dropdown_div).admin_group_dropdown_div_go_go_go();var O=false;if(_ge("hdn_group_invite")&&_ge("hdn_group_invite").value.length>0){_ge("div_invite_loader").admin_groups=JSON.parse(_ge("hdn_group_details").value);var u=_ge("div_invite_loader").admin_groups;_ge("slct_invite_to_group").options[0]=new Option(F.output.get("photo_select_a_group"),"");_ge("slct_invite_to_group").options[1]=new Option("--------------","");for(var d=0;d<u.length;d++){if(u[d].status=="1"){_ge("slct_invite_to_group").options[d+2]=new Option(u[d].title,u[d].nsid);}else{_ge("slct_invite_to_group").options[d+2]=new Option(u[d].title+" ("+F.output.get("photo_already_invited")+")","");_ge("slct_invite_to_group").options[d+2].style.color="silver";}_ge("slct_invite_to_group").options[d+2].id=u[d].status;if(u[d].nsid==_ge("hdn_group_invite").value){_ge("slct_invite_to_group").options[d+2].selected=true;_ge("div_invite_loader").old_group_nsid=u[d].nsid;_ge("div_invite_loader").old_group_title=u[d].title;O=true;}}}if(O){_ge("div_pre_invite").style.display="none";_ge("div_invite_list_loading").style.display="none";_ge("div_invite_dropdown").style.display="block";_ge("chk_invite_to_group").checked=true;}},load_groups:function(){_ge("div_invite_list_loading").load_admin_groups();},set_invite:function(u){var O=F.output.get("page_photo_hi_im_admin",_site_root,this.old_group_nsid,this.old_group_title);if(u>=0&&this.admin_groups[u].status=="1"){var d=F.output.get("page_photo_hi_im_admin",_site_root,this.admin_groups[u].nsid,this.admin_groups[u].title);this.old_group_nsid=this.admin_groups[u].nsid;this.old_group_title=this.admin_groups[u].title;}if(_ge("message").value.indexOf(O)>=0&&u<0){_ge("message").value=_ge("message").value.replace(O,"");}else{if(_ge("message").value.indexOf(O)>=0){_ge("message").value=_ge("message").value.replace(O,d);this.old_comment_block=_ge("message").value;}else{if(_ge("message").value==this.old_comment_block||_ge("message").value==""){_ge("message").value=d;this.old_comment_block=_ge("message").value;}else{if(this.first_time){_ge("message").value=d+String.fromCharCode(13)+String.fromCharCode(13)+_ge("message").value;this.old_comment_block=_ge("message").value;}}}}_ge("message").value=_ge("message").value.replace("undefined","");this.first_time=false;if(u>=0&&this.admin_groups[u].status=="1"){_ge("hdn_group_invite").value=this.admin_groups[u].nsid;_ge("hdn_group_old_nsid").value=this.admin_groups[u].nsid;_ge("hdn_group_old_title").value=this.admin_groups[u].title;}else{_ge("hdn_group_invite").value="";_ge("hdn_group_old_nsid").value="";_ge("hdn_group_old_title").value="";}}};F.admin_group_invite_clicker={onclick:function(){_ge("div_pre_invite").style.display="none";_ge("div_invite_loader").load_groups();return false;}};F.admin_group_loading={load_admin_groups:function(){var O={flickr_groups_getAdministeredGroups_onLoad:function(w,a,L,U){if(w){_ge("div_invite_list_loading").admin_groups=new Array();var u=a.getElementsByTagName("group");for(var q=0;q<u.length;q++){var g=u[q].getAttribute("nsid");var N=u[q].getAttribute("title");var A=u[q].getAttribute("able_to_invite_photo");var H=new new_admin_group_obj(g,N,A);_ge("div_invite_loader").admin_groups.push(H);}if(_ge("div_invite_loader").admin_groups.length>0){_ge("div_invite_dropdown").render_dropdown();_ge("hdn_group_details").value=JSON.stringify(_ge("div_invite_loader").admin_groups);return ;}}_ge("div_invite_list_loading").style.display="none";_ge("div_pre_invite").style.display="block";}};if(_ge("div_invite_loader").admin_groups.length==0){this.style.display="block";var d=new Object();d.user_id=global_nsid;d.photo_id=page_photo_id;F.API.callMethod("flickr.groups.getAdministeredGroups",d,O,null,null,0);}else{_ge("div_invite_dropdown").render_dropdown();}}};F.admin_group_dropdown_div={admin_group_dropdown_div_go_go_go:function(){F.decorate(_ge("chk_invite_to_group"),F.chk_invite_to_group);F.decorate(_ge("slct_invite_to_group"),F.slct_invite_to_group);if(_ge("slct_invite_to_group")&&_ge("hdn_group_details")){_ge("slct_invite_to_group").innerHTML=_ge("hdn_group_details").value;}},render_dropdown:function(){var d=_ge("div_invite_loader").admin_groups;if(d.length==0){_ge("div_pre_invite").style.display="block";_ge("div_invite_list_loading").style.display="none";this.style.display="none";return ;}_ge("div_pre_invite").style.display="none";_ge("div_invite_list_loading").style.display="none";_ge("slct_invite_to_group").options.length=0;_ge("slct_invite_to_group").options[0]=new Option(F.output.get("photo_select_a_group"),"");_ge("slct_invite_to_group").options[1]=new Option("--------------","");for(var O=0;O<d.length;O++){if(d[O].status=="1"){_ge("slct_invite_to_group").options[O+2]=new Option(d[O].title,d[O].nsid);}else{_ge("slct_invite_to_group").options[O+2]=new Option(d[O].title+" ("+F.output.get("photo_already_invited")+")","");_ge("slct_invite_to_group").options[O+2].style.color="silver";}_ge("slct_invite_to_group").options[O+2].id=d[O].status;}_ge("chk_invite_to_group").checked=true;this.style.display="block";}};F.chk_invite_to_group={onchange:function(){if(!this.checked){_ge("div_pre_invite").style.display="block";_ge("div_invite_list_loading").style.display="none";_ge("div_invite_dropdown").style.display="none";_ge("hdn_group_invite").value="";_ge("slct_invite_to_group").options.selectedIndex=0;var O=F.output.get("page_photo_hi_im_admin",_site_root,_ge("div_invite_loader").old_group_nsid,_ge("div_invite_loader").old_group_title);if(_ge("message").value.indexOf(O)>=0){_ge("message").value=_ge("message").value.replace(O,"");}}},onclick:function(){this.onchange();}};F.slct_invite_to_group={onchange:function(){this.check_value();},onkeyup:function(){this.check_value();},check_value:function(){_ge("div_invite_loader").set_invite(this.selectedIndex-2);}};function script_has_loaded(){}F.picnik={loadSwfObjJs:function(){if(!this.swfJsWritten){this.loadJs(page_p.swfObjSrc);this.swfJsWritten=true;}return (window.SWFObject)?true:false;},loadUrlkitJs:function(){if(!this.urlkiJsWritten){this.loadJs(picnik_urlkit_path);this.urlJsWritten=true;}},loadJs:function(d){var O=document.createElement("script");O.src=d;O.type="text/javascript";document.getElementsByTagName("head")[0].appendChild(O);writeDebug("picnik js source: "+O.src);},initSwf:function(){if(!this.p_div){this.header_height=35;this.p_div=document.createElement("div");this.p_div.id="picnik-div";var A=document.createElement("div");A.id="picnik-div-header";A.style.height=this.header_height+"px";var u=document.createElement("div");u.id="picnik-div-header-inner";A.appendChild(u);var i=_ge("FlickrLogo").cloneNode(true);i.id="FlickrLogo2";u.appendChild(i);var d=document.createElement("span");var H=document.createTextNode(F.output.get("picnik_mode"));d.appendChild(H);u.appendChild(d);this.p_swf_cont=document.createElement("div");this.p_swf_cont.id="picnik-cont";this.p_swf_cont.style.height=(Y.U.Dom.getViewportHeight()-this.header_height)+"px";this.p_div.appendChild(A);this.p_div.appendChild(this.p_swf_cont);this.p_div.style.height=Math.max(document.body.offsetHeight,document.body.scrollHeight)+"px";this.p_div.style.width="100%";this.p_div.style.position="absolute";this.p_div.style.top="0px";this.p_div.style.left="0px";document.getElementsByTagName("body")[0].appendChild(this.p_div);var O=deconcept.SWFObjectUtil.getPlayerVersion();if(O.major<9){Y.U.Dom.addClass(this.p_swf_cont,"picnik_no_flash");this.p_swf_cont.innerHTML=F.output.get("picnik_no_flash");}else{this.writeSwf();}}else{this.writeSwf();this.p_div.style.top="0px";this.p_div.style.left="0px";}Y.U.Event.addListener(window,"resize",this.resize,this);},writeSwf:function(){var O=new SWFObject(picnik_swf_path,"picnik","100%","100%","9.0.28","#ffffff",true);O.addParam("allowFullScreen","true");O.addParam("allowScriptAccess","always");O.addVariable("serverurl","http://www.picnik.com");O.addVariable("loglevel","30");O.addVariable("lite","true");O.addVariable("host","Flickr lite");O.addVariable("authservice","Flickr");O.addVariable("userid",global_nsid);O.addVariable("token",picnik_token);O.addVariable("_ss_itemid",page_photo_id);O.addVariable("_ss_setid",picnik_set_id);if(O.write(this.p_swf_cont)){var d=new SWFMacMouseWheel(O);}F.changes_count=true;},go_go_go:function(){if(picnik_token){this.show();}else{F.fragment_getter.get("/photo_picnik_auth_fragment.gne",{},this,"fragment_onLoad");}},fragment_onLoad:function(i,d,H){this.lightBoxBg=_ge("contactChangerBackground");this.lightBox=document.createElement("div");this.lightBox.style.position="absolute";var O=500;var u=290;this.lightBox.style.width=O+"px";this.lightBox.style.height=u+"px";this.lightBox.style.top=((Y.U.Dom.getViewportHeight()/2)-(u/2))-30;this.lightBox.style.left=(Y.U.Dom.getViewportWidth()/2)-(O/2);this.lightBox.style.zIndex=20001;this.lightBoxBg.style.display="block";document.getElementsByTagName("body")[0].appendChild(this.lightBox);this.lightBox.innerHTML=d;},resize:function(d,O){O.p_div.style.height=(Y.U.Dom.getViewportHeight()-O.header_height)+"px";},show:function(){if(this.loadSwfObjJs()){this.initSwf();this.loadUrlkitJs();}else{setTimeout(function(){F.picnik.show();},300);}},doAuth:function(){window.page_always_post_fragment_requests=true;F.fragment_getter.get("/services/auth/picnik.gne",{"magic_cookie":global_auth_hash},this,"digestAuthResponse");},digestAuthResponse:function(success,responseText,params){var rsp=eval("("+responseText+")");this.lightBox.style.display="none";this.lightBoxBg.style.display="none";if(rsp.picnik_auth.stat){picnik_token=rsp.picnik_auth.token;this.go_go_go();}else{F.photo_confirm_msg.add(1,F.output.get("picnik_auth_fail"));}},cancelAuth:function(){this.lightBoxBg.style.display="none";this.lightBox.style.display="none";F.photo_confirm_msg.add(1,F.output.get("picnik_cancel_auth"));},its_raining:function(O){writeDebug("its_raining response: "+O);F.changes_count=false;if(O){if(O==page_photo_id){window.location.replace(page_p.url+"?editreplace=1");}else{window.location.href=page_p.ownersUrl+O+"/?eOrig="+page_photo_id;}}else{this.p_div.style.top="-9999px";this.p_div.style.left="-9999px";F.photo_confirm_msg.add(1,F.output.get("picnik_cancel_edit"));}}};F.photo_confirm_msg={add:function(O,H){this.remove();var d=document.createElement("p");d.id="photo_confirm_msg_p";d.className=(O)?"Confirm":"Problem";if(H){d.innerHTML=H;}var u=_ge("Photo");u.parentNode.insertBefore(d,u);},remove:function(){var O=_ge("photo_confirm_msg_p");if(O){O.parentNode.removeChild(O);}}};F._photo_notes={notes_go_go_go:function(i,a,x){var K=this;this.hex_colors={yellow:"#ffffd3",green:"#d0fdaf"};this.isOver=this.editing=this.dragging=0;this.hide_while_dragging=0;this.which_note=null;this.p_id=i;this.rotate_version=x;this.thumb_url=a+"?cb="+new Date().getTime();var g=_ge("photoImgDiv"+i);g.onmouseover=function(){K.onmouseover();};g.onmouseout=function(L){var d=_get_event_src(L);if(window.should_I_ignore_stuff_because_of_button_action||window.should_I_ignore_stuff_because_of_editable_div_action||global_comm_div.comming){return ;}_ge("photo_notes").hide_tim=setTimeout("_ge('photo_notes').take_her_away('photo_div.onmouseout timer');",200);};var Z=_ge("notes_text_div");Z.style.zIndex="1000";Z.style.display="none";Z.style.width="220px";Z.style.position="relative";var M="<table cellpadding=\"0\" cellspacing=\"0\" border=\"0\" style=\"padding:0px;\" id=\"notes_text_table\">"+"<tr><td><img width=\"3\" height=\"3\" src=\""+_images_root+"/tc_yellow_tl.gif\"></td><td class=\"td_note_yeller\"></td><td><img width=\"3\" height=\"3\" src=\""+_images_root+"/tc_yellow_tr.gif\"></td></tr>"+"<tr><td class=\"td_note_yeller\"></td>"+"<td class=\"td_note_yeller\" style=\"padding:3px\">"+"<span id=\"notes_text_span\" style=\"font-family:arial; font-size:12px;\"></span>"+"<form id=\"notes_text_form\"><input type=\"hidden\" name=\"magic_cookie\" value=\""+global_auth_hash+"\" />"+"<textarea onkeydown=\"_limit_textarea(this, 300); _ge('photo_notes').check_note_for_prop()\" onkeyup=\"place_notes_text_div(); adjust_textarea_height(this); _limit_textarea(this, 300); _ge('photo_notes').check_note_for_prop()\" id=\"notes_text_area\" rows="+1+"; style=\"overflow:visible; width: 200px; font-family:arial; font-size:12px; padding:0px; border:0px inset #e9e9ae; background-color:#ffffd3;\" wrap=\"virtual\"></textarea>"+"</form>"+"</td><td class=\"td_note_yeller\"></td></tr>"+"<tr><td><img width=\"3\" height=\"3\" src=\""+_images_root+"/tc_yellow_bl.gif\"></td><td class=\"td_note_yeller\"></td><td><img width=\"3\" height=\"3\" src=\""+_images_root+"/tc_yellow_br.gif\"></td></tr></table>"+"<form id=\"notes_text_buttons_form\">"+"<input type=\"button\" class=\"Butt\" value=\""+F.output.get("save")+"\" onclick=\"_ge('photo_notes').save_editing(); this.blur();\" style=\"margin:5px 5px 0 0;\">"+"<input type=\"button\" class=\"CancelButt\" value=\""+F.output.get("cancel")+"\" onclick=\"_ge('photo_notes').cancel_editing(); this.blur();\" style=\"margin:5px 5px 0 0;\">"+"<input type=\"button\" class=\"CancelButt\" value=\""+F.output.get("deletee")+"\" id=\"delete_note_button\" onclick=\"_ge('photo_notes').delete_note(); this.blur();\" style=\"margin:5px 5px 0 0;\">"+"</form><div id=\"temp_div\" style=\"visibility:hidden;\"></div>";Z.innerHTML=M;var z=_ge("notes_text_table");z.onmouseover=function(){if(K.editing){return ;}if(K.which_note){clearTimeout(K.which_note.hide_timmy);}};z.onmouseout=function(d){if(K.editing){return ;}if(K.which_note){K.which_note.handle_mouseout();}};z.onmouseup=function(L){if(K.editing){return ;}var d=_get_event_src(L);if(d&&_el_is_in_a_link(d)){return ;}if(K.which_note&&K.which_note.can_edit){K.which_note.editing=1;K.which_note.change_display();K.start_editing_one(K.which_note);}};var e=_ge("notes_text_area");if(!F.is_ie||navigator.userAgent.indexOf("Opera")!=-1){e.style.height="58px";}window.temp_div=_ge("temp_div");temp_div.style.width=e.style.width;var f=_ge("rotate_div");f.style.zIndex="1003";f.style.display="none";var M="<table id=\"rotate_table\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" style=\"width:218px; padding:0px;\">"+"<tr><td width=\"3\"><img width=\"3\" height=\"3\" src=\""+_images_root+"/tc_white_tl.gif\"></td><td class=\"td_note_white\"></td><td width=\"3\"><img width=\"3\" height=\"3\" src=\""+_images_root+"/tc_white_tr.gif\"></td></tr>"+"<tr><td class=\"td_note_white\"></td>"+"<td class=\"td_note_white\" style=\"padding:0px; height:155px\"><span id=\"rotate_span\" style=\"font-family:arial; font-size:12px;\"></span>"+"</td><td class=\"td_note_white\"></td></tr>"+"<tr><td><img width=\"3\" height=\"3\" src=\""+_images_root+"/tc_white_bl.gif\"></td><td class=\"td_note_white\"></td><td><img width=\"3\" height=\"3\" src=\""+_images_root+"/tc_white_br.gif\"></td></tr></table>";f.innerHTML=M;_make_comm_div("1002");global_comm_div.button_cancel.onclick_plus=global_comm_div.button_ok.onclick_plus=function(){_ge("photo_notes").stop_comming();};window.hide_rotate_div=function(){K.hide_rotate_div();};window.save_rotation=function(d){K.save_rotation(d);};this.restack_notes();},onmouseover:function(){clearTimeout(this.hide_tim);if(!this.shown_initially){this.tried_to_show_before_shown_initially=1;return ;}if(window.should_I_ignore_stuff_because_of_button_action||window.should_I_ignore_stuff_because_of_editable_div_action||global_comm_div.comming){return ;}this.isOver=1;this.change_display();},go_away_in_a_bit:function(){this.hide_tim=setTimeout("_ge('photo_notes').take_her_away('go_away_in_a_bit');",3000);},restack_notes:function(){var x=function(M){return M.box.w*M.box.h;};var a=function(e,K){var M=x(e);var i=x(K);return (M<i)?1:((M>i)?-1:0);};var Z=global_photos[this.p_id].notesA;Z.sort(a);for(var g=0;g<Z.length;g++){var z=_ge("photo_note_"+Z[g].id);if(z){this.appendChild(F.prepare_for_insertion(z));}}},take_her_away:function(Z){clearTimeout(this.hide_tim);if(this.editing||global_comm_div.comming||this.dragging){return ;}this.isOver=0;this.stop_showing_one("take_her_away "+Z);this.change_display();},show_rotate_div:function(z){var g=_ge("rotate_div");if(g.style.display!="none"){return ;}g.style.display="block";g.style.visibility="hidden";global_single_shadow_div.style.visibility="hidden";this.button_acting=z;var Z=_pi((this.get_image_w()-_pi(_ge("rotate_table").offsetWidth))/2);var K=_pi((this.get_image_h()-150)/2);if(K<10){K=10;}if(Z<10){Z=10;}g.style.marginLeft=Z+"px";g.style.marginTop=K+"px";var a="/apps/rotate/rotate.swf?cancel_str="+escape_utf8(F.output.get("cancel_up"))+"&ok_str="+escape_utf8(""+F.output.get("ok")+"  ")+"&thumb_url="+this.thumb_url+"&v="+this.rotate_version+"&cb="+new Date().getTime();this.take_her_away("show_rotate_div");window.should_I_ignore_stuff_because_of_button_action=1;if(!this.rotate_swf_html){var M="<OBJECT classid=\"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000\" codebase=\"http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,0,0\" ";M+="WIDTH=\"212\" HEIGHT=\"145\" id=\"photo\" ALIGN=\"\">";M+="<PARAM NAME=movie VALUE=\""+a+"\"><PARAM NAME=quality VALUE=high>";M+="<PARAM NAME=bgcolor VALUE=#ffffff>";M+="<EMBED src=\""+a+"\" quality=high bgcolor=#ffffff  WIDTH=\"212\" HEIGHT=\"145\" NAME=\"photo\"";M+=" ALIGN=\"\" TYPE=\"application/x-shockwave-flash\" PLUGINSPAGE=\"http://www.macromedia.com/go/getflashplayer\"></EMBED></OBJECT>";this.rotate_swf_html=M;}if(navigator.userAgent.indexOf("KHTML")!=-1){this.insert_rotate_swf_and_show_tim=setTimeout("_ge('photo_notes').insert_rotate_swf_and_show()",50);}else{if(_ge("rotate_span").innerHTML==""){this.insert_rotate_swf_and_show();}else{g.style.visibility="visible";global_single_shadow_div.style.visibility="visible";}}global_single_shadow_div.style.display="block";_set_single_shadow_x(Z);_set_single_shadow_y(K);_set_single_shadow_height(_ge("rotate_table"));_set_single_shadow_width(_ge("rotate_table"));},insert_rotate_swf_and_show:function(){_ge("rotate_span").innerHTML=this.rotate_swf_html;_ge("rotate_div").style.visibility="visible";_set_single_shadow_height(_ge("rotate_table"));global_single_shadow_div.style.visibility="visible";},hide_rotate_div:function(){_ge("rotate_div").style.display="none";global_single_shadow_div.style.display="none";window.should_I_ignore_stuff_because_of_button_action=0;if(this.button_acting){this.button_acting.enable_others();}},save_rotation:function(Z){this.hide_rotate_div();if(Z=="-90"){Z=270;}if(Z=="-180"){Z=180;}this.start_comming(F.output.get("photo_notes_rotate"));var a={photo_id:this.p_id,degrees:Z};F.API.callMethod("flickr.photos.transform.rotate",a,this);},flickr_photos_transform_rotate_onLoad:function(g,a,Z){if(g){document.location=page_current_url+"?rotated=1&cb="+new Date().getTime();}else{alert(F.output.get("api_err_generic")+" "+Z);this.stop_comming();}},make_note_this_color:function(Z){var z=(this.last_note_color)?this.last_note_color:"yellow";if(z==Z){return ;}_ge("notes_text_area").style.backgroundColor=this.hex_colors[Z];var g=this.getElementsByTagName("TD");for(var a=0;a<g.length;a++){if(g[a].className=="td_note_yeller"){g[a].style.backgroundColor=this.hex_colors[Z];}}var x=this.getElementsByTagName("IMG");for(var a=0;a<x.length;a++){if(x[a].src){x[a].src=x[a].src.replace(z,Z);}}this.last_note_color=Z;},start_showing_one:function(g){clearTimeout(this.hide_tim);if(this.which_note){clearTimeout(this.which_note.hide_timmy);}if(this.which_note!=g){this.stop_showing_one();}this.make_note_this_color(g.use_color);var a=g.render_text_for_display();if(!g.from_owner){a+="  - <a href=\"/photos/"+g.author+"\"><i>"+g.author_name+"</i></a>";}_ge("notes_text_span").innerHTML=a;this.which_note=g;var Z=_ge("notes_text_area");if(this.editing){_ge("notes_text_span").style.display="none";_ge("notes_text_form").style.display="block";_ge("notes_text_buttons_form").style.display="block";if(this.which_note.id=="photo_note_temp"){_ge("delete_note_button").style.display="none";}else{_ge("delete_note_button").style.display="inline";}if(g!=this.which_note||Z.value==""){Z.value=g.saved_txt;adjust_textarea_height(Z);}}else{_ge("notes_text_span").style.display="inline";_ge("notes_text_form").style.display="none";_ge("notes_text_buttons_form").style.display="none";}_ge("notes_text_div").style.display="block";global_single_shadow_div.style.display="block";_set_single_shadow_height(_ge("notes_text_table"));_set_single_shadow_width(_ge("notes_text_table"));this.place_notes_text_div();if(this.editing){Z.focus();Z.select();}},check_note_for_prop:function(){if(_ge("photo_props")){var Z=_ge("notes_text_area");if(Z.value=="ho ho ho beard"||Z.value=="ho ho ho hat"){if(_ge("photo_prop_"+this.which_note.note_id)&&_ge("photo_prop_"+this.which_note.note_id).style.display=="none"){if(Z.value=="ho ho ho beard"){_ge("photo_prop_img_"+this.which_note.note_id).src=_images_root+"/prop_santa_beard.png";_ge("photo_prop_"+this.which_note.note_id).style.display="block";}if(Z.value=="ho ho ho hat"){_ge("photo_prop_img_"+this.which_note.note_id).src=_images_root+"/prop_santa_hat.png";_ge("photo_prop_"+this.which_note.note_id).style.display="block";}}}else{if(_ge("photo_prop_"+this.which_note.note_id)&&_ge("photo_prop_"+this.which_note.note_id).style.display=="block"){_ge("photo_prop_img_"+this.which_note.note_id).src=_images_root+"/spaceball.gif";_ge("photo_prop_"+this.which_note.note_id).style.display="none";}}}},place_notes_text_div:function(M,x){var a=_ge("notes_text_div");if(M&&x){var Z=M;var K=x+this.which_note.get_note_h()+5;}else{if(this.editing){var g=0;var z=200;}else{var g=100;var z=200;}var Z=_pi(this.which_note.style.left);var K=_pi(this.which_note.style.top)+this.which_note.get_note_h()+5;if(K+a.offsetHeight>this.get_image_h()+g){K=_pi(this.which_note.style.top)-a.offsetHeight-10;if(F.is_ie&&navigator.userAgent.indexOf("Opera")==-1){K+=15;}}if(K<-z){K=_pi(this.which_note.style.top)+this.which_note.get_note_h()+5;}}a.style.left=Z+"px";a.style.top=K+"px";_set_single_shadow_x(Z);_set_single_shadow_y(K);},stop_showing_one:function(Z){_ge("notes_text_div").style.display="none";global_single_shadow_div.style.display="none";if(this.which_note){this.which_note.isOver=0;this.which_note.change_display();}},start_dragging_one:function(){this.dragging=1;window.should_I_ignore_stuff_because_note_editing=1;},start_editing_one:function(Z){this.editing=1;this.dragging=0;window.should_I_ignore_stuff_because_note_editing=1;this.start_showing_one(Z);},hide_notes_text_div:function(){_ge("notes_text_div").style.display="none";global_single_shadow_div.style.display="none";},refresh_notes:function(){if(_ok_for_scrumjax_xml()){var Z={photo_id:this.p_id};F.API.callMethod("flickr.photos.getInfo",Z,this);}else{document.location=page_current_url+"?changednotes=1&cb="+new Date().getTime();}},flickr_photos_getInfo_onLoad:function(z,Z,e,w){if(z){var L=global_photos[this.p_id].notesA=[];var y={};var k=Z.documentElement.getElementsByTagName("owner")[0].getAttribute("nsid");var f=Z.documentElement.getElementsByTagName("note");for(var d=0;d<f.length;d++){var x=f[d].firstChild.nodeValue;var X=f[d].getAttribute("x")*1;var u=f[d].getAttribute("y")*1;var J=f[d].getAttribute("w")*1;var g=f[d].getAttribute("h")*1;var D=f[d].getAttribute("id");var c=f[d].getAttribute("author");var o=f[d].getAttribute("authorname");y[D]=D;L.push({id:D,box:{x:X,y:u,w:J,h:g}});var I=_ge("photo_note_"+D);if(I){I.refresh_info(D,X,u,J,g,x);if(_ge("photo_props")){if(!_ge("photo_prop_"+D)){var N=document.createElement("DIV");N.className="photo_prop";N.id="photo_prop_"+D;N.style.left=(X+3)+"px";N.style.top=(u+3)+"px";N.style.width=(J-4)+"px";N.style.height=(g-4)+"px";if(x=="ho ho ho beard"||x=="ho ho ho hat"){N.style.display="block";}else{N.style.display="none";}var K=document.createElement("IMG");K.className="trans_png";K.id="photo_prop_img"+D;K.style.width=(J-4)+"px";K.style.height=(g-4)+"px";if(x=="ho ho ho beard"){K.src=_images_root+"/prop_santa_beard.png";}else{if(x=="ho ho ho hat"){K.src=_images_root+"/prop_santa_hat.png";}else{K.src=_images_root+"/spaceball.gif";}}N.appendChild(F.prepare_for_insertion(K));_ge("photo_props").appendChild(F.prepare_for_insertion(N));}}}else{var M=(global_nsid==c||global_photos[this.p_id].isOwner)?1:0;var a=(k==c);this.create_note(D,X,u,J,g,x,M,a,o,c);}}for(var E=this.childNodes.length-1;E>=0;E--){if(this.childNodes[E].className=="photo_note"){if(!y[this.childNodes[E].note_id]){F.remove_el(this.childNodes[E],this);}}}this.restack_notes();}else{alert(F.output.get("api_err_generic")+" "+e);}if(global_comm_div.comming){this.stop_comming();}if(_ge("photo_prop_temp")){F.remove_el(_ge("photo_prop_temp"),_ge("photo_props"));}},start_comming:function(g,x,f,z,a,i,M,K){F.eb_broadcast("stewart_pause");window.should_I_ignore_stuff_because_note_editing=1;this.style.visibility="hidden";var e=function(){var d=_pi((_ge("photo_notes").get_w()-_pi(global_comm_div.table.offsetWidth))/2);if(d<10){d=10;}return d;};var Z=function(){var d=_pi((_ge("photo_notes").get_h()-global_comm_div.table.offsetHeight)/2);if(d<10){d=10;}return d;};global_comm_div.start_comming(g,e,Z,x,f,z,a,i,M,K);},stop_comming:function(Z){window.should_I_ignore_stuff_because_note_editing=0;global_comm_div.stop_comming();if(!Z){this.style.visibility="visible";}F.eb_broadcast("stewart_play_if_was_playing");},start_adding_note:function(){if(this.editing){alert(F.output.get("photo_notes_one_note"));return ;}this.empty_notes_text_area();this.onmouseover();var Z=this.create_note("temp",20,20,50,50,F.output.get("photo_notes_add_notes_here"),1,global_photos[this.p_id].isOwner,"","");Z.start_editing();this.start_editing_one(Z);},create_note:function(k,f,e,d,g,a,Z,I,z,M){var i=document.createElement("DIV");i.className="photo_note";i.id="photo_note_"+k;i.style.left=(f)+"px";i.style.top=(e)+"px";var K="<div class=\"photo_note_box_div\"><div class=\"photo_note_box_inner_div\">";K+="<div class=\"photo_note_box_inner_inner_div\"><div style=\"width:"+(d-4)+"px; height:"+(g-4)+"px;\">";K+="</div></div></div></div><div class=\"photo_note_text_div\"></div>";i.innerHTML=K;this.appendChild(i);F.decorate(i,F._photo_note).note_go_go_go(k,Z,I,z,M,a);if(_ge("photo_props")){if(_ge("photo_prop_temp")){F.remove_el(_ge("photo_prop_temp"),_ge("photo_props"));}var x=document.createElement("DIV");x.className="photo_prop";x.id="photo_prop_"+k;x.style.left=(f+3)+"px";x.style.top=(e+3)+"px";x.style.width=(d-4)+"px";x.style.height=(g-4)+"px";if(a=="ho ho ho beard"||a=="ho ho ho hat"){x.style.display="block";}else{x.style.display="none";}var L=document.createElement("IMG");L.className="trans_png";L.id="photo_prop_img_"+k;L.style.width=(d-4)+"px";L.style.height=(g-4)+"px";L.src=_images_root+"/spaceball.gif";if(a=="ho ho ho beard"){L.src=_images_root+"/prop_santa_beard.png";}else{if(a=="ho ho ho hat"){L.src=_images_root+"/prop_santa_hat.png";}else{L.src=_images_root+"/spaceball.gif";}}x.appendChild(F.prepare_for_insertion(L));_ge("photo_props").appendChild(F.prepare_for_insertion(x));}return i;},delete_note:function(){deja_view_uh_huh();this.which_note.stop_editing(0);this.editing=0;this.stop_showing_one();this.empty_notes_text_area();this.start_comming(F.output.get("photo_notes_deleting"));if(_ge("photo_prop_"+this.which_note.note_id)&&_ge("photo_props")){F.remove_el(_ge("photo_prop_"+this.which_note.note_id),_ge("photo_props"));}var Z={note_id:this.which_note.note_id};F.API.callMethod("flickr.photos.notes.delete",Z,this);},flickr_photos_notes_delete_onLoad:function(g,a,Z){if(!g&&(!Z||Z.indexOf("not found")==-1)){alert(F.output.get("api_err_generic")+" "+Z);this.stop_comming();}this.refresh_notes();},cancel_editing:function(){this.which_note.stop_editing(1);this.editing=0;window.should_I_ignore_stuff_because_note_editing=0;this.stop_showing_one();this.empty_notes_text_area();if(this.which_note.id=="photo_note_temp"){F.remove_el(this.which_note,this);if(_ge("photo_prop_temp")&&_ge("photo_props")){F.remove_el(_ge("photo_prop_temp"),_ge("photo_props"));}}},empty_notes_text_area:function(){_ge("notes_text_area").value="";},save_editing:function(){var Z=_ge("notes_text_area");if(Z.value==""){Z.focus();Z.select();return ;}deja_view_uh_huh();this.which_note.stop_editing(0);this.editing=0;this.stop_showing_one();if(this.which_note.id=="photo_note_temp"){this.start_comming(F.output.get("photo_notes_saving_note"));var a={photo_id:this.p_id,note_x:this.which_note.get_note_x(),note_y:this.which_note.get_note_y(),note_w:(this.which_note.get_note_w()),note_h:(this.which_note.get_note_h()),note_text:Z.value};F.API.callMethod("flickr.photos.notes.add",a,this);F.remove_el(this.which_note,this);}else{this.start_comming(F.output.get("saving"));var a={note_id:this.which_note.note_id,note_x:this.which_note.get_note_x(),note_y:this.which_note.get_note_y(),note_w:(this.which_note.get_note_w()),note_h:(this.which_note.get_note_h()),note_text:Z.value};F.API.callMethod("flickr.photos.notes.edit",a,this);}this.empty_notes_text_area();},flickr_photos_notes_add_onLoad:function(g,a,Z){if(g){this.refresh_notes();}else{alert(F.output.get("api_err_generic")+" "+Z);this.stop_comming();if(_ge("photo_prop_temp")){F.remove_el(_ge("photo_prop_temp"),_ge("photo_props"));}}},flickr_photos_notes_edit_onLoad:function(g,a,Z){if(g){this.refresh_notes();}else{alert(F.output.get("api_err_generic")+" "+Z);this.stop_comming();}},flickr_test_echo_onLoad:function(g,a,Z){if(!g){alert(F.output.get("api_err_generic")+" "+Z);this.stop_comming();}},get_w:function(){return _ge("photoImgDiv"+this.p_id).offsetWidth;},get_h:function(){return _ge("photoImgDiv"+this.p_id).offsetHeight;},get_image_w:function(){var Z=_ge("photoImgDiv"+this.p_id);if(Z.childNodes&&Z.childNodes[0]&&Z.childNodes[0].width){return Z.childNodes[0].width;}else{return 0;}},get_image_h:function(){var Z=_ge("photoImgDiv"+this.p_id);if(Z.childNodes&&Z.childNodes[0]&&Z.childNodes[0].height){return Z.childNodes[0].height;}else{return 0;}},change_display:function(){if(this.isOver){this.style.visibility="visible";if(_ge("photo_props")){_ge("photo_props").style.display="";}}else{this.style.visibility="hidden";}}};F._photo_note={note_go_go_go:function(z,Z,g,K,x,M){var a=this;this.note_id=z;this.can_edit=Z;this.author_name=K;this.author=x;this.from_owner=g;this.use_color=(this.from_owner)?"yellow":"green";this.isOver=0;this.editing=0;this.isDragging=0;this.resize_box_size=8;this.last_rendered_txt="";this.box_div=this.childNodes[0];this.innermost_div=this.box_div.childNodes[0].childNodes[0].childNodes[0];if(F.is_ie){this.innermost_div.style.backgroundColor="#fff";this.innermost_div.style.filter="alpha(opacity:0)";}this.text_div=this.childNodes[1];this.saved_txt=M;this.saved_x=_pi(this.style.left);this.saved_y=_pi(this.style.top);this.saved_w=_pi(this.innermost_div.style.width);this.saved_h=_pi(this.innermost_div.style.height);this.appendChild(this.make_resize_div("nw"));this.appendChild(this.make_resize_div("ne"));this.appendChild(this.make_resize_div("sw"));this.appendChild(this.make_resize_div("se"));Y.U.Event.addListener(this.box_div,"mouseover",this.handle_mouseover,this,true);Y.U.Event.addListener(this.box_div,"mouseout",this.handle_mouseout,this,true);if(this.can_edit){Y.U.Event.addListener(this.box_div,"mousedown",this.handle_mousedown,this,true);this.box_div.style.cursor=(F.is_ie)?"hand":"pointer";}},make_resize_div:function(z){var g="resize_"+z+"_div";var Z=this;var a=document.createElement("DIV");a.style.position="absolute";a.style.display="none";a.style.cursor=z+"-resize";a.style.top=(z=="ne"||z=="nw")?"0px":(this.get_note_h()-this.resize_box_size)+"px";a.style.left=(z=="sw"||z=="nw")?"0px":(this.get_note_w()-this.resize_box_size)+"px";a.style.backgroundColor="#fff";a.innerHTML="<div style=\"border:1px solid black\"><div style=\"width:"+(this.resize_box_size-2)+"px; height:"+(this.resize_box_size-2)+"px; background-color:#fff; font-size:1px\"></div></div>";a.onmousedown=function(x){x||(x=window.event);Z.start_dragging_resize(x,z);};a.note=this;this[g]=a;return this[g];},render_text_for_display:function(){var Z=this.saved_txt;if(this.last_saved_txt!=this.saved_txt){Z=_hyperlink(Z);Z=Z.trim().nl2br();this.last_saved_txt=this.saved_txt;this.last_rendered_txt=Z;}return this.last_rendered_txt;},start_dragging_resize:function(f,K){f||(f=window.event);var g="resize_"+K+"_div";var I=this[g];_ge("photo_notes").start_dragging_one();_disable_select();I.lastClientX=f.clientX;I.lastClientY=f.clientY;if(K=="se"){var L=_pi(I.style.left);var d=_pi(I.style.top);var M=f.clientX-L+this.resize_box_size;var a=M+_ge("photo_notes").get_image_w()-_pi(this.style.left)-(this.resize_box_size*2);var z=f.clientY-d+this.resize_box_size;var Z=z+_ge("photo_notes").get_image_h()-_pi(this.style.top)-(this.resize_box_size*2);}else{if(K=="sw"){var L=_pi(this.style.left);var d=_pi(I.style.top);var M=f.clientX-L;var a=M+L+this.get_note_w()-(this.resize_box_size*2);var z=f.clientY-d+this.resize_box_size;var Z=z+_ge("photo_notes").get_image_h()-_pi(this.style.top)-(this.resize_box_size*2);}else{if(K=="nw"){var L=_pi(this.style.left);var d=_pi(this.style.top);var M=f.clientX-L;var a=M+L+this.get_note_w()-(this.resize_box_size*2);var z=f.clientY-d;var Z=z+d+this.get_note_h()-(this.resize_box_size*2);}else{if(K=="ne"){var L=_pi(I.style.left);var d=_pi(this.style.top);var M=f.clientX-L+this.resize_box_size;var a=M+_ge("photo_notes").get_image_w()-_pi(this.style.left)-(this.resize_box_size*2);var z=f.clientY-d;var Z=z+d+this.get_note_h()-(this.resize_box_size*2);}}}}this.isDragging=1;this.change_display();var i=this;document.dragee=I;document.onmouseup=function(x){if(document.dragee){i.stop_dragging_resize();}document.dragee=null;};document.onmousemove=function(c){c||(c=window.event);if(_ge("photo_notes").hide_while_dragging){_ge("photo_notes").hide_notes_text_div();}var w=Math.min(Math.max(c.clientX,M),a);var u=Math.min(Math.max(c.clientY,z),Z);if(K=="se"){var J=_pi(I.style.left);var o=_pi(I.style.top);var D=J+(w-I.lastClientX);var E=o+(u-I.lastClientY);I.style.left=D+"px";I.style.top=E+"px";i.innermost_div.style.width=(_pi(I.style.left)+i.resize_box_size-4)+"px";i.innermost_div.style.height=(_pi(I.style.top)+i.resize_box_size-4)+"px";i["resize_ne_div"].style.left=I.style.left;i["resize_sw_div"].style.top=I.style.top;}else{if(K=="sw"){var J=_pi(i.style.left);var o=_pi(I.style.top);var D=J+(w-I.lastClientX);var E=o+(u-I.lastClientY);i.style.left=D+"px";I.style.top=E+"px";i.innermost_div.style.width=(_pi(i.innermost_div.style.width)+J-D)+"px";i.innermost_div.style.height=(_pi(I.style.top)+i.resize_box_size-4)+"px";i["resize_ne_div"].style.left=i["resize_se_div"].style.left=(_pi(i.innermost_div.style.width)-i.resize_box_size+4)+"px";i["resize_se_div"].style.top=I.style.top;}else{if(K=="nw"){var J=_pi(i.style.left);var o=_pi(i.style.top);var D=J+(w-I.lastClientX);var E=o+(u-I.lastClientY);i.style.left=D+"px";i.style.top=E+"px";i.innermost_div.style.width=(_pi(i.innermost_div.style.width)+J-D)+"px";i.innermost_div.style.height=(_pi(i.innermost_div.style.height)+o-E)+"px";i["resize_sw_div"].style.left=I.style.left;i["resize_ne_div"].style.top=I.style.top;i["resize_se_div"].style.top=i["resize_sw_div"].style.top=(_pi(i.innermost_div.style.height)-i.resize_box_size+4)+"px";i["resize_se_div"].style.left=i["resize_ne_div"].style.left=(_pi(i.innermost_div.style.width)-i.resize_box_size+4)+"px";}else{if(K=="ne"){var J=_pi(I.style.left);var o=_pi(i.style.top);var D=J+(w-I.lastClientX);var E=o+(u-I.lastClientY);I.style.left=D+"px";i.style.top=E+"px";i.innermost_div.style.width=(_pi(I.style.left)+i.resize_box_size-4)+"px";i.innermost_div.style.height=(_pi(i.innermost_div.style.height)+o-E)+"px";i["resize_se_div"].style.left=I.style.left;i["resize_se_div"].style.top=i["resize_sw_div"].style.top=(_pi(i.innermost_div.style.height)-i.resize_box_size+4)+"px";}}}}I.lastClientX=w;I.lastClientY=u;var k=_ge("photo_prop_"+i.note_id);var X=_ge("photo_prop_img_"+i.note_id);if(k&&X){k.style.top=_pi(i.style.top)+2;k.style.left=_pi(i.style.left)+2;k.style.width=i.innermost_div.style.width;k.style.height=i.innermost_div.style.height;X.style.width=i.innermost_div.style.width;X.style.height=i.innermost_div.style.height;}if(!_ge("photo_notes").hide_while_dragging){_ge("photo_notes").place_notes_text_div();}};},stop_dragging_resize:function(){_enable_select();if(!this.isDragging){return ;}document.onmousemove=null;_ge("photo_notes").start_editing_one(this);this.isDragging=0;this.change_display();},show_resize_divs:function(){this.resize_nw_div.style.display=this.resize_ne_div.style.display=this.resize_sw_div.style.display=this.resize_se_div.style.display="block";},hide_resize_divs:function(){this.resize_nw_div.style.display=this.resize_ne_div.style.display=this.resize_sw_div.style.display=this.resize_se_div.style.display="none";},get_note_w:function(){return _pi(this.innermost_div.style.width)+4;},get_note_h:function(){return _pi(this.innermost_div.style.height)+4;},get_note_x:function(){return _pi(this.style.left);},get_note_y:function(){return _pi(this.style.top);},handle_mouseover:function(){if(_ge("photo_notes").editing||global_comm_div.comming||_ge("photo_notes").dragging){return ;}this.isOver=1;this.change_display();_ge("photo_notes").start_showing_one(this);},handle_mouseout:function(){if(this.id=="photo_note_temp"){return ;}clearTimeout(this.hide_timmy);this.hide_timmy=setTimeout("_ge('"+this.id+"').take_another_little_piece_of_my_heart('Photo_Note_EXT.onmouseout');",200);},take_another_little_piece_of_my_heart:function(){if(_ge("photo_notes").editing||global_comm_div.comming||_ge("photo_notes").dragging){return ;}this.isOver=0;this.change_display();_ge("photo_notes").stop_showing_one();},start_editing:function(){if(this.editing){return ;}this.isOver=1;this.editing=1;this.change_display();},stop_editing:function(Z){this.editing=0;if(Z){this.style.left=this.saved_x+"px";this.style.top=this.saved_y+"px";this.innermost_div.style.width=this.saved_w+"px";this.innermost_div.style.height=this.saved_h+"px";this.resize_nw_div.style.top=this.resize_ne_div.style.top="0px";this.resize_sw_div.style.top=this.resize_se_div.style.top=(this.get_note_h()-this.resize_box_size)+"px";this.resize_nw_div.style.left=this.resize_sw_div.style.left="0px";this.resize_ne_div.style.left=this.resize_se_div.style.left=(this.get_note_w()-this.resize_box_size)+"px";_ge("photo_notes").start_showing_one(this);var g=_ge("photo_prop_"+this.note_id);var a=_ge("photo_prop_img_"+this.note_id);if(g&&a){g.style.top=_pi(this.style.top)+2;g.style.left=_pi(this.style.left)+2;g.style.width=this.innermost_div.style.width;g.style.height=this.innermost_div.style.height;a.style.width=this.innermost_div.style.width;a.style.height=this.innermost_div.style.height;}}this.change_display();},handle_mousedown:function(Z){Z||(Z=window.event);if(!_ge("photo_notes").editing&&!global_comm_div.comming&&!_ge("photo_notes").dragging){this.start_editing();}if(((!_ge("photo_notes").editing&&!_ge("photo_notes").dragging)||_ge("photo_notes").which_note==this&&!this.isDragging)&&!global_comm_div.comming){this.start_dragging(Z);}},stop_dragging:function(){_enable_select();if(!this.isDragging){return ;}document.onmousemove=null;_ge("photo_notes").start_editing_one(this);this.isDragging=0;this.change_display();},start_dragging:function(K){K||(K=window.event);_ge("photo_notes").start_dragging_one();_disable_select();var a=_pi(this.style.left);var f=_pi(this.style.top);this.lastClientX=K.clientX;this.lastClientY=K.clientY;var Z=K.clientX-a;var M=Z+_ge("photo_notes").get_image_w()-this.get_note_w();var i=K.clientY-f;var z=i+_ge("photo_notes").get_image_h()-this.get_note_h();this.isDragging=1;this.change_display();var g=this;document.dragee=this;document.onmouseup=function(x){if(document.dragee){g.stop_dragging();}document.dragee=null;};var g=this;document.onmousemove=function(E){E||(E=window.event);if(_ge("photo_notes").hide_while_dragging){_ge("photo_notes").hide_notes_text_div();}var L=_pi(g.style.left);var u=_pi(g.style.top);var k=Math.min(Math.max(E.clientX,Z),M);var I=Math.min(Math.max(E.clientY,i),z);var d=L+(k-g.lastClientX);var c=u+(I-g.lastClientY);g.style.left=d+"px";g.style.top=c+"px";g.lastClientX=k;g.lastClientY=I;if(!_ge("photo_notes").hide_while_dragging){_ge("photo_notes").place_notes_text_div();}var D=_ge("photo_prop_"+g.note_id);if(D){D.style.top=_pi(g.style.top)+2+"px";D.style.left=_pi(g.style.left)+2+"px";}};},refresh_info:function(a,z,g,M,Z,x){this.note_id=a;this.id="photo_note_"+a;this.style.left=(z)+"px";this.style.top=(g)+"px";this.innermost_div.style.width=(M-4)+"px";this.innermost_div.style.height=(Z-4)+"px";this.saved_txt=x;this.saved_x=_pi(this.style.left);this.saved_y=_pi(this.style.top);this.saved_w=_pi(this.innermost_div.style.width);this.saved_h=_pi(this.innermost_div.style.height);},change_display:function(){var a=this.box_div.childNodes[0];var Z=a.childNodes[0];a.style.borderStyle="solid";Z.style.borderStyle="solid";this.box_div.style.left=this.box_div.style.top="0px";this.box_div.style.borderWidth="0";this.hide_resize_divs();if(this.editing){this.show_resize_divs();Z.style.borderStyle="dashed";a.style.borderStyle="dashed";}else{if(this.isOver){this.box_div.style.left=this.box_div.style.top="-1px";this.box_div.style.borderWidth="1px";}}}};F._photo_button_bar={bar_go_go_go:function(G,Z){var R=this.getElementsByTagName("img");var b=Y.U.Dom.getElementsByClassName("photo_gne_button","a",this);for(var D=0;D<b.length;D++){Photo_Gne_button_action_check(b[D].id);var m=b[D].id.split("photo_gne_button_").join("");var e=(m=="add_to_faves")?"a_fave":m;var u=b[D].getAttribute("title");var z=b[D].getAttribute("title_off");z=(z)?z:u;var C=(m=="add_to_faves"&&Z)?1:0;if(m=="print"&&b[D].className.indexOf("prints_")>-1){m="prints";}F.decorate(b[D],F._photo_button).button_go_go_go(G,m,e,C,u,z);}}};F._photo_button={button_go_go_go:function(D,z,C,m,Z,u){this.lock_down=0;this.p_id=D;this.style.cursor=(F.is_ie)?"hand":"pointer";F.make_new_mouse_tip(this);this.base_name=z;this.base_class_name="sprite-";if(z=="add_note"&&!_ok_for_scrumjax()){this.style.display="none";return ;}this.on=[];this.on._className=this.base_class_name+z+"_grey";this.on_over=[];this.on_over._className=this.base_class_name+z+"_color";this.on_down=[];this.on_down._className=this.base_class_name+z+"_color_down";if(z=="send_to_group"||z=="send_to_set"||z=="print"||z=="prints"||z=="blog_this"){this.on_locked=[];this.on_locked._className=this.base_class_name+z+"_color button_locked";}this.off=[];this.off._className=this.base_class_name+C+"_grey";this.off_over=[];this.off_over._className=this.base_class_name+C+"_color";this.off_down=[];this.off_down._className=this.base_class_name+C+"_color_down";this.isOver=this.isDown=0;this.isOff=(m)?1:0;this.title_on=Z;this.title_off=u;if(this.isOff){this.change_src();F.change_mouse_tip_txt(this,u);}Y.U.Event.addListener(this,"mouseover",this.handle_mouseover);Y.U.Event.addListener(this,"mouseout",this.handle_mouseout);Y.U.Event.addListener(this,"click",this.handle_click);Y.U.Event.addListener(this,"mousedown",this.handle_mousedown);this.prints_action=this.print_action;},handle_mouseover:function(C){if(window.should_I_ignore_stuff_because_note_editing||window.should_I_ignore_stuff_because_tash_editing||window.should_I_ignore_stuff_because_of_editable_div_action){return ;}this.isOver=1;this.change_src();},handle_mouseout:function(C){this.isOver=0;if(!this.lock_down){this.isDown=0;}this.change_src();},handle_mousedown:function(z){if(window.should_I_ignore_stuff_because_note_editing||window.should_I_ignore_stuff_because_tash_editing||window.should_I_ignore_stuff_because_of_editable_div_action){return ;}if(this.is_disabled){this.enable_others();this.enable_self();}this.isDown=1;this.isOver=1;var C=_ge("photo_notes");if(this.base_name!="rotate"&&C&&C.hide_rotate_div){C.hide_rotate_div();}if(this.base_name!="print"&&printDialogDiv){hide_printDialog();}if(this.base_name!="send_to_set"&&sendToSetDialogDiv){hide_sendToSetDialog();}if(this.base_name!="send_to_group"&&sendToGroupDialogDiv){hide_sendToGroupDialog();}if(this.base_name!="blog_this"&&sendToBlogDialogDiv){hide_sendToBlogDialog();}},handle_click:function(C){if(window.should_I_ignore_stuff_because_note_editing||window.should_I_ignore_stuff_because_tash_editing||window.should_I_ignore_stuff_because_of_editable_div_action){return ;}if(this.is_disabled){return ;}var z=this[this.base_name+"_action"]();this.isOver=1;if(z==1){this.isDown=1;this.lock_down=1;}else{this.isDown=0;}this.change_src();},disable_others:function(){var m=Y.U.Dom.getElementsByClassName("photo_gne_button","IMG");for(var z=0;z<m.length;z++){if(m[z].base_name!=this.base_name){m[z].disable_self();}}var C=_ge("photo_notes");if(C&&C.take_her_away){C.take_her_away("disable_others");}window.should_I_ignore_stuff_because_of_button_action=1;F.eb_broadcast("stewart_pause");},enable_others:function(){var z=Y.U.Dom.getElementsByClassName("photo_gne_button","IMG");for(var C=0;C<z.length;C++){if(z[C].base_name!=this.base_name){z[C].enable_self();}}window.should_I_ignore_stuff_because_of_button_action=0;F.eb_broadcast("stewart_play_if_was_playing");},disable_self:function(){this.is_disabled=1;this.style.cursor="default";},enable_self:function(){this.is_disabled=0;this.style.cursor=(F.is_ie)?"hand":"pointer";},change_src:function(){if(this.is_disabled){return ;}if(this.lock_down){this.className=this.on_locked._className;}else{if(this.isOff){if(this.isDown){this.className=this.off_down._className;}else{if(this.isOver){this.className=this.off_over._className;}else{this.className=this.off._className;}}}else{if(this.isDown){this.className=this.on_down._className;}else{if(this.isOver){this.className=this.on_over._className;}else{this.className=this.on._className;}}}}},delete_action:function(){setTimeout("if (confirm('"+F.output.get("photo_buttons_are_you_sure")+"'))  document.location = global_photos['"+this.p_id+"'].deleteUrl;",50);return 0;},rotate_action:function(){var C=_ge("photo_notes");if(C&&C.show_rotate_div){this.disable_others();C.show_rotate_div(this);}return 0;},send_to_set_action:function(){if(_ok_for_scrumjax_xml()){if(this.lock_down){hide_sendToSetDialog();return 0;}else{show_sendToSetDialog(this.p_id);return 1;}}else{document.location="/photo_sendto_set.gne?id="+this.p_id;}return 0;},print_action:function(){if(_ok_for_scrumjax_xml()){if(this.lock_down){hide_printDialog();return 0;}else{show_printDialog(this.p_id);return 1;}}else{document.location="/photo_print.gne?id="+this.p_id;}return 0;},send_to_group_action:function(){if(_ok_for_scrumjax_xml()){if(this.lock_down){hide_sendToGroupDialog();return 0;}else{show_sendToGroupDialog(this.p_id);return 1;}}else{document.location="/photo_sendto_group.gne?id="+this.p_id;}return 0;},blog_this_action:function(){if(_ok_for_scrumjax_xml()){if(this.lock_down){hide_sendToBlogDialog();return 0;}else{show_sendToBlogDialog(this.p_id);return 1;}}else{document.location="/blog.gne?photo="+this.p_id;}return 0;},add_note_action:function(){var C=_ge("photo_notes");if(C&&C.start_adding_note){C.start_adding_note();}return 0;},add_tash_action:function(){window.should_I_ignore_stuff_because_tash_editing=1;if(!_ge("photo_tash")&&page_photo_id!=null){var C=document.createElement("DIV");C.id="photo_tash";_ge("photoImgDiv"+page_photo_id).appendChild(C);F.decorate(C,photo_tash).go_go_go();}_ge("photo_tash").show();return 0;},zoom_action:function(){document.location=_ge("photo_gne_button_zoom").href;var C;return 0;},embed_action:function(){document.location=_ge("photo_gne_button_embed").href;return 0;},edit_photo_action:function(){F.picnik.go_go_go();},add_to_faves_action:function(){var z=_ge("photo_notes");var C=_ge("fave_form");if(this.isOff){if(_ok_for_scrumjax()){F.API.callMethod("flickr.favorites.remove",{photo_id:this.p_id},this);if(z&&z.start_comming){z.start_comming(F.output.get("photo_buttons_removing"));}}else{if(C){C.action=page_current_url;C.faveremove.value=1;C.submit();}}}else{if(_ok_for_scrumjax()){F.API.callMethod("flickr.favorites.add",{photo_id:this.p_id},this);if(z&&z.start_comming){z.start_comming(F.output.get("photo_buttons_adding"));}}else{if(C){C.action=page_current_url;C.faveadd.value=1;C.submit();}}}return 0;},flickr_favorites_add_onLoad:function(u,m,z){var C=_ge("photo_notes");this.isOff=!this.isOff;this.change_src();F.change_mouse_tip_txt(this,this.title_off);if(C&&C.stop_comming){C.stop_comming(1);}},flickr_favorites_remove_onLoad:function(u,m,z){var C=_ge("photo_notes");this.isOff=!this.isOff;this.change_src();F.change_mouse_tip_txt(this,this.title_on);if(C&&C.stop_comming){C.stop_comming(1);}}};var Photo_Gne_button_action_check=function(z){try{if(z=="photo_gne_button_add_tash"){if(!_ge("photo_tash")&&page_photo_id!=null){setTimeout(function(){var m=document.createElement("DIV");m.id="photo_tash";_ge("photoImgDiv"+page_photo_id).appendChild(m);F.decorate(m,photo_tash).go_go_go();},2000);}}}catch(C){}};function tagrs_showForm(){_ge("tagadderlink").style.display="none";_ge("tagadder").style.display="block";_ge("addtagbox").focus();tagrs_startAutoComplete();}function tagrs_startAutoComplete(){if(_ge("tagSuggestions")&&window.TagCompleteWidget){new TagCompleteWidget(_ge("addtagbox"),_ge("tagSuggestions"),global_nsid).completer.startLoading();}tagrs_startAutoComplete=function(){};}function tagrs_hideForm(){tagrs_clearForm();_ge("tagadderlink").style.display="block";_ge("tagadder").style.display="none";}function tagrs_clearForm(){document.forms.tagadderform.tag.value="";}function tagrs_addTag(I,d){if(!_ok_for_scrumjax_xml()){return true;}if(d==""){return false;}deja_view_uh_huh();tagrs_clearForm();var J=_ge("tagadder");J.flickr_photos_addTags_onLoad=function(o,p,G){if(o){F.API.callMethod("flickr.photos.getInfo",{photo_id:I},this);}else{var f=F.output.get("tagrs_tag_not_added");var g=p.documentElement.getElementsByTagName("err");if(g){g=g[0];if(g.getAttribute("code")=="2"){f=F.output.get("tagrs_max_limit",global_tag_limit,global_tag_limit);}else{if(g[0].getAttribute("msg")){f+=" "+g[0].getAttribute("msg");}}}var A=_ge("photo_notes");if(A&&A.start_comming){alert(f);}else{alert(f);}}};F.API.callMethod("flickr.photos.addTags",{photo_id:I,tags:d},J);return false;}function tagrs_rebuildTagsHTML(f,A,d,g,J){var I="<div id=\"tagdiv"+A+"\"><a class=\"globe\" onMouseOver=\"this.childNodes[0].src='"+_images_root+"/icon_globe_over.gif';\" onMouseOut=\"this.childNodes[0].src='"+_images_root+"/icon_globe.gif';\" href=\"/photos/tags/"+d+"/\" title=\""+F.output.get("tagrs_click_icon_all_public",d)+"\"><img src=\""+_images_root+"/icon_globe.gif\" width=\"16\" height=\"16\" class=\"icon\" alt=\""+F.output.get("tagrs_click_icon_all_public",d)+"\" /></a> <a class=\"Plain\" href=\""+global_photos[f].ownersUrl+"tags/"+d+"/\">"+g.escape_for_display()+"</a>";if(J){I+="\r\n\t\t\t\t\t\t"+"&nbsp;<a href=\""+global_photos[f].url+"?deletetag="+A+"\" title=\""+F.output.get("tagrs_delete_this_tag")+"\" class=\"Grey\" onclick=\"return tagrs_removeTag('"+f+"', '"+A+"', '"+d+"', '"+g.escape_for_display().replace("'","\\'")+"')\">[x]</a>";}I+="</div>";return I;tagrs_setPopularUsed(d);}function tagrs_removeTag(A,I,d,f){if(window.confirm(F.output.get("tagrs_are_you_sure_delete",f.escape_for_display()))){deja_view_uh_huh();if(!_ok_for_scrumjax_xml()){return true;}var J=_ge("tagadder");J.flickr_photos_removeTag_onLoad=function(n,o,p){if(n){tagrs_removedTag(A,I,d);}else{var g=F.output.get("tagrs_tag_not_deleted");var G=o.documentElement.getElementsByTagName("err");if(G&&G[0].getAttribute("msg")){g+=" "+G[0].getAttribute("msg");}alert(g);}};F.API.callMethod("flickr.photos.removeTag",{tag_id:I},J);return false;}else{return false;}}function tagrs_removedTag(I,f,o){_ge("tagdiv"+f).style.display="none";var J=0;var G=0;if(_ge("thetags")){var g=_ge("thetags").getElementsByTagName("div").length;for(var A=0;A<g;A++){if(_ge("thetags").getElementsByTagName("div")[A].style.display!="none"){J++;}}}if(_ge("themachinetags")){var g=_ge("themachinetags").getElementsByTagName("div").length;for(var A=0;A<g;A++){if(_ge("themachinetags").getElementsByTagName("div")[A].style.display!="none"){G++;}}}tagrs_toggle_displays(J,G);tagrs_setPopularUnUsedIfNotInInput(o);var p=tagrs_whereIsThisTagInHere(global_photos[I].tagsA,o);for(var d=0;d<p.length;d++){global_photos[I].tagsA.splice(p[d],1);global_photos[I].tags_rawA.splice(p[d],1);}}function tagrs_clearTags(){_ge("thetags").innerHTML="";}function tagrs_updatePopularList(J){if(!_ok_for_scrumjax_xml()){return false;}var p=_ge("addtagbox");var G=F.get_tags_from_input_str(p.value);var f=(global_photos[J]&&global_photos[J].tagsA)?global_photos[J].tagsA:[];var I=(global_photos[J]&&global_photos[J].tags_rawA)?global_photos[J].tags_rawA:[];for(var o=0;o<tagrs_popularA.length;o++){var n=tagrs_popularA[o];var A=tagrs_whereIsThisTagInHere(f,n);var d=tagrs_whereIsThisTagInHere(I,n);var g=tagrs_whereIsThisTagInHere(G,n);if(A.length==0&&d.length==0&&g.length==0){tagrs_setPopularUnUsed(n);}else{tagrs_setPopularUsed(n);}}setTimeout("tagrs_updatePopularList('"+J+"')",200);}tagrs_popularA=[];function tagrs_showPopular(J,I){if(!_ok_for_scrumjax_xml()){return false;}var d=_ge("addtagbox");var f=F.get_tags_from_input_str(d.value);J=(J==undefined)?20:J;var A=_ge("tagpopular");global_nsid;A.innerHTML="<i>loading...</i>";A.flickr_tags_getListUserPopular_onLoad=function(q,n,o){if(q){tagrs_popularA=[];var l=n.documentElement.getElementsByTagName("tag");if(l.length==0){var a="You have no tags yet.";}else{var a="click a tag:";for(var V=0;V<l.length;V++){var g=l[V];var e=g.firstChild.nodeValue;tagrs_popularA.push(e);a+=" <a href=\"#\" id=\"popTags"+e+"\" onclick=\"tagrs_toggleTagInInput('"+e+"', '"+I+"'); return false;\">"+e+"</a>";}if(l.length>J){a+="<br><br><a href=\"#\" onclick=\"tagrs_showPopular("+(J+20)+", '"+I+"');return false;\">"+F.output.get("tagrs_get_more_your_tags")+"</a> | <a href=\"#\" onclick=\"tagrs_showPopular("+(J+2000)+", '"+I+"');return false;\">"+F.output.get("tagrs_get_all_your_tags")+"</a>";}}this.innerHTML=a;tagrs_updatePopularList(I);}else{var p=F.output.get("tagrs_tags_not_loaded");var G=n.documentElement.getElementsByTagName("err");if(G&&G[0].getAttribute("msg")){p+=" "+G[0].getAttribute("msg");}alert(p);}};F.API.callMethod("flickr.tags.getListUserPopular",{count:J+1},A);}function tagrs_setPopularUsed(d){var I=_ge("popTags"+d);if(!I){return ;}I.className="tagrsUsed";}function tagrs_setPopularUnUsed(d){var I=_ge("popTags"+d);if(!I){return ;}I.className="tagrsUnUsed";}function tagrs_setPopularUnUsedIfNotInInput(d){var J=_ge("popTags"+d);if(!J){return ;}var I=_ge("addtagbox");var f=F.get_tags_from_input_str(I.value);var A=tagrs_whereIsThisTagInHere(f,d);if(A.length>0){return ;}tagrs_setPopularUnUsed(d);}function tagrs_toggleTagInInput(I,J){var f=(global_photos[J]&&global_photos[J].tagsA)?global_photos[J].tagsA:[];var G=_ge("addtagbox");var A=F.get_tags_from_input_str(G.value);var n=tagrs_whereIsThisTagInHere(A,I);if(n.length==0){if(tagrs_whereIsThisTagInHere(f,I).length==0){A.unshift(I);}tagrs_setPopularUsed(I);}else{for(var d=0;d<n.length;d++){A.splice(n[d],1);}tagrs_setPopularUnUsed(I);}var g=_ge("popTags"+I);if(g){g.blur();}var p="";for(var o=0;o<A.length;o++){p+=(A[o].indexOf(" ")==-1)?A[o]:"\""+A[o]+"\"";if(o+1<A.length){p+=" ";}}G.value=p;}function tagrs_whereIsThisTagInHere(g,f){var I=[];for(var J=0;J<g.length;J++){var d=g[J];if(f.toLowerCase()==d.replace(" ","").toLowerCase()){I.unshift(J);}}return I;}function tagrs_toggle_displays(I,d){if(!I&&!d){_ge("thetags").style.display="block";if(_ge("machine_tag_toggle")){_ge("machine_tag_toggle").style.display="none";}if(_ge("themachinetags")){_ge("themachinetags").style.display="none";}}if(I&&!d){_ge("thetags").style.display="block";if(_ge("machine_tag_toggle")){_ge("machine_tag_toggle").style.display="none";}if(_ge("themachinetags")){_ge("themachinetags").style.display="none";}}if(!I&&d){_ge("thetags").style.display="none";if(_ge("machine_tag_toggle")){_ge("machine_tag_toggle").style.display="none";}if(_ge("themachinetags")){_ge("themachinetags").style.display="block";}if(_ge("machine_tag_toggle_show")){_ge("machine_tag_toggle_show").style.display="none";}if(_ge("machine_tag_toggle_hide")){_ge("machine_tag_toggle_hide").style.display="none";}}if(I&&d&&_old_machine_tags!=d){_old_machine_tags=d;_ge("thetags").style.display="block";if(_ge("machine_tag_toggle")){_ge("machine_tag_toggle").style.display="block";}if(_ge("themachinetags")){_ge("themachinetags").style.display="block";}if(_ge("machine_tag_toggle_show")){_ge("machine_tag_toggle_show").style.display="none";}if(_ge("machine_tag_toggle_hide")){_ge("machine_tag_toggle_hide").style.display="block";}}if(_ge("span_machine_tags_show_count")){_ge("span_machine_tags_show_count").innerHTML=d;}if(_ge("span_machine_tags_hide_count")){_ge("span_machine_tags_hide_count").innerHTML=d;}}function tagrs_toggle_machine_tags(){if(_ge("machine_tag_toggle_show")&&_ge("machine_tag_toggle_hide")){if(_ge("machine_tag_toggle_show").style.display=="none"){tagrs_hide_machine_tags();}else{tagrs_show_machine_tags();}}return false;}function tagrs_show_machine_tags(){if(_ge("machine_tag_toggle_show")){_ge("machine_tag_toggle_show").style.display="none";}if(_ge("machine_tag_toggle_hide")){_ge("machine_tag_toggle_hide").style.display="block";}if(_ge("themachinetags")){_ge("themachinetags").style.display="block";}}function tagrs_hide_machine_tags(){if(_ge("machine_tag_toggle_show")){_ge("machine_tag_toggle_show").style.display="block";}if(_ge("machine_tag_toggle_hide")){_ge("machine_tag_toggle_hide").style.display="none";}if(_ge("themachinetags")){_ge("themachinetags").style.display="none";}}function tagrs_writePopularLink(d){if(!_ok_for_scrumjax_xml()){return ;}document.write("<div style=\"margin-top:5px; font-size:12px\" id=\"tagpopular\"><a style=\"text-decoration: none;\" href=\"#\" onclick=\"tagrs_showPopular(20, '"+d+"');return false;\">"+F.output.get("tagrs_choose_from_tags")+"</a></div>");var I=_ge("tagadder");if(I){I.flickr_photos_getInfo_onLoad=function(q,o,g){if(q){var V=o.documentElement.getElementsByTagName("tag");_rebuild_tags_for_photos(d,V);var J=global_photos[d];var p="";var A="";var f=0;var n=0;var G=new RegExp("^(.+):(.+)=(.+)$");for(var a=0;a<J.tagsA.length;a++){if(G.test(J.tags_rawA[a])&&_ge("themachinetags")){n++;A+=tagrs_rebuildTagsHTML(d,J.tags_idA[a],J.tagsA[a],J.tags_rawA[a],J.tags_canDeleteA[a]);}else{f++;p+=tagrs_rebuildTagsHTML(d,J.tags_idA[a],J.tagsA[a],J.tags_rawA[a],J.tags_canDeleteA[a]);}}tagrs_toggle_displays(f,n);_ge("thetags").innerHTML=p;if(_ge("themachinetags")){_ge("themachinetags").innerHTML=A;}}else{alert("info not got");}};}if(window.deja_view_should_refresh){_ge("thetags").innerHTML="...<br>";}}function machine_tag_toggle_init(){var f=0;var J=0;if(_ge("thetags")){var I=_ge("thetags").getElementsByTagName("div").length;for(var d=0;d<I;d++){if(_ge("thetags").getElementsByTagName("div")[d].style.display!="none"){f++;}}}if(_ge("themachinetags")){var I=_ge("themachinetags").getElementsByTagName("div").length;for(var d=0;d<I;d++){if(_ge("themachinetags").getElementsByTagName("div")[d].style.display!="none"){J++;}}}if(!f&&!J){_ge("thetags").style.display="block";if(_ge("machine_tag_toggle")){_ge("machine_tag_toggle").style.display="none";}if(_ge("themachinetags")){_ge("themachinetags").style.display="none";}}if(f&&!J){_ge("thetags").style.display="block";if(_ge("machine_tag_toggle")){_ge("machine_tag_toggle").style.display="none";}if(_ge("themachinetags")){_ge("themachinetags").style.display="none";}}if(!f&&J){_ge("thetags").style.display="none";if(_ge("machine_tag_toggle")){_ge("machine_tag_toggle").style.display="none";}if(_ge("themachinetags")){_ge("themachinetags").style.display="block";}if(_ge("machine_tag_toggle_show")){_ge("machine_tag_toggle_show").style.display="none";}if(_ge("machine_tag_toggle_hide")){_ge("machine_tag_toggle_hide").style.display="none";}}if(f&&J){_ge("thetags").style.display="block";if(_ge("machine_tag_toggle")){_ge("machine_tag_toggle").style.display="block";}if(_ge("themachinetags")){_ge("themachinetags").style.display="none";}if(_ge("machine_tag_toggle_show")){_ge("machine_tag_toggle_show").style.display="block";}if(_ge("machine_tag_toggle_hide")){_ge("machine_tag_toggle_hide").style.display="none";}}}var nextprev_currentContextLink;var nextprev_currentContextID;nextprev_toggle_set=function(S,I){if(!_ok_for_scrumjax()){return true;}var K=_ge("nextprev_tr_set"+S);if(K.style.display=="none"){var i=nextprev_expand("set",S);if(!i.ready){i.flickr_photosets_getContext_onLoad=i.handleRsp;F.API.callMethod("flickr.photosets.getContext",{photoset_id:S,photo_id:I},i);}}else{nextprev_collapse("set",S);}return false;};nextprev_toggle_pool=function(S,I){if(!_ok_for_scrumjax()){return true;}var K=_ge("nextprev_tr_pool"+S);if(K.style.display=="none"){var i=nextprev_expand("pool",S);if(!i.ready){i.flickr_groups_pools_getContext_onLoad=i.handleRsp;F.API.callMethod("flickr.groups.pools.getContext",{group_id:S,photo_id:I},i);}}else{nextprev_collapse("pool",S);}return false;};nextprev_toggle_stream=function(I,S){if(!_ok_for_scrumjax()){return true;}var K=_ge("nextprev_tr_stream"+I);if(K.style.display=="none"){var i=nextprev_expand("stream",I);if(!i.ready){i.flickr_photos_getContext_onLoad=i.handleRsp;F.API.callMethod("flickr.photos.getContext",{user_id:I,photo_id:S},i);}}else{nextprev_collapse("stream",I);}return false;};nextprev_collapse=function(K,x){var i=_ge("nextprev_tr_"+K+x);var S=_ge("nextprev_crumbs_tr_"+K+x);var I=_ge("contextTitle_"+K+x);i.style.display="none";if(S){S.style.display="none";}I.style.borderBottom="1px solid #f3f3f3";i.ready=1;};nextprev_expand=function(M,S){var L=_ge("nextprev_tr_"+M+S);var i=_ge("nextprev_crumbs_tr_"+M+S);var K=_ge("nextprev_div_"+M+S);var o=_ge("nextprev_mover_div_"+M+S);var t=_ge("contextInfoInner_"+M+S);var j=_ge("photosNum_"+M+S);var x=_ge("photosText_"+M+S);var I=_ge("contextTitle_"+M+S);var T=_ge("slideshowLink_"+M+S);L.showYourself=function(){L.style.display=(F.is_ie)?"block":"table-row";if(i){i.style.display=(F.is_ie)?"block":"table-row";}I.style.borderBottom="0px";if(!L.ready){o.innerHTML="<img src=\""+_images_root+"/context_loading.gif\" width=\"75\" height=\"75\" alt=\"\" />";}};L.showYourself();L.handleRsp=function(H,B,m){if(H){var G=B.documentElement.getElementsByTagName("prevphoto")[0];var g=G.getAttribute("id")*1;var C="";var p="";var r="";var Q="";var Z=false;var E="";if(G&&g!="0"){C=G.getAttribute("url");p=G.getAttribute("thumb");r=" href=\""+C+"\"";Q=" title=\""+F.output.get("nextprev_goto_prev",M)+"\"";_ge("nextprev_arrows_prev_img_"+M+S).style.visibility="visible";if(G.getAttribute("media")=="video"){Z=true;E="<img src=\""+_images_root+"/video_play_icon_small.png\" class=\"trans_png nextprev_stew_indicator\">";}}else{p=_intl_images_root+"/placeholder_first_photo.gif";}var v="<a "+r+" class=\"contextThumbLink\" style=\"position:absolute; left:0px;\"><img "+"id=\"nextprev_thumb_"+M+S+g+"\" "+"class=\"nextprev_thumb\" "+"style=\"visibility:hidden;\" "+"onload=\"F.decorate(this, F._nextprev_thumb).thumb_go_go_go('"+C+"', false, '"+M+"', '"+S+"')\" "+"src=\""+p+"\" "+"width=\"75\" height=\"75\" "+Q+" />"+E+"</a>";K.prev_id=g;K.cache["p"+g]={id:g,url:C,src:p,is_video:Z};var n=B.documentElement.getElementsByTagName("nextphoto")[0];var V=n.getAttribute("id")*1;var l="";var f="";var w="";var O="";var A=false;var D="";if(n&&V!="0"){l=n.getAttribute("url");f=n.getAttribute("thumb");w=" href=\""+l+"\"";O=" title=\""+F.output.get("nextprev_goto_next",M)+"\"";_ge("nextprev_arrows_next_img_"+M+S).style.visibility="visible";if(n.getAttribute("media")=="video"){A=true;D="<img src=\""+_images_root+"/video_play_icon_small.png\" class=\"trans_png nextprev_stew_indicator\">";}}else{f=_intl_images_root+"/placeholder_last_photo.gif";}var h="<a "+w+" class=\"contextThumbLink\" style=\"position:absolute; left:78px;\"><img "+"id=\"nextprev_thumb_"+M+S+V+"\" "+"class=\"nextprev_thumb\" "+"style=\"visibility:hidden;\" "+"onload=\"F.decorate(this, F._nextprev_thumb).thumb_go_go_go(this, '"+l+"', false, '"+M+"', '"+S+"')\" "+"src=\""+f+"\" "+"width=\"75\" height=\"75\" "+O+" />"+D+"</a>";K.next_id=V;K.cache["p"+V]={id:V,url:l,src:f,is_video:A};o.innerHTML=v+h;writeAPIDebug(o.innerHTML);var W=B.documentElement.getElementsByTagName("count")[0].firstChild.nodeValue;j.innerHTML=W.pretty_num();x.innerHTML=F.output.get_plural("mat_group_photo",W);T.style.display=(W<2)?"none":"block";t.style.visibility="visible";}else{alert("Error");}};return L;};F._nextprev_button={button_go_go_go:function(S,I,i){this.c_type=S;this.c_id=I;this.p_id=i;this.closed=new Image();this.closed.src=_images_root+"/context_closed.gif";this.closed_over=new Image();this.closed_over.src=_images_root+"/context_closed_over.gif";this.closed_down=new Image();this.closed_down.src=_images_root+"/context_closed_click.gif";this.open=new Image();this.open.src=_images_root+"/context_open.gif";this.open_over=new Image();this.open_over.src=_images_root+"/context_open_over.gif";this.open_down=new Image();this.open_down.src=_images_root+"/context_open_click.gif";this.isOver=0;this.isDown=0;this.isOpen=(this.get_src_file()=="context_closed.gif")?0:1;Y.U.Event.addListener(this,"mouseover",this.handle_mouseover);Y.U.Event.addListener(this,"mouseout",this.handle_mouseout);Y.U.Event.addListener(this,"click",this.handle_click);Y.U.Event.addListener(this,"mousedown",this.handle_mousedown);},get_src_file:function(){return this.src.split("/").pop();},change_src:function(){if(this.isOpen){if(this.isDown){this.src=this.open_down.src;}else{if(this.isOver){this.src=this.open_over.src;}else{this.src=this.open.src;}}}else{if(this.isDown){this.src=this.closed_down.src;}else{if(this.isOver){this.src=this.closed_over.src;}else{this.src=this.closed.src;}}}},handle_mouseover:function(){this.isOver=1;this.change_src();},handle_mouseout:function(){this.isOver=0;this.change_src();},handle_mousedown:function(){this.isDown=1;this.isOver=1;this.change_src();},handle_click:function(){this.isDown=0;this.isOpen=!this.isOpen;this.isOver=!this.isOpen;this.change_src();window["nextprev_toggle_"+this.c_type](this.c_id,this.p_id);}};F._nextprev_thumb={thumb_go_go_go:function(I,K,i,S){this.url=I;this.c_type=i;this.c_id=S;this.current=(K)?1:0;this.style.visibility="visible";Y.U.Event.addListener(this,"click",this.handle_click);},handle_click:function(S){if(this.url==""){return false;}if(!S){S=window.event;}if(this.current){}else{if(nextprev_currentContextLink){nextprev_currentContextLink.style.fontWeight="normal";nextprev_currentContextLink.style.color="#666666";}var I=_ge("contextLink_"+this.c_type+this.c_id);I.style.fontWeight="bold";I.style.color="#0063DC";if(S.metaKey||S.ctrlKey){}else{if(S.preventDefault){S.preventDefault();}if(S.stopPropagation){S.stopPropagation();}setTimeout("document.location = \""+this.url+"\"",500);}}}};F._nextprev_arrows_div={div_go_go_go:function(x){this.contextThumbsDiv=x;this.direction_to_move=0;for(var S=0;S<this.childNodes.length;S++){var K=this.childNodes[S];K.style.cursor=(F.is_ie)?"hand":"pointer";var T=["left","","right"];if(S==1){var I=K.childNodes[0];I.style.visibility="visible";I.over_src=_intl_images_root+"/context_view_page_over.gif?v1";I.out_src=_intl_images_root+"/context_view_page_out.gif?v1";}else{var I=K;I.over_src=_images_root+"/context_arrow_more_"+T[S]+"_over.gif?v1";I.out_src=_images_root+"/context_arrow_more_"+T[S]+"_out.gif?v1";}if(I.title){F.make_new_mouse_tip(I,"below");}Y.U.Event.addListener(I,"mouseover",function(i){this.src=this.over_src;});Y.U.Event.addListener(I,"mouseout",function(i){this.src=this.out_src;});}Y.U.Event.addListener(this,"click",this.handle_click);},handle_click:function(S){if(this.direction_to_move){return ;}var I=_get_event_src(S);if(I.className=="nextprev_arrows_img_prev"){this.direction_to_move="prev";this.contextThumbsDiv.slide_it(this.contextThumbsDiv.prev_id,this.direction_to_move);}else{if(I.className=="nextprev_arrows_img_next"){this.direction_to_move="next";this.contextThumbsDiv.slide_it(this.contextThumbsDiv.next_id,this.direction_to_move);}else{if(I.className=="contextThumbLink"){return ;}else{return ;}}}}};F._slideshow_button={_decotype:F._simple_button,button_go_go_go:function(){F.make_new_mouse_tip(this,"below");F._slideshow_button._decotype.button_go_go_go.apply(this);},button_default_onclick:function(I){this.blur();return true;}};F._nextprev_div={div_go_go_go:function(t,M,o,I,K,i,L,O,T,x,j){this.prev_id=(t=="")?0:t;this.next_id=(M=="")?0:M;this.prev_url=o;this.next_url=I;this.c_type=L;this.c_id=O;this.current=T;this.p_id=x;this.url=j;this.pos=0;var B=_ge("nextprev_thumb_"+this.c_type+this.c_id+t);var S=_ge("nextprev_thumb_"+this.c_type+this.c_id+M);if(B){F.decorate(B,F._nextprev_thumb).thumb_go_go_go(this.prev_url,this.current,this.c_type,this.c_id);}if(S){F.decorate(S,F._nextprev_thumb).thumb_go_go_go(this.next_url,this.current,this.c_type,this.c_id);}this.arrows_div=_ge("nextprev_arrows_div_"+this.c_type+this.c_id);F.decorate(this.arrows_div,F._nextprev_arrows_div).div_go_go_go(this);this.cache={};if(B&&S&&B!=S){B.parentNode.style.position="absolute";B.parentNode.style.left="0px";S.parentNode.style.position="absolute";S.parentNode.style.left="78px";this.cache["p"+t]={id:this.prev_id,url:this.prev_url,src:B.src,is_video:K};this.cache["p"+M]={id:this.next_id,url:this.next_url,src:S.src,is_video:i};if(t!=""){_ge("nextprev_arrows_prev_img_"+this.c_type+this.c_id).style.visibility="visible";}if(M!=""){_ge("nextprev_arrows_next_img_"+this.c_type+this.c_id).style.visibility="visible";}}F.decorate(_ge("slideshow_link_"+this.c_type+this.c_id),F._slideshow_button).button_go_go_go();},add_thumb:function(t,I,S,p,w,x,r){var B=_ge("nextprev_mover_div_"+this.c_type+this.c_id);if(t!=0){var M=_ge("nextprev_view_page_img_"+this.c_type+this.c_id).parentNode;M.href=this.url+"with/"+t+"/";}var O="nextprev_thumb_"+this.c_type+this.c_id+t;var o=_ge(O);var L=0;if(!o||t==0){var C=document.createElement("a");C.style.position="absolute";C.className="contextThumbLink";o=document.createElement("img");o.src=I;o.className="nextprev_thumb";o.id=O;o.width=o.height=75;L=1;C.appendChild(o);if(r){img2=document.createElement("img");img2.src=_images_root+"/video_play_icon_small.png";img2.className="trans_png nextprev_stew_indicator";img2.width=img2.height=11;C.appendChild(img2);}}else{C=o.parentNode;}if(t!=0){C.href=S;}if(p=="prev"){this.pos--;var K=this.pos*78;C.style.left=K+"px";if(t!=0){o.title=F.output.get("nextprev_goto_prev",this.c_type);}if(L){B.appendChild(F.prepare_for_insertion(C));if(B.childNodes.length>4){for(var j=0;j<B.childNodes.length;j++){var T=B.childNodes[j];if(T.childNodes[0]==x){continue;}if(T.childNodes[0]==w){continue;}F.remove_el(T,B);break;}}}this.next_id=this.prev_id;this.prev_id=t;_ge("nextprev_thumb_"+this.c_type+this.c_id+this.next_id).title=F.output.get("nextprev_goto_next",this.c_type);}else{if(p=="next"){this.pos++;var K=this.pos*78;C.style.left=(K+78)+"px";if(t!=0){o.title=F.output.get("nextprev_goto_next",this.c_type);}if(L){B.appendChild(F.prepare_for_insertion(C));if(B.childNodes.length>4){for(var j=0;j<B.childNodes.length;j++){var T=B.childNodes[j];if(T.childNodes[0]==x){continue;}if(T.childNodes[0]==w){continue;}F.remove_el(T,B);break;}}}this.prev_id=this.next_id;this.next_id=t;_ge("nextprev_thumb_"+this.c_type+this.c_id+this.prev_id).title=F.output.get("nextprev_goto_prev",this.c_type);}else{return ;}}if(L){F.decorate(o,F._nextprev_thumb).thumb_go_go_go(S,this.current,this.c_type,this.c_id);}anim_do_slide_to_x(B,5,40,-K,"easeOutQuad",function(i){},[o]);},slide_it:function(M,O,t){var B=false;var x="";var K="";var j=0;var I=this.cache["p"+M];var C=_ge("nextprev_thumb_"+this.c_type+this.c_id+this.prev_id);var i=_ge("nextprev_thumb_"+this.c_type+this.c_id+this.next_id);var T=_ge("nextprev_arrows_prev_img_"+this.c_type+this.c_id);var o=_ge("nextprev_arrows_next_img_"+this.c_type+this.c_id);if(O=="prev"&&I&&I.prev_id!=undefined){o.style.visibility="visible";o.style.cursor=(F.is_ie)?"hand":"pointer";if(I.prev_id!=0){var L=this.cache["p"+I.prev_id];x=L.url;K=L.src;j=L.id;B=L.is_video;T.style.visibility="visible";o.style.cursor=(F.is_ie)?"hand":"pointer";}else{K=_intl_images_root+"/placeholder_first_photo.gif";T.style.visibility="hidden";o.style.cursor="";}}else{if(O=="next"&&I&&I.next_id!=undefined){T.style.visibility="visible";o.style.cursor=(F.is_ie)?"hand":"pointer";if(I.next_id!=0){var S=this.cache["p"+I.next_id];x=S.url;K=S.src;j=S.id;B=S.is_video;o.style.visibility="visible";o.style.cursor=(F.is_ie)?"hand":"pointer";}else{K=_intl_images_root+"/placeholder_last_photo.gif";o.style.visibility="hidden";o.style.cursor="";hide_tooltip(_ge("nextprev_arrows_next_img_"+this.c_type+this.c_id));}}else{if(t){writeDebug("should have had it in cache");return ;}if(this.c_type=="set"){F.API.callMethod("flickr.photosets.getContext",{photoset_id:this.c_id,photo_id:M},this);}else{if(this.c_type=="pool"){F.API.callMethod("flickr.groups.pools.getContext",{group_id:this.c_id,photo_id:M},this);}else{if(this.c_type=="stream"){F.API.callMethod("flickr.photos.getContext",{user_id:this.c_id,photo_id:M},this);}}}return ;}}this.add_thumb(j,K,x,O,C,i,B);this.arrows_div.direction_to_move=0;},generic_api_onLoad:function(o,j,M,K){if(o){var S="";var I="";var T="";var L=false;if(this.arrows_div.direction_to_move=="prev"){var i=j.documentElement.getElementsByTagName("prevphoto")[0];T=i.getAttribute("id")*1;if(i&&T!="0"){S=i.getAttribute("url");I=i.getAttribute("thumb");if(i.getAttribute("media")=="video"){L=true;}}else{I=_intl_images_root+"/placeholder_first_photo.gif";}this.cache["p"+K.photo_id].prev_id=T;this.cache["p"+T]={next_id:K.photo_id,id:T,url:S,src:I,is_video:L};}else{if(this.arrows_div.direction_to_move=="next"){var x=j.documentElement.getElementsByTagName("nextphoto")[0];T=x.getAttribute("id")*1;if(x&&T!="0"){S=x.getAttribute("url");I=x.getAttribute("thumb");if(x.getAttribute("media")=="video"){L=true;}}else{I=_intl_images_root+"/placeholder_last_photo.gif";}this.cache["p"+K.photo_id].next_id=T;this.cache["p"+T]={prev_id:K.photo_id,id:T,url:S,src:I,is_video:L};}}}else{this.arrows_div.direction_to_move=0;return ;}this.slide_it(K.photo_id,this.arrows_div.direction_to_move,1);}};var upload_uploading=0;function upload_is_safari(){if(navigator.userAgent.indexOf("Safari")!=-1){return 1;}return 0;}function upload_is_moz_one(){if(navigator.userAgent.indexOf("Mozilla/5.0")!=-1&&navigator.userAgent.indexOf("rv:1.0")!=-1){return 1;}return 0;}function upload_click_button(){if(upload_is_safari()){upload_hide_form();document.getElementById("upload_form").submit();}upload_uploading=1;return true;}function upload_submit_form(){if(!upload_is_safari()&&!upload_is_moz_one()){upload_hide_form();}upload_uploading=1;return true;}function upload_hide_form(){document.getElementById("upload_form_container").style.display="none";document.getElementById("upload_uploading_container").style.display="block";}function flashError(){}var escape_utf8_bytes=function(D){if(D===""||D===null||D===undefined){return "";}D=D.toString();var a="";for(var y=0;y<D.length;y++){var x=D.charCodeAt(y);var S=new Array();if(x>65536){S[0]=240|((x&1835008)>>>18);S[1]=128|((x&258048)>>>12);S[2]=128|((x&4032)>>>6);S[3]=128|(x&63);}else{if(x>2048){S[0]=224|((x&61440)>>>12);S[1]=128|((x&4032)>>>6);S[2]=128|(x&63);}else{if(x>128){S[0]=192|((x&1984)>>>6);S[1]=128|(x&63);}else{S[0]=x;}}}if(S.length>1){for(var U=0;U<S.length;U++){a+=(String.fromCharCode(S[U]));}}else{a+=(String.fromCharCode(S[0]));}}return a;};var upPage=new function(){this.toggle=function(){row=_ge("moderation");if(YAHOO.util.Dom.hasClass(row,"open")){YAHOO.util.Dom.removeClass(row,"open");}else{YAHOO.util.Dom.addClass(row,"open");}return false;};};function goOldSkool(U){var S="?";var a=null;for(a in U){if(U.hasOwnProperty(a)&&a!="result"){S+=(a+"="+encodeURI(U[a])+"&");}}S=S.substr(0,S.length-1);window.location.replace(_ge("upload-add-files").href+S);}if(typeof YAHOO.util.BgPosAnim=="undefined"){(function(){YAHOO.util.BgPosAnim=function(D,y,x,c){YAHOO.util.BgPosAnim.superclass.constructor.apply(this,arguments);};YAHOO.extend(YAHOO.util.BgPosAnim,YAHOO.util.Anim);var U=YAHOO.util;var S=U.BgPosAnim.superclass;var a=U.BgPosAnim.prototype;a.toString=function(){var y=this.getEl();var D=y.id||y.tagName;return ("BgPosAnim "+D);};a.patterns.bgPos=/^backgroundPosition|background-position$/i;a.setAttribute=function(y,x,D){if(this.patterns.bgPos.test(y)){x=x[0]+D[0]+" "+x[1]+D[1];YAHOO.util.Dom.setStyle(this.getEl(),y,x);}else{S.setAttribute.apply(this,arguments);}},a.doMethod=function(D,W,x){var t;if(this.patterns.bgPos.test(D)){t=[];for(var c=0,y=W.length;c<y;++c){t[c]=S.doMethod.call(this,D,W[c],x[c]);}}else{t=S.doMethod.apply(this,arguments);}return t;};})();}F.format_file_size=function(a,y,W){var W=(typeof W!="undefined"?W.toLowerCase():"bytes");var y=(typeof y!="undefined"?y.toLowerCase():null);var D={bytes:{string:F.output.format_strs.uploadr_filesize_bytes,scale:1,decimalPlaces:0},kb:{string:F.output.format_strs.uploadr_filesize_kb,scale:1024,decimalPlaces:1},mb:{string:F.output.format_strs.uploadr_filesize_mb,scale:1024*1024,decimalPlaces:2},gb:{string:F.output.format_strs.uploadr_filesize_gb,scale:1024*1024*1024,decimalPlaces:2},decimal:".",result_format:"<!! dev=\"chronic\">%number %units</!!>"};var c=(D[W]?D[W]:D.bytes);if(!y){y="bytes";var n=a*c.scale;if(n>=D.gb.scale){y="gb";}else{if(n>=D.mb.scale){y="mb";}else{if(n>=D.kb.scale){y="kb";}}}}var t=(D[y]?D[y]:null);var S=c.scale/t.scale;var U=(a*S).toFixed(t.decimalPlaces);if(U.substr(U.length-3)==".00"){U=U.substr(0,U.length-3);}if(U.substr(U.length-2)==".0"){U=U.substr(0,U.length-2);}var x=D.result_format.replace("%number",(U.toString().replace(".",D.decimal)));x=x.replace("%units",t.string);return x;};function toggleModeration(){var a=_ge("moderation_toggle");if(YAHOO.util.Dom.hasClass(a,"open")){YAHOO.util.Dom.removeClass(a,"open");}else{YAHOO.util.Dom.addClass(a,"open");}}function showBandwidthNotice(){var c=_ge("bandwidth");if(!c){return false;}var S=_ge("bandwidth-used");var a=_bytes_used;var x=_bytes_left;var D=(a/x);var y=F.format_file_size(x,"mb");var U="low";if(D>0.5){U="moderate";}else{if(D>0.75){U="high";}}S.className=U;}F.uploadr=null;F.Uploadr=function(){if(typeof y=="undefined"){var y=function(W){return document.getElementById(W);};}var S=this;var U=S;this.url=(typeof window._upload_api_root!="undefined"?window._upload_api_root:_api_root)+"/services/upload/";this.data={bytesUploaded:0,bytesTotal:0,fileCount:0};this.params={api_key:global_magisterLudi,async:true,auth_hash:global_auth_hash,auth_s:_get_cookie("cookie_session"),chronic:1};this.stats={photos:0,bytes:0,upload_time:0,errors:0,chronic:1};this.didStatsSubmit=false;this.statsTimer=null;var x=0;this.async=this.params.async;var a={ANIM:0.6,EASE:YAHOO.util.Easing.easeBothStrong,FILE_TIMEOUT:1000*60,FOO:"BAR"};this.mb=1024*1024;this.oversizeFiles=0;this.maxFileSize=((global_ispro?10:5)*this.mb);this.uploadActive=false;this.uploadStarted=false;this.uploadComplete=false;this.files=[];this.photoIDs=[];this.failedFiles=0;this.failedFilesBytes=0;this.currentFile=null;this.isEmpty=true;this.fileTypes=[{description:"Images",extension:"*.jpg;*.JPG;*.jpeg;*.JPEG;*.bmp;*.BMP;*.gif;*.GIF;*.png;*.PNG;*.tif;*.TIF;*.tiff;*.TIFF"}];if(!navigator.userAgent.match(/macintosh/i)){this.fileTypes[this.fileTypes.length]={description:"All Files",extension:"*.*"};}this.fileTypes[0].description+=" ("+this.fileTypes[0].extension+")";this.o=y("upload-table");this.oWidth=0;this.barWidth=800;this.barOffset=60;this.oForm=y("upload_form");this.oControl=null;this.oAdd=y("upload-add-files");this.oAddMore=y("upload-add-more");this.oRemove=y("upload-remove-files");this.oList=y("uploadr-list");this.oStatus=y("upload-container");this.oUpOverSize=y("upload-oversize");this.oUpOverLimit=y("upload-overlimit");this.oUpOneFailed=y("uploadr-one-failed");this.oUpSomeFailed=y("uploadr-some-failed");this.oUpAllFailed=y("uploadr-all-failed");this.oStatusProgress=y("uploadr-status").getElementsByTagName("div")[0];this.oOffline=document.createDocumentFragment();this.strings={messages:{overSize:this.oUpOverSize.innerHTML,overLimit:this.oUpOverLimit.innerHTML,upOneFailed:this.oUpOneFailed.innerHTML,upSomeFailed:this.oUpSomeFailed.innerHTML,upAllFailed:this.oUpAllFailed.innerHTML},fileCountSingle:YAHOO.util.Dom.getElementsByClassName("single","span",y("upload-total-files"))[0].innerHTML,fileCountPlural:YAHOO.util.Dom.getElementsByClassName("plural","span",y("upload-total-files"))[0].innerHTML,bytesCount:y("upload-total-bytes").innerHTML,pageTitleStatus:YAHOO.util.Dom.getElementsByClassName("title-status","li",y("upload-templates"))[0].innerHTML.replace("%pagetitle",document.title),pageTitleProcessing:YAHOO.util.Dom.getElementsByClassName("title-processing","li",y("upload-templates"))[0].innerHTML.replace("%pagetitle",document.title),pageTitleDefault:document.title};this.lastState=null;var t=(isIE&&navigator.appVersion.indexOf("MSIE 6")!=-1);var c=(navigator.userAgent.match(/firefox/i));if(c){YAHOO.util.Dom.addClass(S.oStatus,"firefox");}this.getControl=function(){var W="yUpload";S.oControl=(isIE?window[W]:document[W]);};this.getMaxFileSize=function(){return this.maxFileSize;};this.getModerationSettings=function(){var r=y("moderation_container");var n=r.getElementsByTagName("input");var s=null;var W=null;for(var X=n.length;X--;){if(n[X].name&&!n[X].disabled&&((n[X].type=="radio"&&n[X].checked)||(n[X].type=="checkbox"&&n[X].checked)||n[X].type=="hidden")){s=n[X].name.indexOf("_0")!=-1?n[X].name.substr(0,n[X].name.lastIndexOf("_0")):n[X].name;W=(n[X].name=="safety_level"||n[X].name=="content_type"?parseInt(n[X].value)+1:n[X].value);if(n[X].name=="hidden"){W=(n[X].checked?2:1);}S.params[s]=W;}}var J=_ge("is_friend_0");var A=_ge("is_family_0");if(!J.disabled){S.params["is_friend"]=(J.checked?1:0);}if(!A.disabled){S.params["is_family"]=(A.checked?1:0);}};this.setState=function(W){if((W=="canceled"||W=="failed")&&S.lastState=="ok"){return false;}if(S.lastState){YAHOO.util.Dom.removeClass(S.oStatus,S.lastState);}S.lastState=W;YAHOO.util.Dom.addClass(S.oStatus,W);};this.setPageTitle=function(W,n,J){try{var A=(typeof W!="undefined"?S.strings[W].replace(n,J):S.strings["pageTitleDefault"]);if(document.title!=A){document.title=A;}}catch(X){}};this.setPageIcon=function(W){if(!c){return false;}if(!W){var W="/favicon.ico";}if(y("oldPageIcon")){y("oldPageIcon").parentNode.removeChild(y("oldPageIcon"));}link=document.createElement("link");link.id="oldPageIcon";link.href=W;link.type=(isIE?"image/vnd.microsoft.icon":"image/ico");link.rel=(isIE?"shortcut icon":"icon");document.getElementsByTagName("head")[0].appendChild(link);};this.File=function(n){var W=this;this.o=null;this.oWidth=0;this.oCheckbox=null;this.oRemove=null;this.complete=false;this.state="default";this.lastState=this.state;this.nextState=null;this.oData=n;this.oStub=document.createElement("div");this.bestDate=n.bestDate;this.bestDateStamp=null;this.data={id:n.id,url:n.url,bytesTotal:n.bytesTotal,mDate:n.mDate,cDate:n.cDate,bytesUploaded:0,lastBytesUploaded:0};this.isOversize=(this.data.bytesTotal>U.getMaxFileSize(this.data.url));if(this.isOversize){U.oversizeFiles++;}this.poll={retryCount:0,pendingResponse:0,pollCount:0,pollCountSegments:4,pollOffset:0};this.timeoutTimer=null;this.oAnimPoll=null;this.ticket=null;this.isOverLimit=false;this.allowUpload=(!this.isOversize);this.reset=function(){if(W.state=="error"){W.setTooltip("");W.data.bytesUploaded=0;W.data.lastBytesUploaded=0;W.nextState=null;W.setState("default");W.animateColor("#000");if(W.oAnimPoll){W.oAnimPoll.stop();}W.o.style.backgroundPosition=(-U.barWidth+"px 0px");}};this.timeoutCheck=function(){W.timeoutTimer=null;if(W.state=="uploading"){U.doFileError(W);W.setTooltip("file upload stall/timeout");U.oControl.cancel(W.data.id);U.refreshProgress();window.setTimeout(U.uploadNextFile,1000);}};this.setTimeoutEvent=function(){if(W.timeoutTimer){window.clearTimeout(W.timeoutTimer);}W.timeoutTimer=window.setTimeout(W.timeoutCheck,a.FILE_TIMEOUT);};this.animatePollingTween=function(){if(!W||W.nextState=="ok"||W.nextState=="error"){return false;}var X=parseInt(this.getAttribute("marginLeft"));if(isNaN(X)||(this.currentFrame<this.totalFrames&&X==0)){return false;}W.poll.pollOffset=X;W.o.style.backgroundPosition=(X+"px 0px");};this.animateColor=function(A){var X=new YAHOO.util.ColorAnim(W.o,{color:{to:A}},a.ANIM,YAHOO.util.Easing.easeBoth);X.animate();};this.resetBackground=function(){W.oSelect.style.backgroundPosition="50% 32px";};this.animateOut=function(){var X=new YAHOO.util.BgPosAnim(W.o,{backgroundPosition:{from:[-U.barWidth+W.oWidth,0],to:[-U.barWidth+W.oWidth,24],unit:["px","px"]}},a.ANIM,YAHOO.util.Easing.bounceOut);var A=new YAHOO.util.BgPosAnim(W.oSelect,{backgroundPosition:{from:[50,24],to:[50,5],unit:["%","px"]}},a.ANIM,YAHOO.util.Easing.bounceOut);W.resetBackground();W.setState(W.nextState);W.resetBackground();if(W.nextState=="ok"){X.onComplete.subscribe(function(){W.o.style.backgroundImage="none";});}X.animate();A.animate();};this.animateProcessingOut=function(){var A=-U.barWidth+parseInt(W.data.bytesUploaded/W.data.bytesTotal*W.oWidth);var X=new YAHOO.util.BgPosAnim(W.o,{backgroundPosition:{from:[W.poll.pollOffset,0],to:[A,0],unit:["px","px"]}},a.ANIM,a.EASE);X.onComplete.subscribe(function(){W.animateOut();});X.animate();};this.animatePoll=function(r){var J=-U.barWidth+W.oWidth;var s=J-U.barOffset;var i=s;var X=J;W.poll.pollOffset=i;var A=new YAHOO.util.Anim(W.oStub,{marginLeft:{from:s,to:J}},r,YAHOO.util.Easing.easeNone);A.onTween.subscribe(W.animatePollingTween);W.oAnimPoll=A;window.setTimeout(function(){A.animate();},a.ANIM*1000);};this.startPolling=function(){W.animatePoll(U.poll.delay*(Math.pow(2,U.poll.retryCountMax))/1000);};this.onUploadComplete=function(){};this.onComplete=function(){W.complete=true;W.animateColor("#999");W.nextState="ok";W.animateProcessingOut();U.removeFile(W.data.id);U.updateTicketRequests();};this.onError=function(){W.nextState="error";W.animateProcessingOut();W.data.bytesUploaded=0;W.poll.pollCount=0;W.animateColor("#cc3333");};this.setState=function(X){if((X=="canceled"||X=="failed")&&W.lastState=="ok"){return false;}if((W.isOversize||W.isOverLimit)&&X=="ok"){return false;}if(W.lastState){YAHOO.util.Dom.removeClass(W.o,W.lastState);}W.state=X;W.lastState=X;YAHOO.util.Dom.addClass(W.o,X);};this.setSelected=function(X){if(X){return W.select();}else{return W.deselect();}};this.select=function(){if(!W.isSelected){YAHOO.util.Dom.addClass(W.o,"selected");W.isSelected=true;return true;}return false;};this.deselect=function(){if(W.isSelected){YAHOO.util.Dom.removeClass(W.o,"selected");W.isSelected=false;return true;}return false;};this.focus=function(){var s=y("uploadr-scroll");var A=parseInt(W.o.offsetHeight);var i=parseInt(W.o.offsetTop);var J=parseInt(s.offsetHeight);var u=parseInt(s.scrollTop);var r=((i+A)>(u+J));var X=(u>i);if((r||X)&&!s._isScrolling){var k=new YAHOO.util.Scroll(s,{scroll:{to:[0,i-(r?A:0)]}},a.ANIM*2,a.EASE);s._isScrolling=true;k.onComplete.subscribe(function(){s._isScrolling=false;});k.animate();}W.oWidth=parseInt(U.oList.offsetWidth);};this.setTooltip=function(X){if(_show_tooltips!="1"){return false;}W.o.getElementsByTagName("div")[0].innerHTML=(W.data.url.indexOf("/")==-1?W.data.url:W.data.url.substr(W.data.url.lastIndexOf("/")))+(X?" <b>A/D: "+X+"</b>":"");W.o.title=X;};this.init=function(){var X=0;W.o=y("tmpl-upload-item").cloneNode(true);W.oSelect=W.o.getElementsByTagName("div")[2];W.o.id="";W.o.title=W.data.url+" - "+new Date(W.bestDate).toLocaleString();W.o.getElementsByTagName("div")[0].innerHTML=(W.data.url.indexOf("/")==-1?W.data.url:W.data.url.substr(W.data.url.lastIndexOf("/")));W.oRemove=W.o.getElementsByTagName("a")[0];YAHOO.util.Event.addListener(W.oRemove,"click",W.removeAndDestruct,W);var A=W.o.getElementsByTagName("div")[1];A.innerHTML=A.innerHTML.replace("%filesize",F.format_file_size(W.data.bytesTotal));if(W.isOversize){W.setState("oversize");X=1;}U.oOffline.appendChild(W.o);W.oWidth=parseInt(U.oList.offsetWidth);if(!W.oWidth){W.oWidth=(global_ispro?736:400);}W.poll.pollOffset=-U.barWidth+W.oWidth-U.barOffset;return X;};this.setData=function(A){var X=null;for(X in A){W.data[X]=A[X];}};this.refreshProgress=function(X){if(X){W.data.bytesUploaded=W.data.bytesTotal;}var i=(W.data.bytesUploaded==W.data.bytesTotal);if(i&&!W.o._isAnimating&&W.lastState!="processing"&&W.lastState!="complete"){W.setState("processing");W.resetBackground();W.startPolling();}else{if(!W.complete&&W.lastState!="uploading"&&W.lastState!="processing"){W.setState("uploading");}}var J=-U.barWidth+parseInt(W.data.bytesUploaded/W.data.bytesTotal*(W.oWidth-U.barOffset));if(!W.o._isAnimating&&W.data.lastBytesUploaded==0&&W.data.bytesUploaded==W.data.bytesTotal){var s=-U.barWidth+parseInt(W.data.lastBytesUploaded/W.data.bytesTotal*(W.oWidth-U.barOffset));W.o._isAnimating=true;var A=new YAHOO.util.BgPosAnim(W.o,{backgroundPosition:{from:[s,0],to:[J,0],unit:["px","px"]}},a.ANIM,a.EASE);A.onComplete.subscribe(function(){W.o._isAnimating=false;W.setState("processing");});A.animate();}else{if(!W.o._isAnimating&&W.state!="failed"){W.o.style.backgroundPosition=(J+"px 0px");}}W.data.lastBytesUploaded=W.data.bytesUploaded;};this.remove=function(){if(W.isOversize){U.oversizeFiles--;}if(!U.uploadStarted){W.o.parentNode.removeChild(W.o);}};this.removeAndDestruct=function(X){U.removeFile(W.data.id);YAHOO.util.Event.preventDefault(X||event);return false;};this.destruct=function(){W.o=null;W=null;};};this.fileExists=function(A){var X=false;var W=null;var n=null;for(W in S.files){X=true;for(n in S.files[W].oData){if(n!="id"&&(S.files[W]).oData[n]!=A[n]){X=false;}}if(X){return true;}}return false;};this.addFile=function(n){if(S.files[n.id]){return false;}if(S.fileExists(n)){return false;}S.files[n.id]=new S.File(n);var W=S.files[n.id].init();if(W==0){S.data.fileCount++;S.data.bytesTotal+=parseInt(n.bytesTotal);}if(S.isEmpty){S.isEmpty=false;S.setStep("step2");}};this.selectFiles=function(W){S.oControl.browseMultiple(S.fileTypes);YAHOO.util.Event.preventDefault(W||event);return false;};this.setStep=function(W){var n=y("uploadr");if(!YAHOO.util.Dom.hasClass(n,W)){n.className=W+(global_ispro?" pro":"");}};this.removeFile=function(W,n){if(!S.files[W]||S.uploadStarted){return false;}if(!S.files[W].isOversize){S.data.fileCount--;S.data.bytesTotal-=parseInt(S.files[W].data.bytesTotal);}S.files[W].remove();S.oControl.removeFile(S.files[W].data.id);S.files[W].destruct();delete S.files[W];S.doEmptyCheck();if(!n){U.refreshTotals();U.refreshMessages();}};this.refreshTotals=function(){var W=[S.strings["fileCountSingle"].replace("%files",S.data.fileCount),S.strings["fileCountPlural"].replace("%files",S.data.fileCount)];YAHOO.util.Dom.getElementsByClassName("single","span",y("upload-total-files"))[0].innerHTML=W[0];YAHOO.util.Dom.getElementsByClassName("plural","span",y("upload-total-files"))[0].innerHTML=W[1];y("upload-total-files").className=(S.data.fileCount!=1?"plural":"single");y("upload-total-bytes").innerHTML=S.strings["bytesCount"].replace("%bytes",F.format_file_size(S.data.bytesTotal));};this.refreshMessages=function(){var r=y("uploadr-messages");if(S.oversizeFiles>0){S.oUpOverSize.innerHTML=S.strings.messages["overSize"].replace("%filecount",S.oversizeFiles);YAHOO.util.Dom.addClass(r,"oversize");}else{YAHOO.util.Dom.removeClass(r,"oversize");}var A=null;var n=0;var s=0;var J=_ge("bandwidth-used");W=(global_ispro?0:parseInt(J.innerHTML));var W=(global_ispro?0:parseInt(J.innerHTML));var i=(global_ispro?8192*1024*1024:_bytes_left);for(A in S.files){if(!S.files[A].isOversize){n+=S.files[A].data.bytesTotal;if(n>i){s++;S.files[A].isOverLimit=true;YAHOO.util.Dom.addClass(S.files[A].o,"overlimit");}else{if(S.files[A].isOverLimit){S.files[A].isOverLimit=false;S.files[A].deselect();YAHOO.util.Dom.removeClass(S.files[A].o,"overlimit");}}}}if(s>1){for(A in S.files){if(S.files[A].isOverLimit){S.files[A].select();}else{S.files[A].deselect();}}var X=S.strings.messages.overLimit.replace("%filecount",S.data.fileCount);X=X.replace("%filesize",F.format_file_size(S.data.bytesTotal));X=X.replace("%extrabytes",F.format_file_size(S.data.bytesTotal-i));S.oUpOverLimit.innerHTML=X;YAHOO.util.Dom.addClass(r,"overlimit");YAHOO.util.Dom.addClass(S.o,"overlimit");}else{YAHOO.util.Dom.removeClass(r,"overlimit");YAHOO.util.Dom.removeClass(S.o,"overlimit");}};this.doEmptyCheck=function(){if(S.oList.getElementsByTagName("li").length==1&&!S.isEmpty){S.isEmpty=true;S.setButtonState("");S.setStep("step1");}else{if(S.isEmpty){S.isEmpty=false;YAHOO.util.Dom.addClass(S.o,"has-content");}}};this.setData=function(n){var W=null;for(W in n){S.data[W]=n[W];}};this.setFileState=function(n){var W=null;for(W in S.files){S.files[W].setState(n);}};this.setButtonState=function(W){y("upload-buttons").className=(typeof W!="undefined"?W:"default");};this.setCompleteState=function(W){y("uploadr-complete-messages").className=W;};this.doAdJax=function(){var n=document.createElement("iframe");n.id="uploadr-ad";n.className="ad-iframe";n.style.margin="0px;";n.style.padding="0px";n.style.border="none";try{n.scrolling="no";}catch(W){}y("ad-element").appendChild(n);n.src="/adjax_iframe.gne?s=792600150&p=LREC";};this.startUpload=function(W){if(S.uploadActive){return false;}x=new Date();S.uploadActive=true;S.uploadStarted=true;S.oWidth=parseInt(S.oList.offsetWidth);S.getModerationSettings();YAHOO.util.Dom.addClass(S.o,"no-remove");S.setState("uploading");S.setPageIcon("/images/upload/balls-16x16-nopad-fortab2.gif");S.setButtonState("uploading");y("moderation_container").style.display="none";YAHOO.util.Dom.addClass(S.oStatus,"active");YAHOO.util.Dom.addClass(S.oStatus,"uploading");if(global_ispro){S.uploadNextFile();}else{S.doAdJax();setTimeout(S.uploadNextFile,1500);}if(typeof W!="undefined"||typeof event!="undefined"){YAHOO.util.Event.preventDefault(W||event);}return false;};this.cancelUpload=function(){if(!S.uploadActive){return false;}S.uploadActive=false;S.oControl.cancel();S.setFileState("canceled");S.setButtonState("finished");S.setState("canceled");S.setPageTitle();};this.retryUpload=function(){S.setCompleteState("");S.failedFiles=0;S.failedFilesBytes=0;S.resetBadFiles();S.uploadActive=false;S.setState("uploading");x=new Date();S.uploadNextFile();};this.scrollToTop=function(){var W=new YAHOO.util.Scroll(y("uploadr-scroll"),{scroll:{to:[0,0]}},a.ANIM*2,a.EASE);W.animate();};this.resetBadFiles=function(){var W=null;for(W in S.files){S.files[W].reset();}};this.uberSort=function(n,W){var A=n.toLowerCase();var X=W.toLowerCase();return (A>X)?1:((A<X)?-1:0);};this.uploadNextFile=function(){var W=null;var n=false;for(W in S.files){if(!n&&S.files[W].allowUpload&&S.files[W].state=="default"){n=true;if(S.currentFile&&S.async){S.data.bytesUploaded+=S.currentFile.data.bytesTotal;}S.currentFile=S.files[W];S.files[W].focus();S.files[W].setState("uploading");S.files[W].setTimeoutEvent();S.uploadMostDefinitely(S.files[W].data);}}if(!n){if(S.async&&S.poll.tickets.length){S.setPageTitle("pageTitleProcessing");window.setTimeout(S.uploadNextFile,500);}else{if(S.async){S.onCompleteAnimation(S._onComplete);}else{S._onComplete();}}}};this.uploadMostDefinitely=function(W){var A=[];for(var X in U.params){A[A.length]=X+U.params[X];}A[A.length]="Filename"+W.url;A[A.length]="UploadSubmit Query";A.sort();var n=A.join("");S.api_sig=md5_calcMD5(escape_utf8_bytes(global_flickr_secret+n));S.oControl.setVar(W.id,S.params);S.oControl.setVar(W.id,{"api_sig":S.api_sig});S.oControl.setFileVarName(W.id,"photo");S.oControl.upload(W.id,S.url);};this.refreshProgress=function(){var n=S.data.bytesTotal;var X=S.data.bytesUploaded+S.currentFile.data.bytesUploaded+S.failedFilesBytes;S.oStatusProgress.style.width=((parseInt(X/n*(S.oWidth-S.barOffset)))+"px");var W=Math.floor(X/n*99);W=Math.max(0,Math.min(100,W));S.setPageTitle("pageTitleStatus","%percentuploaded",W);};this.onCompleteAnimation=function(W){var n=new YAHOO.util.Anim(S.oStatusProgress,{width:{to:S.oWidth+8}},a.ANIM,a.EASE);n.onComplete.subscribe(function(){W();});n.animate();};this.getFileByTicket=function(W){var n=null;for(n in U.files){if(U.files[n].ticket==W){return U.files[n];}}};this.getFilesByTickets=function(J){var A=[];var X=null;for(var n=0,W=J.length;n<W;n++){X=S.getFileByTicket(J[n]);if(X){A[A.length]=X;}}return A;};this.poll={active:0,tickets:[],ticketCount:0,delay:500,pollTimer:null,retryCount:0,retryCountMax:5};this.startPolling=function(){if(S.poll.active){return false;}S.poll.active=true;S.pollRequest();};this.stopPolling=function(){if(!S.poll.active){return false;}S.poll.active=false;};this.pollRequest=function(){if(S.poll.pendingResponse){}else{S.poll.pendingResponse=true;var n=S.getFilesByTickets(S.poll.tickets);for(var W=n.length;W--;){if(n[W].poll.pollCount==0){n[W].poll.pollCount++;}}F.API.callMethod("flickr.photos.upload.checkTickets",{tickets:S.poll.tickets.join(",")},S);}};this.flickr_photos_upload_checkTickets_onLoad=function(k,u,r,n){S.poll.pendingResponse=false;if(u){var s=u.documentElement;var W=s.getElementsByTagName("ticket");for(var J=0,X=W.length;J<X;J++){S.checkTicket(W[J]);}}if(S.poll.tickets.length>0){S.poll.retryCount++;var A=S.poll.delay*(Math.pow(2,S.poll.retryCount));S.poll.pollTimer=window.setTimeout(S.pollRequest,A);}else{S.stopPolling();}};this.checkTicket=function(X){var n=X.getAttribute("complete");var J=X.getAttribute("id");var A=U.getFileByTicket(J);if(!A){S.removeTicket(J);return false;}if(n==0&&A.poll.retryCount<S.poll.retryCountMax){A.poll.retryCount++;}else{if(n==1){S.removeTicket(J);var W=X.getAttribute("photoid");S.doFileComplete(A,W);}else{if(n==2){S.removeTicket(J);A.setTooltip("processing conversion failed");S.doFileError(A);}else{if(A.poll.retryCount>=A.poll.retryCountMax){S.removeTicket(J);A.setTooltip("polling (processing) retry timeout");S.doFileError(A);}}}}return n;};this.ticketExists=function(W){for(var n=S.poll.tickets.length;n--;){if(S.poll.tickets[n]==W){return true;}}return false;};this.addTicket=function(W){if(!S.ticketExists(W)){S.poll.tickets[S.poll.tickets.length]=W;S.poll.ticketCount++;}};this.removeTicket=function(W){for(var n=0;n<S.poll.tickets.length;n++){if(S.poll.tickets[n]==W){S.poll.tickets.splice(n,1);S.poll.ticketCount--;return true;}}return false;};this.updateTicketRequests=function(){if(S.async&&S.poll.tickets.length&&S.poll.pollTimer!=null){var W=500;window.clearTimeout(S.poll.pollTimer);S.poll.pollTimer=null;S.poll.pendingResponse=false;window.setTimeout(function(){S.poll.pollTimer=window.setTimeout(S.pollRequest,W);},250);}};this.describePhotos=function(){if(!S.photoIDs.length){window.location.reload();}y("uploadr-ids").value=S.photoIDs.join(",");y("photo-edit-form").submit();};this.sortFilesByName=function(n,W){var A=n.name.toLowerCase();var X=W.name.toLowerCase();return (A>X)?1:((A<X)?-1:0);};this.invalidDate=function(W){return (new Date(W).getYear()<70);};this.sortFilesByBestDateStamp=function(n,W){var A=n.bestDateStamp;var X=W.bestDateStamp;return (A>X)?1:((A<X)?-1:0);};this._onSelect=function(n){var W=n.fileList;var J=[];for(A in W){W[A].bestDate=(S.invalidDate(W[A].cDate)?W[A].mDate:W[A].cDate);W[A].bestDateStamp=new Date(W[A].bestDate).getTime();J[J.length]=W[A];}J.sort(S.sortFilesByBestDateStamp);var A=null;for(var X=0;X<J.length;X++){S.addFile({id:J[X].id,url:J[X].name,bytesTotal:J[X].size,cDate:J[X].cDate,mDate:J[X].mDate,bestDate:J[X].bestDate});}S.oList.appendChild(S.oOffline);S.oOffline=document.createDocumentFragment();S.refreshTotals();S.refreshMessages();S.setButtonState();};this._onProgress=function(W){var n=W.id;if(S.files[n]){S.files[n].data.lastBytesUploaded=S.files[n].data.bytesUploaded;S.files[n].setData({bytesUploaded:W.bytesLoaded,bytesTotal:W.bytesTotal});S.files[n].refreshProgress();S.files[n].setTimeoutEvent();S.refreshProgress();}};this._onComplete=function(){S.stats.upload_time+=(new Date()-x);S.setPageIcon();S.setButtonState("finished");S.setState("complete");S.oStatusProgress.style.width="0px";if(S.failedFiles>0){if(S.failedFiles==S.data.fileCount){S.setCompleteState("all-failed");S.submitStats();}else{if(S.failedFiles>1){S.oUpSomeFailed.innerHTML=S.strings.messages.upSomeFailed.replace("%filecount",S.failedFiles);S.setCompleteState("some-failed");}else{S.setCompleteState("one-failed");}}S.uploadStarted=false;}else{S.setCompleteState("ok");S.submitStats();}S.setPageTitle("pageTitleStatus","%percentuploaded",100);S.uploadComplete=true;};this._onFileComplete=function(W){};this._onFileCompleteData=function(A){var X=A.id;var i=S.files[X];if(!i){return false;}i.refreshProgress(true);var J=F.str_to_XML(A.data);var n=(J.getElementsByTagName("rsp")[0]&&J.getElementsByTagName("rsp")[0].getAttribute("stat")=="ok");var W=J.getElementsByTagName("photoid")[0];if(S.async){var r=null;try{r=(J.getElementsByTagName("ticketid")[0].childNodes[0].nodeValue);}catch(s){r=null;}if(!r){i.setTooltip("bad API response/no ticket");S.doFileError(i);setTimeout(S.uploadNextFile,50);return false;}i.ticket=r;U.addTicket(r);U.startPolling();setTimeout(S.uploadNextFile,50);}else{if(n&&W){W=parseInt(parseInt(J.getElementsByTagName("photoid")[0].childNodes[0].nodeValue));S.doFileComplete(i,W);}else{i.setTooltip("response indicates fail ("+parseInt(parseInt(J.getElementsByTagName("photoid")[0].childNodes[0].nodeValue))+")");S.doFileError(i);}setTimeout(S.uploadNextFile,50);}};this.doFileComplete=function(W,n){if(n){S.photoIDs[S.photoIDs.length]=n;}if(!S.async){S.data.bytesUploaded+=W.data.bytesTotal;}W.oSelect.style.backgroundPosition="50% 32px";S.poll.retryCount=Math.max(0,S.poll.retryCount-W.poll.retryCount);W.onComplete();};this.doFileError=function(W){S.stats.errors++;S.poll.retryCount=Math.max(0,S.poll.retryCount-W.poll.retryCount);W.onError();S.failedFiles++;S.failedFilesBytes+=W.data.bytesTotal;if(S.async){S.data.bytesUploaded-=W.data.bytesTotal;}};this._onHTTPError=function(){S.files[S.currentFile].setTooltip("fatal HTTP error (called from Flash)");S.doFileError(S.files[S.currentFile]);setTimeout(S.uploadNextFile,100);};this._onError=function(W){S.files[S.currentFile].setTooltip("http/io/security error from Flash - "+W.type+", "+W.status);S.doFileError(S.files[S.currentFile]);setTimeout(S.uploadNextFile,100);};this.setBGCache=function(W){try{document.execCommand("BackgroundImageCache",false,W);}catch(n){}};this.getStats=function(){S.stats.photos=S.data.fileCount;S.stats.bytes=S.data.bytesTotal;S.stats.upload_time=S.stats.upload_time;};this.submitStats=function(){if(S.didStatsSubmit){return false;}S.didStatsSubmit=true;S.getStats();if(_use_stats=="1"){F.API.callMethod("flickr.utils.logUploadStats",S.stats,S);}};this.submitAndContinue=function(){if(_use_stats!="1"){F.uploadr.describePhotos();}S.flickr_utils_logUploadStats_onLoad=S.statsSubmitComplete;if(!S.didStatsSubmit){if(!S.statsTimer){S.statsTimer=window.setTimeout(F.uploadr.describePhotos,5000);}S.submitStats();}else{F.uploadr.describePhotos();}};this.flickr_utils_logUploadStats_onLoad=function(A,X,W,n){};this.statsSubmitComplete=function(A,X,W,n){if(S.statsTimer){window.clearTimeout(S.statsTimer);S.statsTimer=null;}F.uploadr.describePhotos();};this.destruct=function(){U=null;S=null;};YAHOO.util.Event.addListener(S.oAdd,"click",S.selectFiles,S);YAHOO.util.Event.addListener(y("start-upload"),"click",S.startUpload,S);YAHOO.util.Event.addListener(y("cancel-upload"),"click",S.cancelUpload,S);S.getControl();if(!S.oControl){}try{S.oControl.addEventListener("fileSelect","F.uploadr._onSelect");S.oControl.addEventListener("uploadStart","F.uploadr._onStart");S.oControl.addEventListener("uploadProgress","F.uploadr._onProgress");S.oControl.addEventListener("uploadCompleteData","F.uploadr._onFileCompleteData");S.oControl.addEventListener("uploadError","F.uploadr._onError");}catch(D){enableChoosePhotos();goOldSkool();}enableChoosePhotos();if(t){S.setBGCache(true);YAHOO.util.Event.addListener(window,"beforeunload",function(){S.setBGCache(false);});}};function initUploadr(){if(!document.getElementById("uploadr")){return false;}setTimeout(createUploadr,navigator.userAgent.match(/Opera/i)?750:20);}function createUploadr(){F.uploadr=new F.Uploadr();}function disableChoosePhotos(){_ge("step1").className="disabled";}function enableChoosePhotos(){_ge("step1").className="enabled";}function createUploadMovie(){var a=new SWFObject("/images/upload/yuploadcomponent.swf","yUpload",1,1,9,"#fff");a.addParam("allowScriptAccess","always");a.write("yuploadcontrol");if(isIE){window.yUpload=document.getElementById("yUpload");}}function checkFlash(){var a=deconcept.SWFObjectUtil.getPlayerVersion();alert(a.major+"."+a.minor+"r"+a.rev);}function uploadrSupported(){if(window.location.href.match(/nocheck/i)){return true;}var a=deconcept.SWFObjectUtil.getPlayerVersion();if(navigator.platform.match(/linux/i)&&a.major==9&&a.minor==0){if(a.rev<60){return {result:false,reason:"needupgrade"};}else{return {result:true};}}if(document.getElementById&&a.major>0){if(a.major<9){return {result:false,reason:"needupgrade"};}else{if(a.major==9&&a.minor==0&&a.rev==16){return {result:false,reason:"badversion"};}if(a.major==9&&a.minor==0&&a.rev==0){return {result:true};}return {result:true};}}else{return {result:false,reason:"noflash"};}}function tryUploadInit(){disableChoosePhotos();var a=uploadrSupported();if(a.result==false){enableChoosePhotos();goOldSkool(a);}else{createUploadMovie();}}YAHOO.util.Event.addListener(window,"load",initUploadr);var snagit=2;F.geotagger={closed:true,loaded_geobookmarks:false,already_loading_js:false,block_size:[],new_map_link:{},two_second_delay_time_started_for_dunstan_because_he_is_picky_like_that:0,saved_responseXML:"",geotagger_go_go_go:function(){this.bookmarks_select={onclick:function(){this.update_location_input();},onchange:function(){this.update_location_input();},onkeyup:function(Z){this.update_location_input();},update_location_input:function(){if(this.options[this.options.selectedIndex].value!=""){_ge("freeform_geotagging").value=this.options[this.options.selectedIndex].text.split(" - (")[0];}else{var t=_ge("freeform_geotagging").value.toLowerCase();if(_ge("geo_bookmarks_slct")){for(var Z=1;Z<_ge("geo_bookmarks_slct").options.length;Z++){if(t==_ge("geo_bookmarks_slct").options[Z].text.split(" - (")[0].toLowerCase()){_ge("freeform_geotagging").value="";}}}}}};this.input_box={do_first_lat_long_auto_insert:true,onkeyup:function(V){if(!V){V=window.event;}var Z=_get_event_keycode(V);if(Z==71&&V.ctrlKey&&V.altKey){this.value="geo:long=";}if(Z==13){_ge("geo_form_save").onclick();return ;}if(this.do_first_lat_long_auto_insert){var t=new RegExp("^(geo:(lat)=(\\+|\\-)?((\\d+\\.\\d+)|\\d+)([,; ]))$");var X=new RegExp("^(geo:(lon|long)=(\\+|\\-)?((\\d+\\.\\d+)|\\d+)([,; ]))$");if(this.value.toLowerCase().match(t)){this.value=this.value.toLowerCase()+" geo:long=";this.do_first_lat_long_auto_insert=false;}if(this.value.toLowerCase().match(X)){this.value=this.value.toLowerCase()+" geo:lat=";this.do_first_lat_long_auto_insert=false;}}if(_ge("geo_bookmarks_slct")){_ge("geo_bookmarks_slct").options.selectedIndex=0;}if(this.value==""){this.do_first_lat_long_auto_insert=true;}_ge("freeform_geotagging_4real").value="";}};this.submit_button={onclick:function(){_ge("a_geotag_toggle").two_second_delay_time_started_for_dunstan_because_he_is_picky_like_that=new Date();if(_ge("freeform_geotagging").value==""){return ;}if(_ge("freeform_geotagging_4real").value!=""){if(_ge("freeform_geotagging_4real").value.split("|").length==1){_ge("a_geotag_toggle").save_position(_pf(_ge("freeform_geotagging_4real").value.split(",")[0]),_pf(_ge("freeform_geotagging_4real").value.split(",")[1]),_pf(_ge("freeform_geotagging_4real").value.split(",")[2]),_ge("freeform_geotagging_4real").value.split(",")[0]+", "+_ge("freeform_geotagging_4real").value.split(",")[1]);}else{_ge("a_geotag_toggle").save_position(_pf(_ge("freeform_geotagging_4real").value.split(",")[0]),_pf(_ge("freeform_geotagging_4real").value.split(",")[1]),_pf(_ge("freeform_geotagging_4real").value.split(",")[2]),_ge("freeform_geotagging_4real").value.split("|")[1]);}return ;}var t=_ge("freeform_geotagging").value.toLowerCase();var i=null;if(_ge("freeform_geotagging").value.length>1&&_ge("freeform_geotagging").value.substr(0,1)=="@"){_ge("a_geotag_toggle").find_at(_ge("freeform_geotagging").value.substr(1,9999));return ;}var X=new RegExp("^(geo:lat=(\\+|\\-)?((\\d+\\.\\d+)|\\d+)([,; ]+))(geo:(long|lon)=(\\+|\\-)?((\\d+\\.\\d+)|\\d+))");var Z=new RegExp("^(geo:(long|lon)=(\\+|\\-)?((\\d+\\.\\d+)|\\d+)([,; ]+))(geo:lat=(\\+|\\-)?((\\d+\\.\\d+)|\\d+))");var G=new RegExp("[a-z:=]","g");var O=new RegExp("[ ;]","g");var D=new RegExp(",+","g");if(t.match(X)){i=t.replace(G,"").replace(O,",").replace(D,",");var g=_pf(i.split(",")[0]);var H=_pf(i.split(",")[1]);}if(t.match(Z)){i=t.replace(G,"").replace(O,",").replace(D,",");var g=_pf(i.split(",")[1]);var H=_pf(i.split(",")[0]);}if(typeof (g)=="undefined"){var w=null;var d=null;var r=null;t=t.replace(String.fromCharCode(8220),"\"").replace(String.fromCharCode(8221),"\"").replace(String.fromCharCode(8216),"'").replace(String.fromCharCode(8217),"'").replace(String.fromCharCode(176),"*");var v=null;var y=null;if(t.indexOf("n")>0){w=true;v=t.indexOf("n");}if(t.indexOf("s")>0){w=false;v=t.indexOf("s");}if(t.indexOf("e")>0){d=true;y=t.indexOf("e");}if(t.indexOf("w")>0){d=false;y=t.indexOf("w");}if(v!=null&&y!=null&&y<v){this.lon_first=true;}if(t.indexOf("*")>0&&t.indexOf("'")>0&&t.indexOf("\"")>0){var t=t.replace(new RegExp("[nsew'\"*]"),",").replace(new RegExp(",+")," ").replace(new RegExp(" +")," ");var e=t.split(" ");if(e.length>=6){var g=_pi(e[0]);if(g>=0){g+=(e[1]/60)+(e[2]/6000);}else{g-=((e[1]/60)+(e[2]/6000));}var H=_pi(e[3]);if(H>=0){H+=(e[4]/60)+(e[5]/6000);}else{H-=((e[4]/60)+(e[5]/6000));}}}if(t.indexOf("*")>0&&t.indexOf("'")>0){var t=t.replace(new RegExp("[nsew'\"*]"),",").replace(new RegExp(",+")," ").replace(new RegExp(" +")," ");var e=t.split(" ");if(e.length>=4){var g=_pi(e[0]);if(g>=0){g+=(e[1]/60);}else{g-=(e[1]/60);}var H=_pi(e[2]);if(H>=0){H+=(e[3]/60);}else{H-=(e[3]/60);}}}if(typeof (e)=="undefined"){var t=t.replace(new RegExp("[nsew'\"*]"),",").replace(new RegExp(",+")," ").replace(new RegExp(" +")," ");var e=t.split(" ");if(e.length>=2){var g=_pf(e[0]);var H=_pf(e[1]);}}if(r==true){var V=g;g=H;H=V;}if(w==true){g=Math.abs(g);}if(w==false){g=-1*Math.abs(g);}if(d==true){H=Math.abs(H);}if(d==false){H=-1*Math.abs(H);}}if(this.validate(g,H)){_ge("a_geotag_toggle").save_position(g,H,16,g+", "+H);}else{var b=_ge("freeform_geotagging").value.toLowerCase().replace(new RegExp("[a-z]"),"").replace(new RegExp("[,;*'\" ]"),"");var l=_ge("freeform_geotagging").value.toLowerCase().replace(new RegExp("[0-9]"),"").replace(new RegExp("[,;*'\" ]"),"");if((b.length*0.7)>l.length){YAHOO.util.Dom.setStyle("block_page_geotag","display","none");YAHOO.util.Dom.setStyle("div_geo_feedback_mangled_format","display","block");}else{_ge("a_geotag_toggle").find_location(_ge("freeform_geotagging").value);}}},validate:function(Z,t){if(typeof (Z)=="undefined"||typeof (t)=="undefined"||typeof (Z)!="number"||typeof (t)!="number"||isNaN(Z)||isNaN(t)){return false;}if(Math.abs(Z)>90||Math.abs(t)>180){return false;}return true;}};if(_ge("geo_bookmarks_slct")){F.decorate(_ge("geo_bookmarks_slct"),this.bookmarks_select);}F.decorate(_ge("freeform_geotagging"),this.input_box);F.decorate(_ge("geo_form_save"),this.submit_button);if(_ge("geo_bookmark_privacy_slct")){for(var o=0;o<_ge("geo_bookmark_privacy_slct").options.length;o++){if(use_viewgeo==_ge("geo_bookmark_privacy_slct").options[o].value){_ge("geo_bookmark_privacy_slct").options.selected=true;}}}if(_ge("a_place_on_map_nu")){_ge("a_place_on_map_nu").style.display="none";}if(_ge("a_place_on_map_old")){_ge("a_place_on_map_old").style.display="none";}if(_ge("a_geotag_toggle")&&!_ge("div_taken_in")){_ge("a_geotag_toggle").style.display="inline";}if(_ge("freeform_geotagging")){_ge("freeform_geotagging").value="";}if(_ge("freeform_geotagging_4real")){_ge("freeform_geotagging_4real").value="";}if(_ge("freeform_geotagging")&&use_location!=""){_ge("freeform_geotagging").value=use_location;}if(_ge("freeform_geotagging_4real")&&use_4real_location!=""){_ge("freeform_geotagging_4real").value=use_4real_location;}},toggle_geotagging:function(){if(this.closed){if(_ge("div_remove_only_if_we_have_geodata")){if(_ge("div_taken_in")){YAHOO.util.Dom.setStyle("div_remove_only_if_we_have_geodata","display","block");}else{YAHOO.util.Dom.setStyle("div_remove_only_if_we_have_geodata","display","none");}}YAHOO.util.Dom.setStyle("block_page_geotag","height","");YAHOO.util.Dom.setStyle("block_page_geotag","display","block");this.block_size_height=_ge("block_page_geotag").offsetHeight;this.block_size_width=_ge("block_page_geotag").offsetWidth;if(F.is_ie){var V=0;var t=0;}else{var V=10;var t=10;}var Z=["div_geo_feedback_mangled_format","div_geo_feedback_error","div_geo_feedback_finding_locations","div_geo_feedback_saving","div_geo_feedback_success","div_geo_feedback_list_locations","div_geo_removing","div_geo_remove_success"];for(var o=0;o<Z.length;o++){if(_ge(Z[o])){YAHOO.util.Dom.setStyle(Z[o],"height",this.block_size_height-t);YAHOO.util.Dom.setStyle(Z[o],"width",this.block_size_width-V);}}this.closed=false;if(_ge("freeform_geotagging")){if(_ge("div_taken_in")){_ge("div_not_frm_geotagging_taken_in").innerHTML=_ge("div_taken_in").innerHTML.replace(/<[^>]+>/g,"");_ge("div_frm_geotagging").style.display="none";_ge("div_not_frm_geotagging").style.display="block";_ge("div_not_frm_geotagging_fix_this").style.display="block";}else{_ge("freeform_geotagging").focus();_ge("freeform_geotagging").do_first_lat_long_auto_insert=true;_ge("div_frm_geotagging").style.display="block";_ge("div_not_frm_geotagging").style.display="none";}}}else{Y.U.Dom.setStyle("block_page_geotag","display","none");Y.U.Dom.setStyle("div_geo_feedback_list_alternative_locations","display","none");this.closed=true;}return false;},load_geobookmarks:function(){var o={flickr_people_geoBookmarks_getList_onLoad:function(b,O,X,e){if(b){this.loaded_geobookmarks=true;var V=O.documentElement.getElementsByTagName("bookmark");var Z=_ge("geo_bookmarks_slct").options;Z.length=0;Z[Z.length]=new Option("-- "+F.output.get("global_plus_geo_select_bmk")+" --","");for(var t=0;t<V.length;t++){Z[Z.length]=new Option(V[t].getAttribute("label")+" - ("+V[t].getAttribute("pretty_name")+")",V[t].getAttribute("latitude")+", "+V[t].getAttribute("longitude")+", "+V[t].getAttribute("accuracy"));}_ge("div_geo_bookmark_form_loading").style.display="none";if(V.length>0){_ge("div_geo_bookmark_form").style.display="block";}else{_ge("div_geo_bookmark_none").style.display="block";}_ge("a_geotag_toggle").loaded_geobookmarks=true;}}};if(_ge("geo_bookmarks_slct")){F.API.callMethod("flickr.people.geoBookmarks.getList",{},o,null,null,0);}},find_location:function(o){var Z={flickr_geocode_translate_onLoad:function(C,L,r,V){if(C){var h=L.documentElement.getElementsByTagName("ResultSet")[0];var d=L.documentElement.getElementsByTagName("Result");var J=h.getAttribute("fl:source_id");var y=V.location.trim().split(",")[0];var g=[];var B=false;var e=function(i){var U=1;if(i.precision=="GeocodedBuilding"){U=16;}if(i.precision=="POI"){U=16;}if(i.precision=="GeocodedStreet"){U=15;}if(i.precision=="Suburb"){U=11;}if(i.precision=="Town"){U=9;}if(i.precision=="State"){U=5;}if(i.precision=="Country"){U=2;}return U;};var s=function(i){var U="&bull; ";if(i.title!=""){U+="<strong>"+i.title+"</strong>, ";}U+="<a href=\"#\" onclick=\"_ge('a_geotag_toggle').set_position("+i.lat+", "+i.lon+", ";U+=e(i);U+=", '"+i.title+", "+i.sub_title+"'); return false\">";U+=i.sub_title;U+="</a><br />";return U;};var z=0;for(c=0;c<d.length;c++){try{var N=String(d[c].getAttribute("precision"));}catch(u){var N="";}try{var H=String(d[c].getElementsByTagName("woe_specificprobability")[0].firstChild.nodeValue);}catch(u){var H="";}try{var Q=String(d[c].getElementsByTagName("woe_woeid")[0].firstChild.nodeValue);}catch(u){var Q="";}var n=String(d[c].getElementsByTagName("Latitude")[0].firstChild.nodeValue);var G=String(d[c].getElementsByTagName("Longitude")[0].firstChild.nodeValue);try{var v=String(d[c].getElementsByTagName("woe_bbox")[0].firstChild.nodeValue);}catch(u){var v="";}try{var m=String(d[c].getElementsByTagName("Address")[0].firstChild.nodeValue);}catch(u){var m="";}try{var l=String(d[c].getElementsByTagName("City")[0].firstChild.nodeValue);}catch(u){var l="";}try{var I=String(d[c].getElementsByTagName("State")[0].firstChild.nodeValue);}catch(u){var I="";}try{var x=String(d[c].getElementsByTagName("Zip")[0].firstChild.nodeValue);}catch(u){var x="";}try{var k=String(d[c].getElementsByTagName("Country")[0].firstChild.nodeValue);}catch(u){var k="";}try{var W=String(d[c].getElementsByTagName("place_url")[0].firstChild.nodeValue);}catch(u){var W="";}k=(k=="United States")?"US":k;k=(k=="United Kingdom")?"UK":k;var p="";var t="";var X=y.toLowerCase();if(N=="GeocodedBuilding"||N=="POI"){if(m){t=t+", "+m;}}if(l){t=t+", "+l;}if(I){t=t+", "+I;}if(k){t=t+", "+k;}if(t.length>2){t=t.substring(2,t.length);}if(N=="County"){p=y.substring(0,1).toUpperCase()+y.substring(1,y.length)+" County";}else{if(N=="GeocodedBuilding"){t=y.split(" ")[0]+" "+t;}else{if(N=="POI"){p=y;}else{sub_titleA=t.split(", ");if(X==sub_titleA[0].toLowerCase()){if(sub_titleA[0]!=t){p=sub_titleA[0];t=t.replace(sub_titleA[0]+", ","");}}if(p==""){p=y;}}}}if(g.length==0||(g.length>0&&(p!=g[g.length-1].title||t!=g[g.length-1].sub_title))){var P=Math.abs(_pf(v.split(",")[0])-_pf(v.split(",")[2]));var b=Math.abs(_pf(v.split(",")[1])-_pf(v.split(",")[3]));var j=new woe_location_obj(Q,p,t,H,v,N,n,G);B=true;var D=100.035;if((P+b<D||N=="GeocodedBuilding"||N=="POI"||N=="GeocodedStreet")){g.push(j);}else{if(N!="Country"){z++;}else{z+=5;}}}}if(z>=5){g=[];}if(g.length==0){if(B){new_html="<strong>"+F.output.get("global_plus_geo_kinda_found_stuff")+"</strong>";}else{new_html="<strong>"+F.output.get("global_plus_geo_no_matches_for",V.location)+"</strong>";}}else{if(g.length==1&&(g[0].precision=="GeocodedBuilding"||g[0].precision=="POI"||g[0].precision=="GeocodedStreet")){new_html="<strong>"+F.output.get("global_plus_geo_search_results")+"</strong><br />"+F.output.get("global_plus_geo_one_match")+"<br /><br />";new_html+=s(g[0]);_ge("a_geotag_toggle").set_position(g[0].lat,g[0].lon,e(g[0]),g[0].title+", "+g[0].sub_title);return ;}else{if(g.length>=8){new_html="<strong>"+F.output.get("global_plus_geo_search_results")+"</strong><br />"+F.output.get("global_plus_geo_found_x_matches",g.length)+"<br /><br />";for(var c=0;c<7;c++){new_html+=s(g[c]);}new_html+="<a href=\"#\" onclick=\"this.style.display='none'; _ge('div_geo_feedback_list_locations').style.height=''; _ge('div_more_geo_results').style.display='block'; return false\"><br /><strong>"+F.output.get("global_plus_geo_more_results")+"</strong></a>";new_html+="<div id=\"div_more_geo_results\" style=\"display: none\" class=\"p_smaller\">";for(var c=7;c<g.length;c++){new_html+=s(g[c]);}new_html+="</div>";}else{if(g.length==1){new_html=F.output.get("global_plus_geo_one_match")+"<br /><br />";}else{new_html=F.output.get("global_plus_geo_found_x_matches",g.length)+"<br /><br />";}for(var c=0;c<g.length;c++){new_html+=s(g[c]);}}}}_ge("a_geotag_toggle").set_failed_search(new_html);}else{try{var w=_pi(L.documentElement.getElementsByTagName("err")[0].getAttribute("code"));var A=L.documentElement.getElementsByTagName("err")[0].getAttribute("msg");}catch(u){var O=F.output.get("unknown_err");}_ge("div_geo_feedback_error_msg").innerHTML=O;YAHOO.util.Dom.setStyle("div_geo_feedback_finding_locations","display","none");YAHOO.util.Dom.setStyle("div_geo_feedback_error","display","block");}}};YAHOO.util.Dom.setStyle("block_page_geotag","display","none");_ge("div_geo_feedback_finding_locations").style.display="block";F.API.callMethod("flickr.geocode.translate",{provider_name:(_qs_args.provider_name)?_qs_args.provider_name:"woe",location:o},Z,null,null,0);},fetch_alternatives:function(G,t,X){G=parseFloat(G);t=parseFloat(t);X=parseInt(X);_ge("block_page_geotag").style.display="none";_ge("div_geo_feedback_list_alternative_locations").style.display="none";_ge("div_geo_feedback_finding_alternative_locations").style.display="block";if(X>0){if(X>=1&&X<=2){X=6;}if(X>=3&&X<=5){X=5;}if(X>=6&&X<=8){X=4;}if(X>=9&&X<=11){X=3;}if(X>=12&&X<=14){X=2;}if(X>=15&&X<=16){X=1;}}else{X=X*-1;}if(X==1){var O=22;var e=1.5;}if(X==2){var O=7;var e=7;}if(X==3){var O=9;var e=50;}if(X==4){var O=8;var e=200;}if(X==5){var O=12;var e=500;}if(X==6){var O=29;var e=1500;}var w=0.056;var y=G-(w*e/8);var b=G+(w*e/8);var Z=t-(w*e/8);var i=t+(w*e/8);var V={flickr_photos_geo_placesForBoundingBox_onLoad:function(L,x,v,D){if(L){var r=x.documentElement.getElementsByTagName("place");var g="<ul>";var l=x.documentElement.getElementsByTagName("places")[0].getAttribute("place_type");for(var d=0;d<r.length;d++){g+="<li class=\"Stats\"><a href=\"#\" class=\"Plain\" onclick=\"_ge('a_geotag_toggle').correct_location('"+r[d].getAttribute("place_id")+"', "+l+");return false\">"+r[d].firstChild.nodeValue+"</a></li>";}g+="</ul>";if(l==22){var H=-2;}if(l==7){var H=-3;}if(l==9){var H=-4;}if(l==8){var H=-5;}if(l==12){var H=-6;}if(l==29){var H=-7;}g+="<br /><a href=\"#\" onclick=\"_ge('a_geotag_toggle').fetch_alternatives('"+D.pass_params.lat+"','"+D.pass_params.lon+"','"+H+"'); return false\" class=\"Plain\">None of the above</a>";_ge("div_geo_feedback_list_alternative_locations_list").innerHTML=g;_ge("div_geo_feedback_finding_alternative_locations").style.display="none";_ge("div_geo_feedback_list_alternative_locations").style.display="block";}else{var g=F.output.get("geo_corrections_no_alternatives");_ge("div_geo_feedback_list_alternative_locations_list").innerHTML=g;_ge("div_geo_feedback_finding_alternative_locations").style.display="none";_ge("div_geo_feedback_list_alternative_locations").style.display="block";}}};var o={lat:G,lon:t,step:(X*-1)};F.API.callMethod("flickr.photos.geo.placesForBoundingBox",{bbox:Z+","+y+","+i+","+b,placetype:O,pass_params:o},V,null,null,0);},correct_location:function(o,t){var Z={flickr_photos_geo_correctLocation_onLoad:function(b,O,X,e){if(b){if(e.place_type==22){var V=16;}if(e.place_type==7){var V=14;}if(e.place_type==9){var V=11;}if(e.place_type==8){var V=8;}if(e.place_type==12){var V=5;}if(e.place_type==29){var V=2;}_ge("a_geotag_toggle").load_position(V);}}};_ge("div_geo_feedback_list_alternative_locations").style.display="none";_ge("div_geo_feedback_saving").style.display="block";F.API.callMethod("flickr.photos.geo.correctLocation",{photo_id:page_photo_id,place_id:o,place_type:t},Z,null,null,0);},find_at:function(Z){var o={flickr_photos_search_onLoad:function(i,G,e,V){if(i){var b="";if(G.documentElement.getElementsByTagName("photo").length==1){photo_id=G.documentElement.getElementsByTagName("photo")[0].getAttribute("id");var w={flickr_photos_getInfo_onLoad:function(z,L,d,H){if(z){if(L.documentElement.getElementsByTagName("location").length==0){var v=L.documentElement.getElementsByTagName("url");var g="";for(var l=0;l<v.length;l++){if(v[l].getAttribute("type")=="photopage"){g=v[l].childNodes[0].nodeValue;}}if(g!=""){b="<strong>"+F.output.get("global_plus_geo_no_geo_bookmark_data_for_with_path",g,"@"+H.tags)+"</strong>";}else{b="<strong>"+F.output.get("global_plus_geo_no_geo_bookmark_data_for","@"+H.tags)+"</strong>";}_ge("a_geotag_toggle").set_failed_search(b);}else{latitude=L.documentElement.getElementsByTagName("location")[0].getAttribute("latitude");longitude=L.documentElement.getElementsByTagName("location")[0].getAttribute("longitude");accuracy=L.documentElement.getElementsByTagName("location")[0].getAttribute("accuracy");try{query_string=L.documentElement.getElementsByTagName("query_string")[0].childNodes[0].nodeValue;}catch(B){query_string=latitude+", "+longitude;}geo_ispublic=L.documentElement.getElementsByTagName("geoperms")[0].getAttribute("ispublic");geo_iscontact=L.documentElement.getElementsByTagName("geoperms")[0].getAttribute("iscontact");geo_isfriend=L.documentElement.getElementsByTagName("geoperms")[0].getAttribute("isfriend");geo_isfamily=L.documentElement.getElementsByTagName("geoperms")[0].getAttribute("isfamily");use_location=query_string;use_4real_location=latitude+", "+longitude+", "+accuracy+"|"+query_string;_ge("freeform_geotagging").value=use_location;_ge("freeform_geotagging_4real").value=use_4real_location;var p=0;if(geo_ispublic==0&&geo_iscontact==0&&geo_isfriend==1&&geo_isfamily==1){p=1;}if(geo_ispublic==0&&geo_iscontact==0&&geo_isfriend==0&&geo_isfamily==1){p=2;}if(geo_ispublic==0&&geo_iscontact==0&&geo_isfriend==1&&geo_isfamily==0){p=3;}if(geo_iscontact==1){p=4;}if(geo_ispublic==1){p=5;}_ge("geo_bookmark_privacy_slct").options[p].selected=true;_ge("geo_form_save").onclick();}}else{try{var D=_pi(L.documentElement.getElementsByTagName("err")[0].getAttribute("code"));var r=L.documentElement.getElementsByTagName("err")[0].getAttribute("msg");var x=F.output.get("api_err_generic")+r;}catch(B){var x=F.output.get("unknown_err");}_ge("div_geo_feedback_error_msg").innerHTML="<strong>"+x+"</strong>";_ge("div_geo_feedback_finding_locations").style.display="none";_ge("div_geo_feedback_error").style.display="block";}}};F.API.callMethod("flickr.photos.getInfo",{photo_id:photo_id,tags:V.tags},w,null,null,0);}else{b="<strong>"+F.output.get("global_plus_geo_no_matches_for","@"+V.tags)+"</strong>";_ge("a_geotag_toggle").set_failed_search(b);}}else{try{var X=_pi(G.documentElement.getElementsByTagName("err")[0].getAttribute("code"));var t=G.documentElement.getElementsByTagName("err")[0].getAttribute("msg");}catch(y){var O=F.output.get("unknown_err");}_ge("div_geo_feedback_error_msg").innerHTML=O;YAHOO.util.Dom.setStyle("div_geo_feedback_finding_locations","display","none");YAHOO.util.Dom.setStyle("div_geo_feedback_error","display","block");}}};YAHOO.util.Dom.setStyle("block_page_geotag","display","none");_ge("div_geo_feedback_finding_locations").style.display="block";F.API.callMethod("flickr.photos.search",{user_id:global_nsid,tags:"geo:bookmark="+Z,extras:"geo",per_page:1},o,null,null,0);},set_failed_search:function(X){YAHOO.util.Dom.setStyle("div_geo_feedback_list_locations","height","");_ge("div_geo_feedback_list_locations_list").innerHTML=X;YAHOO.util.Dom.setStyle("div_geo_feedback_finding_locations","display","none");YAHOO.util.Dom.setStyle("div_geo_feedback_list_locations","display","block");var o=YAHOO.util.Dom.getRegion("div_geo_feedback_list_locations");if(F.is_ie){var V=10;}else{var V=10;}if(o.bottom-o.top>_ge("a_geotag_toggle").block_size_height+V){var t=["div_geo_feedback_mangled_format","div_geo_feedback_error","div_geo_feedback_finding_locations","div_geo_feedback_saving","div_geo_feedback_success","div_geo_feedback_list_locations","div_geo_removing","div_geo_remove_success"];for(var Z=0;Z<t.length;Z++){YAHOO.util.Dom.setStyle(t[Z],"height",o.bottom-o.top-V);YAHOO.util.Dom.setStyle(t[Z],"width",o.right-o.left-V);}}else{var t=["div_geo_feedback_list_locations"];for(var Z=0;Z<t.length;Z++){YAHOO.util.Dom.setStyle(t[Z],"height",_ge("a_geotag_toggle").block_size_height-V);YAHOO.util.Dom.setStyle(t[Z],"width",_ge("a_geotag_toggle").block_size_width-V);}}},set_position:function(Z,V,o,t){_ge("freeform_geotagging_4real").value=Z+", "+V+", "+o+",|"+t;if(t.length>=2&&t.substring(0,2)==", "){t=t.substring(2,t.length);}_ge("freeform_geotagging").value=t;_ge("div_geo_feedback_list_locations").style.display="none";_ge("block_page_geotag").style.display="block";this.save_position(Z,V,o,t);},save_position:function(V,X,t,Z){var o={flickr_photos_geo_setLocation_onLoad:function(D,r,y,b){if(D){var H=use_viewgeo;if(_ge("geo_bookmark_privacy_slct")){for(var w=0;w<_ge("geo_bookmark_privacy_slct").options.length;w++){if(_ge("geo_bookmark_privacy_slct").options[w].selected){H=_ge("geo_bookmark_privacy_slct").options[w].value;break;}}}if(H!=use_viewgeo){var e={flickr_photos_geo_setPerms_onLoad:function(x,g,d,v){if(x){_ge("a_geotag_toggle").load_position(v.accuracy);}else{_ge("a_geotag_toggle").load_position(v.accuracy);}}};if(H==0){F.API.callMethod("flickr.photos.geo.setPerms",{photo_id:page_photo_id,accuracy:b.accuracy,is_public:1,is_friend:0,is_family:0,is_contact:0},e);}if(H==1){F.API.callMethod("flickr.photos.geo.setPerms",{photo_id:page_photo_id,accuracy:b.accuracy,is_public:0,is_friend:0,is_family:0,is_contact:1},e);}if(H==2){F.API.callMethod("flickr.photos.geo.setPerms",{photo_id:page_photo_id,accuracy:b.accuracy,is_public:0,is_friend:1,is_family:1,is_contact:0},e);}if(H==3){F.API.callMethod("flickr.photos.geo.setPerms",{photo_id:page_photo_id,accuracy:b.accuracy,is_public:0,is_friend:1,is_family:0,is_contact:0},e);}if(H==4){F.API.callMethod("flickr.photos.geo.setPerms",{photo_id:page_photo_id,accuracy:b.accuracy,is_public:0,is_friend:0,is_family:1,is_contact:0},e);}if(H==5){F.API.callMethod("flickr.photos.geo.setPerms",{photo_id:page_photo_id,accuracy:b.accuracy,is_public:0,is_friend:0,is_family:0,is_contact:0},e);}}else{_ge("a_geotag_toggle").load_position(b.accuracy);}}else{try{var G=_pi(r.documentElement.getElementsByTagName("err")[0].getAttribute("code"));var O=r.documentElement.getElementsByTagName("err")[0].getAttribute("msg");var i=F.output.get("api_err_generic")+" "+O;}catch(l){var i=F.output.get("unknown_err");}_ge("div_geo_feedback_error_msg").innerHTML=i;_ge("div_geo_feedback_saving").style.display="none";_ge("div_geo_feedback_error").style.display="block";}}};if(Z.length>=2&&Z.substr(0,2)==", "){Z=Z.substr(2,9999);}_ge("block_page_geotag").style.display="none";_ge("div_geo_feedback_list_locations").style.display="none";_ge("div_geo_feedback_finding_locations").style.display="none";_ge("div_geo_feedback_saving").style.display="block";F.API.callMethod("flickr.photos.geo.setLocation",{photo_id:page_photo_id,lat:V,lon:X,accuracy:t,query:Z,provider:"user"},o,null,null,0);},remove_location:function(){var o={flickr_photos_geo_removeLocation_onLoad:function(G,b,e,t){if(G){if(_ge("div_pre_geo_block")){_ge("div_pre_geo_block").innerHTML="";}use_location="";use_4real_location;if(_ge("freeform_geotagging")){_ge("freeform_geotagging").value=use_location;}if(_ge("freeform_geotagging_4real")){_ge("freeform_geotagging_4real").value=use_4real_location;}if(_ge("geo_bookmark_privacy_slct")){for(var V=0;V<_ge("geo_bookmark_privacy_slct").options.length;V++){if(default_viewgeo==_ge("geo_bookmark_privacy_slct").options[V].value){_ge("geo_bookmark_privacy_slct").options.selected=true;}}}YAHOO.util.Dom.setStyle("div_geo_remove_location_confirm","display","none");YAHOO.util.Dom.setStyle("div_geo_remove_location_question","display","block");YAHOO.util.Dom.setStyle("div_remove_only_if_we_have_geodata","display","none");if(_ge("div_mini_map_frame")&&_ge("div_mini_map_frame").visible==true){_ge("div_mini_map_frame").visible=false;}YAHOO.util.Dom.setStyle("div_geo_removing","display","none");YAHOO.util.Dom.setStyle("div_geo_remove_success","display","block");if(_ge("a_geotag_toggle")&&!_ge("div_taken_in")){_ge("a_geotag_toggle").style.display="inline";}if(_ge("a_geotag_toggle_ad")&&!_ge("div_taken_in")){_ge("a_geotag_toggle_ad").style.display="inline";}setTimeout("_ge('a_geotag_toggle').fade_yay('div_geo_remove_success')",500);}else{try{var X=_pi(b.documentElement.getElementsByTagName("err")[0].getAttribute("code"));var Z=b.documentElement.getElementsByTagName("err")[0].getAttribute("msg");var O=F.output.get("api_err_generic")+" "+Z;}catch(w){var O=F.output.get("unknown_err");}_ge("div_geo_feedback_error_msg").innerHTML=O;YAHOO.util.Dom.setStyle("div_geo_feedback_removing","display","none");YAHOO.util.Dom.setStyle("div_geo_remove_location_confirm","display","none");YAHOO.util.Dom.setStyle("div_geo_remove_location_question","display","block");YAHOO.util.Dom.setStyle("div_geo_feedback_error","display","block");}}};YAHOO.util.Dom.setStyle("block_page_geotag","display","none");YAHOO.util.Dom.setStyle("div_geo_removing","display","block");F.API.callMethod("flickr.photos.geo.removeLocation",{photo_id:page_photo_id},o,null,null,0);},load_position:function(Z){var o={flickr_photos_geo_getLocation_onLoad:function(i,G,b,X){if(i){if(typeof (photo_acc)!="undefined"){photo_acc=_pi(G.documentElement.getElementsByTagName("location")[0].getAttribute("accuracy"));}var t=new Date();var e=t-_ge("a_geotag_toggle").two_second_delay_time_started_for_dunstan_because_he_is_picky_like_that;if(e<2000){_ge("a_geotag_toggle").saving_delayer(G,X.accuracy);}else{_ge("a_geotag_toggle").saved_responseXML=G;_ge("a_geotag_toggle").saved_accuracy=X.accuracy;setTimeout("_ge('a_geotag_toggle').saving_delayer(_ge('a_geotag_toggle').saved_responseXML, _ge('a_geotag_toggle').saved_accuracy)",2000-e);}}else{try{var O=_pi(G.documentElement.getElementsByTagName("err")[0].getAttribute("code"));var V=G.documentElement.getElementsByTagName("err")[0].getAttribute("msg");var w=F.output.get("api_err_generic")+V;}catch(y){var w=F.output.get("unknown_err");}_ge("div_geo_feedback_error_msg").innerHTML="<strong>"+w+"</strong>";_ge("div_geo_feedback_saving").style.display="none";_ge("div_geo_feedback_error").style.display="block";}}};F.API.callMethod("flickr.photos.geo.getLocation",{photo_id:page_photo_id,accuracy:Z},o,null,null,0);},saving_delayer:function(t,Z){_ge("a_geotag_toggle").saved_responseXML=t;if(Z<15){_ge("a_geotag_toggle").redraw_taken_in(t);var o=_ge("div_geo_feedback_success").innerHTML;o+="<small style=\"color:black\">"+F.output.get("global_plus_geo_yeah_ok_found_stuff","/photos/organize/?start_tab=map&from_geo_ids="+page_photo_id)+"</small>";o+="<input type=\"button\" class=\"Butt\" value=\"CONTINUE\" onclick=\"_ge('a_geotag_toggle').saving_delayer(_ge('a_geotag_toggle').saved_responseXML, 99)\" />";o+="<br /><br /><small>"+F.output.get("global_plus_geo_yeah_ok_hint_found_stuff")+"</small>";_ge("div_geo_feedback_saving").innerHTML=o;}else{_ge("div_geo_feedback_saving").innerHTML=_ge("div_geo_feedback_saving_stored").innerHTML;_ge("div_geo_feedback_saving").style.display="none";_ge("div_geo_feedback_success").style.display="block";if(_ge("a_geotag_toggle")&&!_ge("div_taken_in")){_ge("a_geotag_toggle").style.display="inline";}if(_ge("a_geotag_toggle_ad")&&!_ge("div_taken_in")){_ge("a_geotag_toggle_ad").style.display="inline";}setTimeout("_ge('a_geotag_toggle').fade_yay('div_geo_feedback_success')",500);_ge("a_geotag_toggle").redraw_taken_in(t);}},redraw_taken_in:function(o){this.responseXML=o;if(_ge("div_pre_geo_block")){_ge("div_pre_geo_block").innerHTML="<span id='div_taken_in'>"+o.documentElement.getElementsByTagName("location")[0].getAttribute("taken_in").replace("&lt;","<").replace("&gt;",">").replace("&#38;lt;","<").replace("&#38;gt;",">")+"</span>";}if(typeof (YMap)=="function"){_ge("a_geotag_toggle").new_geo_point=new YGeoPoint(o.documentElement.getElementsByTagName("location")[0].getAttribute("latitude"),o.documentElement.getElementsByTagName("location")[0].getAttribute("longitude"));_ge("a_geotag_toggle").new_geo_accuracy=o.documentElement.getElementsByTagName("location")[0].getAttribute("accuracy");_ge("a_geotag_toggle").new_geo_taken_in=o.documentElement.getElementsByTagName("location")[0].getAttribute("taken_in").replace("&lt;","<").replace("&gt;",">").replace("&#38;lt;","<").replace("&#38;gt;",">");_ge("div_pre_geo_block").innerHTML+=" (<a href=\"#\" onclick=\"_ge('a_geotag_toggle').toggle_geotagging(); return false\" class=\"Plain\">edit</a>&nbsp;|&nbsp;<a id=\"a_link_to_map\" href=\""+geo_map_url+"?view=everyones\" class=\"Plain\" onclick=\"try{F.mini_map_open(_ge('a_link_to_map'), "+page_photo_id+", '"+geo_map_url+"', '"+escape(geo_possessed_username)+"', '"+geo_thmb+"', _ge('a_geotag_toggle').new_geo_point.Lat + '', _ge('a_geotag_toggle').new_geo_point.Lon + '', _ge('a_geotag_toggle').new_geo_accuracy, escape(_ge('a_geotag_toggle').new_geo_taken_in)); return false} catch(er) {}\">map</a>)";_ge("a_geotag_toggle").style.display="none";if(_ge("a_geotag_toggle_ad")){_ge("a_geotag_toggle_ad").style.display="none";}if(_ge("div_mini_map_frame")&&_ge("div_mini_map_frame").visible==true){_ge("div_mini_map_frame").visible=false;_ge("a_link_to_map").onclick();}}else{_ge("a_geotag_toggle").new_geo_point_lat=o.documentElement.getElementsByTagName("location")[0].getAttribute("latitude");_ge("a_geotag_toggle").new_geo_point_lon=o.documentElement.getElementsByTagName("location")[0].getAttribute("longitude");_ge("a_geotag_toggle").new_geo_accuracy=o.documentElement.getElementsByTagName("location")[0].getAttribute("accuracy");_ge("a_geotag_toggle").new_geo_taken_in=o.documentElement.getElementsByTagName("location")[0].getAttribute("taken_in").replace("&lt;","<").replace("&gt;",">").replace("&#38;lt;","<").replace("&#38;gt;",">");F._map_script_loader.load_scripts(_ge("a_geotag_toggle").map_scripts_loaded,null);}},map_scripts_loaded:function(){_ge("div_pre_geo_block").innerHTML+=" (<a href=\"#\" onclick=\"_ge('a_geotag_toggle').toggle_geotagging(); return false\" class=\"Plain\">edit</a>&nbsp;|&nbsp;<a id=\"a_link_to_map\" href=\""+geo_map_url+"?view=everyones\" class=\"Plain\" onclick=\"try{F.mini_map_open(_ge('a_link_to_map'), "+page_photo_id+", '"+geo_map_url+"', '"+escape(geo_possessed_username)+"', '"+geo_thmb+"', _ge('a_geotag_toggle').new_geo_point_lat + '', _ge('a_geotag_toggle').new_geo_point_lon + '', _ge('a_geotag_toggle').new_geo_accuracy, escape(_ge('a_geotag_toggle').new_geo_taken_in)); return false} catch(er) {}\">map</a>)";_ge("a_geotag_toggle").style.display="none";if(_ge("a_geotag_toggle_ad")){_ge("a_geotag_toggle_ad").style.display="none";}},check_for_map_existing:function(){if(typeof (YMap)=="function"){_ge("a_geotag_toggle").new_geo_point=new YGeoPoint(this.responseXML.documentElement.getElementsByTagName("location")[0].getAttribute("latitude"),this.responseXML.documentElement.getElementsByTagName("location")[0].getAttribute("longitude"));_ge("a_geotag_toggle").new_geo_accuracy=this.responseXML.documentElement.getElementsByTagName("location")[0].getAttribute("accuracy");_ge("a_geotag_toggle").new_geo_taken_in=this.responseXML.documentElement.getElementsByTagName("location")[0].getAttribute("taken_in").replace("&lt;","<").replace("&gt;",">").replace("&#38;lt;","<").replace("&#38;gt;",">");_ge("a_link_to_map").onclick=function(){F.mini_map_open(_ge("a_link_to_map"),page_photo_id,geo_map_url,escape(geo_possessed_username),geo_thmb,_ge("a_geotag_toggle").new_geo_point.Lat,_ge("a_geotag_toggle").new_geo_point.Lon,_ge("a_geotag_toggle").new_geo_accuracy,escape(_ge("a_geotag_toggle").new_geo_taken_in));};_ge("div_hide_map_link").style.display="inline";}else{setTimeout("_ge('a_geotag_toggle').check_for_map_existing()",1000);}},fade_yay:function(Z){var V=_ge(Z);var o=function(){var X=function(){V.style.display="none";var O=new YAHOO.util.Anim(Z,{opacity:{to:1}},0.1,YAHOO.util.Easing.easeOut);O.animate();_ge("a_geotag_toggle").closed=true;};var e=new YAHOO.util.Anim(Z,{height:{to:1}},0.333,YAHOO.util.Easing.easeOut);e.onComplete.subscribe(X);e.animate();};if(_ge("a_geotag_toggle")&&!_ge("div_taken_in")){_ge("a_geotag_toggle").style.display="inline";}if(_ge("a_geotag_toggle_ad")&&!_ge("div_taken_in")){_ge("a_geotag_toggle_ad").style.display="inline";}var t=new YAHOO.util.Anim(Z,{opacity:{to:0}},0.333,YAHOO.util.Easing.easeOut);t.onComplete.subscribe(o);t.animate();},last_empty_function:function(){}};F._map_script_loader={callback_func:"",load_scripts:function(Z,o){this.callback_func=Z;this.callback_args=o;if(typeof (YMap)=="function"){this.do_callback();return ;}var t=document.createElement("script");t.src="http://us.js2.yimg.com/us.js.yimg.com/lib/map/js/api/ymapapi_3_0_4_9.js";t.type="text/javascript";document.getElementsByTagName("head")[0].appendChild(t);setTimeout("F._map_script_loader.check_for_map_existing()",100);},check_for_map_existing:function(){if(typeof (YMap)=="function"){F._map_script_loader.do_callback();return ;}setTimeout("F._map_script_loader.check_for_map_existing()",100);},do_callback:function(){if(this.callback_func){if(this.callback_args){this.callback_func.apply(null,this.callback_args);}else{this.callback_func.apply();}}}};F.mini_map_open=function(t,Z,e,G,V,o,w,b,X){if(!window.ymap){window.map=window.ymap=new YMap(_ge("map"));}if(!window.ymap){return ;}geo_point=new YGeoPoint(_pf(o.replace(",",".")),_pf(w.replace(",",".")));window.ymap.setMapType(YAHOO_MAP_HYB);var O=_ge("div_mini_map_frame");if(!O.mini_map_frame_go_go_go){F.decorate(O,F._mini_map_frame).mini_map_frame_go_go_go();}O.show(t,Z,e,G,V,geo_point,b,X);};F._mini_map_anchor={mini_map_anchor_go_go_go:function(o,Z){this.style.color="#4a90e6";this.style.cursor=(F.is_ie)?"hand":"pointer";this.geo_point=o;this.zl=17-Z+5;if(this.zl>16){this.zl=16;}},onclick:function(o){_ge("div_mini_map_frame").show(this,this.geo_point,this.zl);}};F._mini_map_frame={mini_map_frame_go_go_go:function(Z){var e=1;this.visible=false;this.map_loaded=false;this.current_photo_id=null;this.ov=null;this.mo=null;this.parent_el=Z;this.left_offset=null;this.style.position="absolute";this.style.width="510px";this.style.height="307px";this.style.zIndex="2000";this.style.background="#f0f0f0";var V=_ge("div_mini_map_frame2");V.style.position="absolute";V.style.top="2px";V.style.left="2px";V.style.width="506px";V.style.height="303px";V.style.background="#ffffff";var t=_ge("div_mini_map_frame3");t.style.position="absolute";t.style.top="27px";t.style.left="3px";t.style.width="500px";t.style.height="250px";t.style.overflow="hidden";F.decorate(_ge("close_button"),F._map_close_button).button_go_go_go();_ge("map").style.position="absolute";_ge("map").style.top="0px";_ge("map").style.left="0px";var X=new YSize(500,372);try{map.resizeTo(X);}catch(w){}this.pop_shadow_id=F.make_shadow(this.id,994).id;var O=YUtility.createNode("div","div_zoom_background");var b={position:"absolute",top:"4px",right:"4px",width:"24px",height:"165px"};YUtility.setStyle(O,b);var o=YUtility.createNode("img","map_zoom_background");var b={position:"absolute",top:"0px",left:"0px",width:"24px",height:"165px"};YUtility.setStyle(o,b);o.src=_images_root+"/map_zoom_background.png";o.className="trans_png";YUtility.appendNode(O,o);var o=YUtility.createNode("img","candy_map_zoom_out");var b={position:"absolute",top:"4px",left:"4px",width:"16px",height:"16px"};YUtility.setStyle(o,b);o.style.cursor=(F.is_ie)?"hand":"pointer";o.src=_images_root+"/candy_map_zoom_out_default.png";YUtility.appendNode(O,o);var o=YUtility.createNode("img","candy_map_zoom_in");var b={position:"absolute",top:"145px",left:"4px",width:"16px",height:"16px"};YUtility.setStyle(o,b);o.style.cursor=(F.is_ie)?"hand":"pointer";o.src=_images_root+"/candy_map_zoom_in_default.png";YUtility.appendNode(O,o);var o=YUtility.createNode("img","candy_map_dragger");var b={position:"absolute",top:"20px",left:"3px",width:"18px",height:"13px"};YUtility.setStyle(o,b);o.style.cursor=(F.is_ie)?"hand":"pointer";o.src=_images_root+"/candy_map_zoom_drag.png";o.className="trans_png";YUtility.appendNode(O,o);YUtility.appendNode(_ge("map"),O);F.decorate(_ge("candy_map_zoom_in"),F._map_zoom_button).button_go_go_go("in");F.decorate(_ge("candy_map_zoom_out"),F._map_zoom_button).button_go_go_go("out");Y.U.Event.addListener(_ge("candy_map_dragger"),"mousedown",this.map_dragger_mouseDown,this,true);YEvent.Capture(map,EventsList.changeZoom,function(){_ge("div_mini_map_frame").change_zoom();});F.eb_add(this);},window_onresize:function(){if(this.visible){var o=Y.U.Dom.getX(_ge("Main"))+this.left_offset;this.style.left=o+"px";this.pop_place();}},show:function(V,t,G,H,X,w,r,O){F.eb_broadcast("stewart_pause");this.parent_el=V;if(this.current_photo_id!=t){if(this.mo!=null){map.removeOverlay(this.mo);}var Z=this.pop_shadow_id;var i=function(){_ge(Z).shadow_show();};if(F.is_ie){_ge(this.pop_shadow_id).shadow_show();}else{anim_do_opacity_to(this,1,1,100,"easeInQuad",i);}this.current_photo_id=t;var e=Y.U.Dom.getX(V)-289+11;if(e<Y.U.Dom.getX(_ge("Main"))){e=Y.U.Dom.getX(_ge("Main"))+11;}if(e+_pi(this.style.width)>Y.U.Dom.getX(_ge("Main"))+_ge("Main").offsetWidth-28){e-=(e+_pi(this.style.width))-(Y.U.Dom.getX(_ge("Main"))+_ge("Main").offsetWidth-28);}this.left_offset=e-Y.U.Dom.getX(_ge("Main"));this.style.top=Y.U.Dom.getY(V)-315+"px";this.style.left=e+"px";r=17-r+4;if(r>16){r=16;}map.drawZoomAndCenter(w,r);this.toggle_zoom();this.init_zoom_level=r;var o=YUtility.createNode("div","single_marker");var b=YUtility.createNode("img","img_single_marker");b.style.position="absolute";b.style.left="-27px";b.style.top="-136px";b.style.width="159px";b.style.height="146px";b.src=_images_root+"/pop_up_pinwin.png";b.className="trans_png";YUtility.appendNode(o,b);var b=YUtility.createNode("img","img_single_marker_thumb");b.style.position="absolute";b.style.left="-16px";b.style.top="-126px";b.src=X;YUtility.appendNode(o,b);this.mo=new YCustomOverlay(w,o);this.ov=map.addOverlay(this.mo);map.getMarkerObject("single_marker").setYGeoPoint(w);if(_ge("map_links1")){_ge("map_links1").innerHTML="<a href=\""+G+"?view=users\"><strong>"+F.output.get("photo_mini_map_view_on_map",H)+"</strong></a>";}if(O){var y=unescape(O).replace("<a>","").replace("</a>","");y=y.replace("&lt;","<").replace("&gt;",">");y+=" (See <a href=\""+G+"?view=everyones\">"+F.output.get("photo_mini_map_more_photos")+"</a>)";}if(_ge("map_links2")){if(y){_ge("map_links2").innerHTML=y;}setTimeout("_ge('div_mini_map_frame').set_width('map_links2')",100);}if(_ge("map_links")){if(y){_ge("map_links").innerHTML=y;}setTimeout("_ge('div_mini_map_frame').set_width('map_links')",100);}if(_ge("pretty_lat_long")){_ge("pretty_lat_long").innerHTML=this.make_pretty(w.Lat,w.Lon);_ge("pretty_lat_long").innerHTML+="<span class=\"geo\" style=\"display:none\"><span class=\"latitude\">"+w.Lat+"</span><span class=\"longitude\">"+w.Lon+"</span></span>";}this.visible=true;this.style.display="block";this.window_onresize();}else{if(this.current_photo_id==t&&this.visible==true){this.hide();}else{if(this.current_photo_id==t&&this.visible==false){var Z=this.pop_shadow_id;var i=function(){_ge(Z).shadow_show();};if(F.is_ie){_ge(this.pop_shadow_id).shadow_show();}else{anim_do_opacity_to(this,1,1,100,"easeInQuad",i);}if(_ge("map_links1")){_ge("map_links1").innerHTML="<a href=\""+G+"?view=users\"><strong>"+F.output.get("photo_mini_map_view_on_map",H)+"</strong></a>";}r=17-r+4;if(r>16){r=16;}map.drawZoomAndCenter(w,r);map.getMarkerObject("single_marker").setYGeoPoint(w);map.getMarkerObject("single_marker").unhide();this.toggle_zoom();if(O){var y=unescape(O).replace("<a>","").replace("</a>","");y=y.replace("&lt;","<").replace("&gt;",">");y+=" (See <a href=\""+G+"?view=everyones\">"+F.output.get("photo_mini_map_more_photos")+"</a>)";}if(_ge("map_links2")){_ge("map_links2").innerHTML=y;setTimeout("_ge('div_mini_map_frame').set_width('map_links2')",100);}if(_ge("map_links")){_ge("map_links").innerHTML=y;setTimeout("_ge('div_mini_map_frame').set_width('map_links')",100);}if(_ge("pretty_lat_long")){_ge("pretty_lat_long").innerHTML=this.make_pretty(w.Lat,w.Lon);_ge("pretty_lat_long").innerHTML+="<span class=\"geo\" style=\"display:none\"><span class=\"latitude\">"+w.Lat+"</span><span class=\"longitude\">"+w.Lon+"</span></span>";}this.visible=true;this.style.display="block";this.window_onresize();}}}},set_width:function(o){if(_ge(o).offsetHeight>20){_ge("div_mini_map_frame").style.height="319px";_ge("div_mini_map_frame2").style.height="315px";this.style.top=Y.U.Dom.getY(this.parent_el)-327+"px";}else{_ge("div_mini_map_frame").style.height="307px";_ge("div_mini_map_frame2").style.height="303px";this.style.top=Y.U.Dom.getY(this.parent_el)-315+"px";}_ge(this.pop_shadow_id).shadow_size_and_place();},make_pretty:function(t,V){var Z=this.dec_to_dms(t);if(t>0){Z.push("N");}else{Z.push("S");}var o=this.dec_to_dms(V);if(V>0){o.push("E");}else{o.push("W");}return Z[0]+"&#176;"+Z[1]+"' "+Z[2]+"\" "+Z[3]+", "+o[0]+"&#176;"+o[1]+"' "+o[2]+"\" "+o[3];},dec_to_dms:function(X){X=Math.abs(X);while(X>360){X-=360;}var V=Math.floor(X);var e=3600*(X-V);var Z=Math.floor(e/60);var o=(e/60)-Z;var t=Math.round(60*o);if(t<10){t="0"+t;}return new Array(V,Z,t);},change_zoom:function(){if(_ge("div_mini_map_frame").init_zoom_level>map.getZoomLevel()+4){YAHOO.util.Dom.setStyle("single_marker","display","none");}else{YAHOO.util.Dom.setStyle("single_marker","display","block");}},hide:function(){F.eb_broadcast("stewart_play_if_was_playing");_ge(this.pop_shadow_id).shadow_hide();var Z=this.id;var o=function(){_ge(Z).done_hiding();};if(F.is_ie){this.done_hiding();}else{anim_do_opacity_to(this,5,35,0,"easeInQuad",o);}},done_hiding:function(){this.visible=false;this.style.display="none";},pop_place:function(o,Z){_ge(this.pop_shadow_id).shadow_size_and_place();},toggle_zoom:function(){if(map.getZoomLevel()&&_ge("candy_map_dragger")){_ge("candy_map_dragger").style.top=20+((17-map.getZoomLevel())*7)+"px";}},map_dragger_mouseDown:function(o){Y.U.Event.stopEvent(o);this._new_zoom_level=map.getZoomLevel();this._startDragY=Y.U.Event.getPageY(o)-_pi(_ge("candy_map_dragger").style.top);Y.U.Event.addListener(document,"mouseup",this.map_dragger_mouseUp,this,true);Y.U.Event.addListener(document,"mousemove",this.map_dragger_mouseMove,this,true);},map_dragger_mouseUp:function(o){Y.U.Event.stopEvent(o);Y.U.Event.removeListener(document,"mouseup",this.map_dragger_mouseUp);Y.U.Event.removeListener(document,"mousemove",this.map_dragger_mouseMove);map.setZoomLevel(this._new_zoom_level);_ge("div_mini_map_frame").toggle_zoom();},map_dragger_mouseMove:function(o){var Z=(Y.U.Event.getPageY(o)-this._startDragY);this._new_zoom_level=17-(_pi(Z/7)-3);if(this._new_zoom_level<1){this._new_zoom_level=1;}if(this._new_zoom_level>17){this._new_zoom_level=17;}_ge("candy_map_dragger").style.top=((17-this._new_zoom_level)*7)+20+"px";}};F._map_close_button={_decotype:F._simple_button,className:"simple_butt",kittens:"fluffy",button_go_go_go:function(){this.style.position="absolute";this.style.right="8px";this.style.top="8px";this.style.cursor=(F.is_ie)?"hand":"pointer";this.innerHTML="<span style=\"color: #999\">"+F.output.get("close")+"</span><img src=\""+_images_root+"/simple_close_default.gif\" width=\"15\" height=\"15\" style=\"overflow:visible\">";F._map_close_button._decotype.button_go_go_go.apply(this);},onclick:function(o){F.stop_event_propagation(o);_ge("div_mini_map_frame").hide();},ondblclick:function(o){F.stop_event_propagation(o);_ge("div_mini_map_frame").hide();}};F._map_zoom_button={_decotype:F._simple_button,button_go_go_go:function(o){this.direction=o;F._map_zoom_button._decotype.button_go_go_go.apply(this);},onclick:function(Z){var o=map.getZoomLevel();if(this.direction=="in"){o--;}if(this.direction=="out"){o++;}if(o<1){o=1;}if(o>17){o=17;}map.setZoomLevel(o);_ge("div_mini_map_frame").toggle_zoom();F.stop_event_propagation(Z);},ondblclick:function(o){F.stop_event_propagation(o);}};